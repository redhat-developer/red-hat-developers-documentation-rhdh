<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="chrometwo"><head><title>Authentication in Red Hat Developer Hub</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css"/><meta name="generator" content="publican v4.3.2"/><meta name="description" content="As a Red Hat Developer Hub (RHDH) platform engineer, you can manage authentication of other users to meet the specific needs of your organization."/><link rel="next" href="#understanding-authentication-and-user-provisioning" title="1. Understanding authentication and user provisioning"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><script type="text/javascript" src="Common_Content/scripts/jquery-1.7.1.min.js"> </script><script type="text/javascript" src="Common_Content/scripts/utils.js"> </script><script type="text/javascript" src="Common_Content/scripts/highlight.js/highlight.pack.js"> </script></head><body><div id="chrometwo"><div id="main"><section xml:lang="en-US" class="article" id="idm45684600465088"><div class="titlepage"><div><div class="producttitle"><span class="productname">Red Hat Developer Hub</span> <span class="productnumber">1.8</span></div><div><h1 class="title">Authentication in Red Hat Developer Hub</h1></div><div><h3 class="subtitle"><em>Configuring authentication to external services in Red Hat Developer Hub</em></h3></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat Customer Content Services</span></div></div><div><a href="#idm45684598812080">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				As a Red Hat Developer Hub (RHDH) platform engineer, you can manage authentication of other users to meet the specific needs of your organization.
			</div></div></div></div><hr/></div><div class="toc"><ul class="toc"><li><span class="section"><a href="#understanding-authentication-and-user-provisioning">1. Understanding authentication and user provisioning</a></span></li><li><span class="section"><a href="#authenticating-with-the-guest-user_title-authentication">2. Authenticating with the Guest user</a></span><ul><li><span class="section"><a href="#authenticating-with-the-guest-user-on-an-operator-based-installation_title-authentication">2.1. Authenticating with the Guest user on an Operator-based installation</a></span></li><li><span class="section"><a href="#authenticating-with-the-guest-user-on-a-helm-based-installation_title-authentication">2.2. Authenticating with the Guest user on a Helm-based installation</a></span></li></ul></li><li><span class="section"><a href="#assembly-authenticating-with-rhbk">3. Authenticating with Red Hat Build of Keycloak (RHBK)</a></span><ul><li><span class="section"><a href="#enabling-user-authentication-with-rhbk-with-optional-steps">3.1. Enabling user authentication with Red Hat Build of Keycloak (RHBK), with optional steps</a></span></li><li><span class="section"><a href="#enabling-user-provisioning-with-ldap">3.2. Enabling user provisioning with LDAP</a></span></li><li><span class="section"><a href="#creating-a-custom-transformer-to-provision-users-from-rhbk-to-the-software-catalog">3.3. Creating a custom transformer to provision users from Red Hat Build of Keycloak (RHBK) to the software catalog</a></span></li></ul></li><li><span class="section"><a href="#enabling-authentication-with-github">4. Enabling authentication with GitHub</a></span><ul><li><span class="section"><a href="#enabling-user-authentication-with-github-with-optional-steps">4.1. Enabling user authentication with GitHub, with optional steps</a></span></li><li><span class="section"><a href="#enabling-user-authentication-with-github-as-an-auxiliary-authentication-provider">4.2. Enabling user authentication with GitHub as an auxiliary authentication provider</a></span></li></ul></li><li><span class="section"><a href="#enabling-user-authentication-with-microsoft-azure-with-optional-steps">5. Enabling user authentication with Microsoft Azure, with optional steps</a></span></li></ul></div><section class="section" id="understanding-authentication-and-user-provisioning"><div class="titlepage"><div><div><h2 class="title">1. Understanding authentication and user provisioning</h2></div></div></div><p>
			Learn about the authentication process from creating user and group entities in the software catalog to user sign-in, and how authentication and catalog plugins enable each step. Understanding this process is essential for successfully configuring your Developer Hub instance, securing access through authorization, and enabling features that rely on synchronized user and group data.
		</p><p>
			To fully enable catalog features, provision user and group data from the Identity Provider to the Developer Hub software catalog. Catalog provider plugins handle this task asynchronously. These plugins query the Identity Provider (IdP) for relevant user and group information, and create or update corresponding entities in the Developer Hub catalog. Scheduled provisioning ensures that the catalog accurately reflects the users and groups in your organization.
		</p><p>
			When a user attempts to access Developer Hub, Developer Hub redirects them to a configured authentication provider, such as Red Hat Build of Keycloak (RHBK), GitHub, or Microsoft Azure. This external IdP is responsible for authenticating the user.
		</p><p>
			On successful authentication, the Developer Hub authentication plugin, configured in your <code class="literal">app-config.yaml</code> file, processes the response from the IdP, resolves the identity in the Developer Hub software catalog, and establishes a user session within Developer Hub.
		</p><p>
			Configuring authentication and user provisioning is critical for several reasons.
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					Securing your Developer Hub instance by ensuring only authenticated users can gain access.
				</li><li class="listitem">
					Enabling authorization by allowing you to define access controls based on user and group memberships synchronized from your IdP.
				</li><li class="listitem"><p class="simpara">
					Provisioning user and group data to the catalog is necessary for various catalog features that rely on understanding entity ownership and relationships between users, groups, and software components.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Without this provisioning step, features such as displaying who owns a catalog entity might not function correctly.
					</p></div></div></li></ul></div><div class="admonition tip"><div class="admonition_header">Tip</div><div><p>
			To explore Developer Hub features in a non-production environment, you can:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					To use Developer Hub without external IdP, enable the guest user to skip configuring authentication and authorization, log in as the guest user, and access all Developer Hub features.
				</li><li class="listitem">
					To use Developer Hub without authorization policies and features relying on the software catalog, you can enable the <code class="literal">dangerouslyAllowSignInWithoutUserInCatalog</code> resolver option. This setting bypasses the check requiring a user to be in the catalog but still enforces authentication.
				</li></ul></div></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
				Developer Hub uses a one-way synchronization model, where user and group data flow from your Identity Provider to the Developer Hub software catalog. As a result, deleting users or groups manually through the Developer Hub Web UI or REST API might be ineffective or cause inconsistencies, since Developer Hub will create those entities again during the next import.
			</p></div></div></section><section class="section" id="authenticating-with-the-guest-user_title-authentication"><div class="titlepage"><div><div><h2 class="title">2. Authenticating with the Guest user</h2></div></div></div><p>
			For trial or non-production environments, you can enable guest access to skip configuring authentication and authorization and explore Developer Hub features.
		</p><section class="section" id="authenticating-with-the-guest-user-on-an-operator-based-installation_title-authentication"><div class="titlepage"><div><div><h3 class="title">2.1. Authenticating with the Guest user on an Operator-based installation</h3></div></div></div><p>
				For trial or non-production environments installed by using the Red Hat Developer Hub Operator, you can enable guest access to skip configuring authentication and authorization and explore Developer Hub features.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_red_hat_developer_hub/index">added a custom Developer Hub application configuration</a>, and have enough permissions to change it.
					</li><li class="listitem">
						You <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_red_hat_developer_hub/index#using-the-operator-to-run-rhdh-with-your-custom-configurationn">use the Red Hat Developer Hub Operator to run Developer Hub</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Add the following content to the <code class="literal">app-config.yaml</code> file:
					</p><pre class="programlisting language-yaml">auth:
  environment: development
  providers:
    guest:
      dangerouslyAllowOutsideDevelopment: true</pre></li></ul></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Go to the Developer Hub login page.
					</li><li class="listitem">
						To log in with the Guest user account, click <span class="strong strong"><strong>Enter</strong></span> in the <span class="strong strong"><strong>Guest</strong></span> tile.
					</li><li class="listitem">
						In the Developer Hub <span class="strong strong"><strong>Settings</strong></span> page, your profile name is <span class="strong strong"><strong>Guest</strong></span>.
					</li><li class="listitem">
						You can use Developer Hub features.
					</li></ol></div></section><section class="section" id="authenticating-with-the-guest-user-on-a-helm-based-installation_title-authentication"><div class="titlepage"><div><div><h3 class="title">2.2. Authenticating with the Guest user on a Helm-based installation</h3></div></div></div><p>
				For trial or non-production environments installed by using the Red Hat Developer Hub Helm chart, you can enable guest access to skip configuring authentication and authorization and explore Developer Hub features.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_red_hat_developer_hub/index">added a custom Developer Hub application configuration</a>, and have enough permissions to change it.
					</li><li class="listitem">
						You <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_red_hat_developer_hub/index#using-the-helm-chart-to-run-rhdh-with-your-custom-configuration">use the Red Hat Developer Hub Helm chart to run Developer Hub</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Add following content to your Red Hat Developer Hub Helm Chart:
					</p><pre class="programlisting language-yaml">upstream:
  backstage:
    appConfig:
      app:
        baseUrl: 'https://{{- include "janus-idp.hostname" . }}'
      auth:
        environment: development
        providers:
          guest:
            dangerouslyAllowOutsideDevelopment: true</pre></li></ul></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Go to the Developer Hub login page.
					</li><li class="listitem">
						To log in with the Guest user account, click <span class="strong strong"><strong>Enter</strong></span> in the <span class="strong strong"><strong>Guest</strong></span> tile.
					</li><li class="listitem">
						In the Developer Hub <span class="strong strong"><strong>Settings</strong></span> page, your profile name is <span class="strong strong"><strong>Guest</strong></span>.
					</li><li class="listitem">
						You can use Developer Hub features.
					</li></ol></div></section></section><section class="section" id="assembly-authenticating-with-rhbk"><div class="titlepage"><div><div><h2 class="title">3. Authenticating with Red Hat Build of Keycloak (RHBK)</h2></div></div></div><section class="section" id="enabling-user-authentication-with-rhbk-with-optional-steps"><div class="titlepage"><div><div><h3 class="title">3.1. Enabling user authentication with Red Hat Build of Keycloak (RHBK), with optional steps</h3></div></div></div><p>
				Authenticate users with Red Hat Build of Keycloak (RHBK), by provisioning the users and groups from RHBK to the Developer Hub software catalog, and configuring the OpenID Connect (OIDC) authentication provider in Red Hat Developer Hub.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_red_hat_developer_hub/index">added a custom Developer Hub application configuration</a>, and have enough permissions to change it.
					</li><li class="listitem"><p class="simpara">
						You have enough permissions in RHSSO to create and manage a realm and a client.
					</p><div class="admonition tip"><div class="admonition_header">Tip</div><div><p>
						Alternatively, ask your RHBK administrator to prepare in RHBK the required realm and client.
					</p></div></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Register your Developer Hub app in RHBK:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								Use an existing realm, or <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/26.0/html/getting_started_guide/getting-started-zip-#getting-started-zip-create-a-realm">create a realm</a>, with a distinctive <span class="strong strong"><strong>Name</strong></span> such as <span class="emphasis"><em>&lt;my_realm&gt;</em></span>. Save the value for the next step:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>RHBK realm base URL</strong></span>, such as: <span class="emphasis"><em>&lt;your_rhbk_URL&gt;</em></span>/realms/<span class="emphasis"><em>&lt;your_realm&gt;</em></span>.
									</li></ul></div></li><li class="listitem"><p class="simpara">
								To register your Developer Hub in RHBK, in the created realm, <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/26.0/html-single/getting_started_guide/index#getting-started-zip-secure-the-first-application">secure the first application</a>, with:
							</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">
										<span class="strong strong"><strong>Client ID</strong></span>: A distinctive client ID, such as <span class="emphasis"><em>&lt;RHDH&gt;</em></span>.
									</li><li class="listitem">
										<span class="strong strong"><strong>Valid redirect URIs</strong></span>: Set to the OIDC handler URL: <code class="literal">https://<span class="emphasis"><em>&lt;my_developer_hub_domain&gt;</em></span>/api/auth/oidc/handler/frame</code>.
									</li><li class="listitem">
										Go to the <span class="strong strong"><strong>Credentials</strong></span> tab and copy the <span class="strong strong"><strong>Client secret</strong></span>.
									</li><li class="listitem"><p class="simpara">
										Save the values for the next step:
									</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
												<span class="strong strong"><strong>Client ID</strong></span>
											</li><li class="listitem">
												<span class="strong strong"><strong>Client Secret</strong></span>
											</li></ul></div></li></ol></div></li><li class="listitem">
								To prepare for the verification steps, in the same realm, get the credential information for an existing user or <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_build_of_keycloak/26.0/html-single/getting_started_guide/index#getting-started-zip-create-a-user">create a user</a>. Save the user credential information for the verification steps.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						Add your RHSSO credentials to Developer Hub, by adding the following key/value pairs to <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_dynamic_plugins/index#provisioning-your-custom-configuration">your Developer Hub secrets</a>. You can use these secrets in the Developer Hub configuration files by using their environment variable name.
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">KEYCLOAK_CLIENT_ID</code></span></dt><dd>
									Enter the saved <span class="strong strong"><strong>Client ID</strong></span>.
								</dd><dt><span class="term"><code class="literal">KEYCLOAK_CLIENT_SECRET</code></span></dt><dd>
									Enter the saved <span class="strong strong"><strong>Client Secret</strong></span>.
								</dd><dt><span class="term"><code class="literal">KEYCLOAK_BASE_URL</code></span></dt><dd>
									Enter the saved <span class="strong strong"><strong>RHBK realm base URL</strong></span>.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
						Enable the Keycloak catalog provider plugin in your <code class="literal">dynamic-plugins.yaml</code> file.
					</p><p class="simpara">
						The plugin is named after RHBK upstream project.
					</p><p class="simpara">
						This plugin imports RHBK users and groups to the Developer Hub software catalog.
					</p><pre class="programlisting language-yaml">plugins:
  - package: './dynamic-plugins/dist/backstage-plugin-catalog-backend-module-keycloak-dynamic'
    disabled: false</pre></li><li class="listitem"><p class="simpara">
						Enable provisioning RHBK users and groups to the Developer Hub software catalog, by adding the <code class="literal">catalog.providers.keycloakOrg</code> section to your <code class="literal">app-config.yaml</code> file:
					</p><pre class="programlisting language-yaml" id="keycloakOrgProviderId">catalog:
  providers:
    keycloakOrg:
      default:
        baseUrl: ${KEYCLOAK_BASE_URL}
        clientId: ${KEYCLOAK_CLIENT_ID}
        clientSecret: ${KEYCLOAK_CLIENT_SECRET}
        realm: master
        loginRealm: master</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">baseUrl</code></span></dt><dd>
									Enter your RHBK server URL, defined earlier.
								</dd><dt><span class="term"><code class="literal">clientId</code></span></dt><dd>
									Enter your Developer Hub application client ID in RHBK, defined earlier.
								</dd><dt><span class="term"><code class="literal">clientSecret</code></span></dt><dd>
									Enter your Developer Hub application client secret in RHBK, defined earlier.
								</dd><dt><span class="term"><code class="literal">realm</code></span></dt><dd>
									Enter the realm name to provision users, such as <code class="literal">master</code>.
								</dd><dt><span class="term"><code class="literal">loginRealm</code></span></dt><dd>
									Enter the realm name to authenticate users, such as <code class="literal">master</code>.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
					</p><p class="simpara">
						Optional: Add optional fields to the keycloackOrg catalog provider section in your <code class="literal">app-config.yaml</code> file:
					</p><pre class="programlisting language-yaml">catalog:
  providers:
    keycloakOrg:
      default:
        baseUrl: ${KEYCLOAK_BASE_URL}
        clientId: ${KEYCLOAK_CLIENT_ID}
        clientSecret: ${KEYCLOAK_CLIENT_SECRET}
        realm: master
        loginRealm: master
        userQuerySize: 100
        groupQuerySize: 100
        schedule:
          frequency: { hours: 1 }
          timeout: { minutes: 50 }
          initialDelay: { seconds: 15}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">userQuerySize</code></span></dt><dd>
									Enter the user count to query simultaneously. Default value: <code class="literal">100</code>.
								</dd><dt><span class="term"><code class="literal">groupQuerySize</code></span></dt><dd>
									Enter the group count to query simultaneously. Default value: <code class="literal">100</code>.
								</dd><dt><span class="term"><code class="literal">schedule</code></span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">frequency</code></span></dt><dd>
												Enter the schedule frequency. Supports cron, ISO duration, and "human duration" as used in code.
											</dd><dt><span class="term"><code class="literal">timeout</code></span></dt><dd>
												Enter the timeout for the user provisioning job. Supports ISO duration and "human duration" as used in code.
											</dd><dt><span class="term"><code class="literal">initialDelay</code></span></dt><dd>
												Enter the initial delay to wait for before starting the user provisioning job. Supports ISO duration and "human duration" as used in code.
											</dd></dl></div></dd></dl></div></li><li class="listitem"><p class="simpara">
					</p><p class="simpara">
						Enable the RHBK authentication provider, by adding the OIDC provider section in your <code class="literal">app-config.yaml</code> file:
					</p><pre class="programlisting language-yaml">auth:
  environment: production
  providers:
    oidc:
      production:
        metadataUrl: ${KEYCLOAK_BASE_URL}
        clientId: ${KEYCLOAK_CLIENT_ID}
        clientSecret: ${KEYCLOAK_CLIENT_SECRET}
        prompt: auto
signInPage: oidc</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">environment: production</code></span></dt><dd>
									Mark the environment as <code class="literal">production</code> to hide the Guest login in the Developer Hub home page.
								</dd><dt><span class="term"><code class="literal">metadataUrl</code>, <code class="literal">clientId</code>, <code class="literal">clientSecret</code></span></dt><dd>
									Configure the OIDC provider with your secrets.
								</dd><dt><span class="term"><code class="literal">prompt</code></span></dt><dd><p class="simpara">
									Enter <code class="literal">auto</code> to allow the identity provider to automatically determine whether to prompt for credentials or bypass the login redirect if an active RHSSO session exists.
								</p><p class="simpara">
									The identity provider defaults to <code class="literal">none</code>, which assumes that you are already logged in. Sign-in requests without an active session are rejected.
								</p></dd><dt><span class="term"><code class="literal">signInPage</code></span></dt><dd>
									Enter <code class="literal">oidc</code> to enable the OIDC provider as default sign-in provider.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
					</p><p class="simpara">
						Optional: Add optional fields to the OIDC authentication provider section in your <code class="literal">app-config.yaml</code> file:
					</p><pre class="programlisting language-yaml">auth:
  providers:
    oidc:
      production:
        metadataUrl: ${KEYCLOAK_BASE_URL}
        clientId: ${KEYCLOAK_CLIENT_ID}
        clientSecret: ${KEYCLOAK_CLIENT_SECRET}
        callbackUrl: ${KEYCLOAK_CALLBACK_URL}
        tokenEndpointAuthMethod: ${KEYCLOAK_TOKEN_ENDPOINT_METHOD}
        tokenSignedResponseAlg: ${KEYCLOAK_SIGNED_RESPONSE_ALG}
        additionalScopes: ${KEYCLOAK_SCOPE}
        signIn:
          resolvers:
            - resolver: oidcSubClaimMatchingKeycloakUserId
            - resolver: preferredUsernameMatchingUserEntityName
            - resolver: emailMatchingUserEntityProfileEmail
            - resolver: emailLocalPartMatchingUserEntityName
              dangerouslyAllowSignInWithoutUserInCatalog: true
        sessionDuration: { hours: 24 }
  backstageTokenExpiration: { minutes: _&lt;user_defined_value&gt;_ }
signInPage: oidc</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">callbackUrl</code></span></dt><dd>
									RHBK callback URL.
								</dd><dt><span class="term"><code class="literal">tokenEndpointAuthMethod</code></span></dt><dd>
									Enter your token endpoint authentication method.
								</dd><dt><span class="term"><code class="literal">tokenSignedResponseAlg</code></span></dt><dd>
									Token signed response algorithm.
								</dd><dt><span class="term"><code class="literal">additionalScopes</code></span></dt><dd>
									Enter additional RHBK scopes to request for during the authentication flow.
								</dd><dt><span class="term"><code class="literal">signIn</code></span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">resolvers</code></span></dt><dd><p class="simpara">
												After successful authentication, the user signing in must be resolved to an existing user in the Developer Hub catalog. To best match users securely for your use case, consider configuring a specific resolver.
											</p><p class="simpara">
												Enter the resolver list to override the default resolver: <code class="literal">oidcSubClaimMatchingKeycloakUserId</code>.
											</p><p class="simpara">
												Available values:
											</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">oidcSubClaimMatchingKeycloakUserId</code></span></dt><dd>
															Matches the user with the immutable <code class="literal">sub</code> parameter from OIDC to the RHBK user ID. Consider using this resolver for enhanced security.
														</dd><dt><span class="term"><code class="literal">emailLocalPartMatchingUserEntityName</code></span></dt><dd>
															Matches the email local part with the user entity name.
														</dd><dt><span class="term"><code class="literal">emailMatchingUserEntityProfileEmail</code></span></dt><dd>
															Matches the email with the user entity profile email.
														</dd><dt><span class="term"><code class="literal">preferredUsernameMatchingUserEntityName</code></span></dt><dd><p class="simpara">
															Matches the preferred username with the user entity name.
														</p><p class="simpara">
															The authentication provider tries each sign-in resolver in order until it succeeds, and fails if none succeed.
														</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
																In production mode, configure only one resolver to make sure users are securely matched.
															</p></div></div></dd><dt><span class="term"><code class="literal">dangerouslyAllowSignInWithoutUserInCatalog: true</code></span></dt><dd><p class="simpara">
															Configure the sign-in resolver to bypass the user provisioning requirement in the Developer Hub software catalog.
														</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
																In production mode, do not enable the <code class="literal">dangerouslyAllowSignInWithoutUserInCatalog</code> option.
															</p></div></div></dd></dl></div></dd></dl></div></dd><dt><span class="term"><code class="literal">sessionDuration</code></span></dt><dd>
									Lifespan of the user session. Enter a duration in <code class="literal">ms</code> library format (such as '24h', '2 days'), ISO duration, or "human duration" as used in code.
								</dd><dt><span class="term"><code class="literal">backstageTokenExpiration</code></span></dt><dd><p class="simpara">
									Enter a value to modify the Developer Hub token expiration from its default value of one hour. It refers to the validity of short-term cryptographic tokens, not to the session duration. The expiration value must be set between 10 minutes and 24 hours.
								</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
										If multiple valid refresh tokens are issued due to frequent refresh token requests, older tokens will remain valid until they expire. Enhance security and prevent potential misuse of older tokens by enabling a refresh token rotation strategy in your RHBK realm.
									</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
												From the <span class="strong strong"><strong>Configure</strong></span> section of the navigation menu, click <span class="strong strong"><strong>Realm Settings</strong></span>.
											</li><li class="listitem">
												From the <span class="strong strong"><strong>Realm Settings</strong></span> page, click the <span class="strong strong"><strong>Tokens</strong></span> tab.
											</li><li class="listitem">
												From the <span class="strong strong"><strong>Refresh tokens</strong></span> section of the <span class="strong strong"><strong>Tokens</strong></span> tab, toggle the <span class="strong strong"><strong>Revoke Refresh Token</strong></span> to the <span class="strong strong"><strong>Enabled</strong></span> position.
											</li></ol></div></div></div></dd></dl></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						To verify user and group provisioning, check the console logs.
					</p><p class="simpara">
						Successful synchronization example:
					</p><pre class="screen">2025-06-27T16:02:34.647Z catalog info Read 5 Keycloak users and 3 Keycloak groups in 0.4 seconds. Committing... class="KeycloakOrgEntityProvider" taskId="KeycloakOrgEntityProvider:default:refresh" taskInstanceId="db55c34b-46b3-402b-b12f-2fbc48498e82" trace_id="606f80a9ce00d1c86800718c4522f7c6" span_id="7ebc2a254a546e90" trace_flags="01"

2025-06-27T16:02:34.650Z catalog info Committed 5 Keycloak users and 3 Keycloak groups in 0.0 seconds. class="KeycloakOrgEntityProvider" taskId="KeycloakOrgEntityProvider:default:refresh" taskInstanceId="db55c34b-46b3-402b-b12f-2fbc48498e82" trace_id="606f80a9ce00d1c86800718c4522f7c6" span_id="7ebc2a254a546e90" trace_flags="01"</pre></li><li class="listitem"><p class="simpara">
						To verify RHBK user authentication:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Go to the Developer Hub login page.
							</li><li class="listitem">
								Your Developer Hub sign-in page displays <span class="strong strong"><strong>Sign in using OIDC</strong></span> and the Guest user sign-in is disabled.
							</li><li class="listitem">
								Log in with OIDC by using the saved <span class="strong strong"><strong>Username</strong></span> and <span class="strong strong"><strong>Password</strong></span> values.
							</li></ol></div></li></ol></div></section><section class="section" id="enabling-user-provisioning-with-ldap"><div class="titlepage"><div><div><h3 class="title">3.2. Enabling user provisioning with LDAP</h3></div></div></div><p>
				When Red Hat Build of Keycloak (RHBK) depends on Lightweight Directory Access Protocol (LDAP) to resolve user and group identities, you can opt to provision users and groups from LDAP directly to the Red Hat Developer Hub software catalog, rather than using the RHBK provisioning mechanism.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have configured <a class="link" href="#assembly-authenticating-with-rhbk" title="3. Authenticating with Red Hat Build of Keycloak (RHBK)">authentication with Red Hat Build of Keycloak (RHBK)</a>.
					</li><li class="listitem"><p class="simpara">
						You have collected the required LDAP credentials:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">LDAP URL</span></dt><dd>
									Your LDAP server URL, such as <code class="literal">ldaps://ds.example.net</code>.
								</dd><dt><span class="term">Bind dn</span></dt><dd>
									Your bind distinguished name, such as <code class="literal">cn=admin,OU=Users,DC=rhdh,DC=test</code>
								</dd><dt><span class="term">LDAP secret</span></dt><dd>
									Your LDAP secret.
								</dd><dt><span class="term">Recommended: LDAP certificates and keys</span></dt><dd><p class="simpara">
									To use a secure LDAP connexion (<code class="literal">ldaps://</code>): you stored your LDAP certificates and keys respectively in the <code class="literal">ldap_certs.pem</code> and <code class="literal">ldap_keys.pem</code> files.
								</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
										In production mode, use a secure LDAP connexion.
									</p></div></div></dd></dl></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Enter your LDAP credentials to Developer Hub, by adding the <code class="literal">LDAP_SECRET</code> environment variable to <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_red_hat_developer_hub/index#provisioning-your-custom-configuration">your Developer Hub secrets</a>.
					</p><pre class="screen">$ oc patch secret my-rhdh-secrets --patch '{"stringData": { "LDAP_SECRET": "&lt;ldap_secret&gt;" }}'</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em>&lt;ldap_secret&gt;</em></span></span></dt><dd>
									Enter your LDAP secret.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
						Recommended: To use a secure LDAP connection (<code class="literal">ldaps://</code>), add your LDAP certificates and keys files to a {a-platform-generic} secret.
					</p><pre class="screen">$ oc create secret generic my-rhdh-ldap-secrets \
    --from-file=./ldap_certs.pem \
    --from-file=./ldap_keys.pem</pre></li><li class="listitem"><p class="simpara">
						Enable the LDAP catalog provider plugin in your <code class="literal">dynamic-plugins.yaml</code> file.
					</p><pre class="programlisting language-yaml">plugins:
  - package: './dynamic-plugins/dist/backstage-plugin-catalog-backend-module-ldap-dynamic'
    disabled: false</pre></li><li class="listitem"><p class="simpara">
						Enable provisioning GitHub users and groups to the Developer Hub software catalog, by adding the LDAP catalog provider section to your <code class="literal">app-config.yaml</code> file:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Optional: Remove other catalog providers, by removing the other catalog providers section.
							</li><li class="listitem"><p class="simpara">
								Enter the mandatory fields:
							</p><pre class="programlisting language-yaml">catalog:
  providers:
    ldapOrg:
      default:
        target: ldaps://ds.example.net
        bind:
          dn: cn=admin,ou=Users,dc=rhdh
          secret: ${LDAP_SECRET}
        users:
          - dn: OU=Users,OU=RHDH Local,DC=rhdh,DC=test
            options:
              filter: (uid=*)
        groups:
          - dn: OU=Groups,OU=RHDH Local,DC=rhdh,DC=test
        schedule:
          frequency: PT1H
          timeout: PT15M</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">target</code></span></dt><dd>
											Enter your LDAP server URL, such as <code class="literal">ldaps://ds.example.net</code>.
										</dd><dt><span class="term"><code class="literal">bind</code></span></dt><dd><p class="simpara">
											Enter your service account informations:
										</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">dn</code></span></dt><dd>
														Enter your service account distinguished name (DN), such as <code class="literal">cn=admin,OU=Users,DC=rhdh,DC=test</code>
													</dd><dt><span class="term"><code class="literal">secret</code></span></dt><dd>
														Enter the name of the variable containing your LDAP secret: <code class="literal">${LDAP_SECRET}</code>.
													</dd></dl></div></dd><dt><span class="term"><code class="literal">users</code></span></dt><dd><p class="simpara">
											Enter information about how to find your users:
										</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">dn</code></span></dt><dd>
														Enter the DN containing the user information.
													</dd><dt><span class="term"><code class="literal">options</code></span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">filter</code></span></dt><dd>
																	Enter your filter, such as <code class="literal">(uid=*)</code> to provision to the RHDH software catalog only users with an existing <code class="literal">uid</code>.
																</dd></dl></div></dd></dl></div></dd><dt><span class="term"><code class="literal">groups</code></span></dt><dd><p class="simpara">
											Enter information about how to find your groups:
										</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">dn</code></span></dt><dd>
														Enter the DN containing the group information.
													</dd></dl></div></dd><dt><span class="term"><code class="literal">schedule</code></span></dt><dd><p class="simpara">
											Enter your schedule information:
										</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">frequency</code></span></dt><dd>
														Enter your schedule frequency, in the cron, ISO duration, or "human duration" format.
													</dd><dt><span class="term"><code class="literal">timeout</code></span></dt><dd>
														Enter your schedule timeout, in the ISO duration or "human duration" format.
													</dd><dt><span class="term"><code class="literal">initialDelay</code></span></dt><dd>
														Enter your schedule initial delay, in the ISO duration or "human duration" format.
													</dd></dl></div></dd></dl></div></li><li class="listitem"><p class="simpara">
								Optional: To change how Developer Hub maps LDAP user fields to the software catalog, enter optional <code class="literal">maps</code> and <code class="literal">set</code> fields.
							</p><pre class="programlisting language-yaml">catalog:
  providers:
    ldapOrg:
      default:
        target: ldaps://ds.example.net
        bind:
          dn: cn=admin,ou=Users,dc=rhdh
          secret: ${LDAP_SECRET}
        users:
          - dn: OU=Users,OU=RHDH Local,DC=rhdh,DC=test
            options:
              filter: (uid=*)
            map:
              rdn: uid
              name: uid
              description: {}
              displayName: cn
              email: mail
              picture: {}
              memberOf: memberOf
            set:
              metadata.customField: 'hello'
        groups:
          - dn: OU=Groups,OU=RHDH Local,DC=rhdh,DC=test
        schedule:
          frequency: PT1H
          timeout: PT15M</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">rdn</code></span></dt><dd>
											To change the default value: <code class="literal">uid</code>, enter the relative distinguished name of each entry.
										</dd><dt><span class="term"><code class="literal">name</code></span></dt><dd>
											To change the default value: <code class="literal">uid</code>, enter the LDAP field to map to the RHDH <code class="literal">metadata.name</code> field.
										</dd><dt><span class="term"><code class="literal">description</code></span></dt><dd>
											To set a value, enter the LDAP field to map to the RHDH <code class="literal">metadata.description</code> field.
										</dd><dt><span class="term"><code class="literal">displayName</code></span></dt><dd>
											To change the default value: <code class="literal">cn</code>, enter the LDAP field to map to the RHDH <code class="literal">metadata.displayName</code> field.
										</dd><dt><span class="term"><code class="literal">email</code></span></dt><dd>
											To change the default value: <code class="literal">mail</code>, enter the LDAP field to map to the RHDH <code class="literal">spec.profile.email</code> field.
										</dd><dt><span class="term"><code class="literal">picture</code></span></dt><dd>
											To set a value, enter the LDAP field to map to the RHDH <code class="literal">spec.profile.picture</code> field.
										</dd><dt><span class="term"><code class="literal">memberOf</code></span></dt><dd>
											To change the default value: <code class="literal">memberOf</code>, enter the LDAP field to map to the RHDH <code class="literal">spec.memberOf</code> field.
										</dd><dt><span class="term"><code class="literal">set</code></span></dt><dd>
											To set a value, enter the hard coded JSON to apply to the entities after ingestion, such as <code class="literal">metadata.customField: 'hello'</code>.
										</dd></dl></div></li><li class="listitem"><p class="simpara">
								Optional: To change how Developer Hub maps LDAP group fields to the software catalog, enter optional <code class="literal">groups.maps</code> fields.
							</p><pre class="programlisting language-yaml">catalog:
  providers:
    ldapOrg:
      default:
        target: ldaps://ds.example.net
        bind:
          dn: cn=admin,ou=Users,dc=rhdh
          secret: ${LDAP_SECRET}
        users:
          - dn: OU=Users,OU=RHDH Local,DC=rhdh,DC=test
            options:
              filter: (uid=*)
        groups:
          - dn: OU=Groups,OU=RHDH Local,DC=rhdh,DC=test
            map:
              rdn: uid
              name: uid
              description: {}
              displayName: cn
              email: mail
              picture: {}
              memberOf: memberOf
              members: member
              type: groupType
            set:
              metadata.customField: 'hello'
        schedule:
          frequency: PT1H
          timeout: PT15M</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">rdn</code></span></dt><dd>
											To change the default value: <code class="literal">cn</code>, enter the relative distinguished name of each entry.
										</dd><dt><span class="term"><code class="literal">name</code></span></dt><dd>
											To change the default value: <code class="literal">cn</code>, enter the LDAP field to map to the RHDH <code class="literal">metadata.name</code> field.
										</dd><dt><span class="term"><code class="literal">description</code></span></dt><dd>
											To set a value, enter the LDAP field to map to the RHDH <code class="literal">metadata.description</code> field.
										</dd><dt><span class="term"><code class="literal">displayName</code></span></dt><dd>
											To change the default value: <code class="literal">cn</code>, enter the LDAP field to map to the RHDH <code class="literal">metadata.displayName</code> field.
										</dd><dt><span class="term"><code class="literal">email</code></span></dt><dd>
											To change the default value: <code class="literal">mail</code>, enter the LDAP field to map to the RHDH <code class="literal">spec.profile.email</code> field.
										</dd><dt><span class="term"><code class="literal">picture</code></span></dt><dd>
											To set a value, enter the LDAP field to map to the RHDH <code class="literal">spec.profile.picture</code> field.
										</dd><dt><span class="term"><code class="literal">memberOf</code></span></dt><dd>
											To change the default value: <code class="literal">memberOf</code>, enter the LDAP field to map to the RHDH <code class="literal">spec.memberOf</code> field.
										</dd><dt><span class="term"><code class="literal">members</code></span></dt><dd>
											To change the default value: <code class="literal">member</code>, enter the LDAP field to map to the RHDH <code class="literal">spec.children</code> field.
										</dd><dt><span class="term"><code class="literal">type</code></span></dt><dd>
											To change the default value: <code class="literal">groupType</code>, enter the LDAP field to map to the RHDH <code class="literal">spec.type</code> field.
										</dd><dt><span class="term"><code class="literal">set</code></span></dt><dd>
											To set a value, enter the hard coded JSON to apply to the entities after ingestion, such as <code class="literal">metadata.customField: 'hello'</code>.
										</dd></dl></div></li><li class="listitem"><p class="simpara">
								Recommended: To use a secure LDAP connection (<code class="literal">ldaps://</code>), enter optional <code class="literal">tls</code> fields.
							</p><div class="formalpara"><p class="title"><strong>Optional <code class="literal">tls</code> fields</strong></p><p>
									
<pre class="programlisting language-yaml">catalog:
  providers:
    ldapOrg:
      default:
        target: ldaps://ds.example.net
        bind:
          dn: cn=admin,ou=Users,dc=rhdh
          secret: ${LDAP_SECRET}
        users:
ldapOrg:
  default:
    tls:
      rejectUnauthorized: true
      keys: '/path/to/keys.pem'
      certs: '/path/to/certs.pem'</pre>
								</p></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">rejectUnauthorized</code></span></dt><dd><p class="simpara">
											Set to <code class="literal">false</code> to allow self-signed certificates
										</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
												This option is not recommended for production.
											</p></div></div></dd><dt><span class="term"><code class="literal">keys</code></span></dt><dd>
											Enter a file containing private keys in PEM format
										</dd><dt><span class="term"><code class="literal">certs</code></span></dt><dd>
											Enter a file containing cert chains in PEM format
										</dd></dl></div></li><li class="listitem"><p class="simpara">
								Optional: Enter configuration for vendor-specific attributes to set custom attribute names for distinguished names (DN) and universally unique identifiers (UUID) in LDAP directories. Default values are defined per supported vendor and automatically detected.
							</p><pre class="programlisting language-yaml">catalog:
  providers:
    ldapOrg:
      default:
        vendor:
          dnAttributeName: customDN
          uuidAttributeName: customUUID</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">dnAttributeName</code></span></dt><dd>
											Enter the attribute name that holds the distinguished name (DN) for an entry.
										</dd><dt><span class="term"><code class="literal">uuidAttributeName</code></span></dt><dd>
											Enter the attribute name that holds a universal unique identifier (UUID) for an entry.
										</dd></dl></div></li><li class="listitem"><p class="simpara">
								Optional: Enter low level users and groups configuration in the <code class="literal">options</code> subsection.
							</p><pre class="programlisting language-yaml">catalog:
  providers:
    ldapOrg:
      default:
        target: ldaps://ds.example.net
        bind:
          dn: cn=admin,ou=Users,dc=rhdh
          secret: ${LDAP_SECRET}
        users:
          options:
            scope: sub
            filter: (uid=*)
            attributes:
              - cn
              - uid
              - description
            paged:
            pageSize: 500
        groups:
          options:
            scope: sub
            filter: (cn=*)
            attributes:
              - cn
              - uid
              - description
            paged:
              pageSize: 500
              pagePause: true</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">scope</code></span></dt><dd><p class="simpara">
											To change the default value: <code class="literal">one</code>, enter how deep the search should go within the directory tree:
										</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
													<code class="literal">base</code> to search only the base DN.
												</li><li class="listitem">
													<code class="literal">one</code> to search one level below the base DN.
												</li><li class="listitem">
													<code class="literal">sub</code> to search all descendant entries.
												</li></ul></div></dd><dt><span class="term"><code class="literal">filter</code></span></dt><dd><p class="simpara">
											To change the default value: <code class="literal">(objectclass=*)</code>, enter your LDAP filter. With the default mapping:
										</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
													For users, enter <code class="literal">(uid=*)</code> to make sure only users with valid uid field is synced, since users without uid will cause error and ingestion fails.
												</li><li class="listitem"><p class="simpara">
													For groups, enter <code class="literal">(cn=*)</code>
												</p><div class="admonition tip"><div class="admonition_header">Tip</div><div><p>
													When you change the mapping, also update the filter.
												</p></div></div></li></ul></div></dd><dt><span class="term"><code class="literal">attributes</code></span></dt><dd>
											To change the default value: all attributes <code class="literal">['*', '+']</code>, enter the array of attribute names to import from LDAP.
										</dd><dt><span class="term"><code class="literal">paged</code></span></dt><dd><p class="simpara">
											Enter a value to enable paged results.
										</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">pageSize</code></span></dt><dd>
														Enter a value to set the results page size, such as <code class="literal">500</code>.
													</dd><dt><span class="term"><code class="literal">pagePause</code></span></dt><dd>
														Enter <code class="literal">true</code> to tell the client to wait for the asynchronous results of the next page, when the page limit has been reached.
													</dd></dl></div></dd></dl></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Recommended: To use a secure LDAP connection (<code class="literal">ldaps://</code>), mount your LDAP certificates and keys files in your Developer Hub deployment, by editing your Backstage custom resource.
					</p><pre class="screen">kind: Backstage
spec:
  application:
    extraFiles:
      mountPath: /opt/ldap-secrets
      secrets:
        - name: my-rhdh-database-database-secrets
          key: ldap-certs.pem, ldap-keys.pem</pre></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To verify user and group provisioning, check the console logs.
					</p><p class="simpara">
						Successful synchronization example:
					</p><pre class="programlisting language-json">2025-10-15T20:45:49.072Z catalog info Read 4 LDAP users and 6 LDAP groups in 0.3 seconds. Committing... class="LdapOrgEntityProvider" taskId="LdapOrgEntityProvider:default:refresh" taskInstanceId="9bb48fd5-2f55-4096-9fd0-61cee6679952" trace_id="6a318e2eadba84e20df773948668aa4c" span_id="cbec568cb6e64985" trace_flags="01"
2025-10-15T20:45:49.075Z catalog info Committed 4 LDAP users and 6 LDAP groups in 0.0 seconds. class="LdapOrgEntityProvider" taskId="LdapOrgEntityProvider:default:refresh" taskInstanceId="9bb48fd5-2f55-4096-9fd0-61cee6679952" trace_id="6a318e2eadba84e20df773948668aa4c" span_id="cbec568cb6e64985" trace_flags="01"</pre></li></ul></div></section><section class="section" id="creating-a-custom-transformer-to-provision-users-from-rhbk-to-the-software-catalog"><div class="titlepage"><div><div><h3 class="title">3.3. Creating a custom transformer to provision users from Red Hat Build of Keycloak (RHBK) to the software catalog</h3></div></div></div><p>
				Customize how Red Hat Developer Hub provisions users and groups to Red Hat Developer Hub software catalog entities, by creating a backend module that uses the <code class="literal">keycloakTransformerExtensionPoint</code> to offer custom user and group transformers for the Keycloak backend.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have <a class="link" href="#enabling-user-authentication-with-rhbk-with-optional-steps" title="3.1. Enabling user authentication with Red Hat Build of Keycloak (RHBK), with optional steps">enabled provisioning users from Red Hat Build of Keycloak (RHBK) to the software catalog</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Create a new backend module with the <code class="literal">yarn new</code> command.
					</li><li class="listitem"><p class="simpara">
						Add your custom user and group transformers to the <code class="literal">keycloakTransformerExtensionPoint</code>.
					</p><p class="simpara">
						The following is an example <code class="literal">plugins/<span class="emphasis"><em>&lt;module_name&gt;</em></span>/src/module.ts</code> file defining the backend module:
					</p><pre class="programlisting language-javascript">import {
  GroupTransformer,
  keycloakTransformerExtensionPoint,
  UserTransformer,
} from '@backstage-community/plugin-catalog-backend-module-keycloak';

const customGroupTransformer: GroupTransformer = async (
  entity, // entity output from default parser
  realm, // Keycloak realm name
  groups, // Keycloak group representation
) =&gt; {
  /* apply transformations */
  return entity;
};
const customUserTransformer: UserTransformer = async (
  entity, // entity output from default parser
  user, // Keycloak user representation
  realm, // Keycloak realm name
  groups, // Keycloak group representation
) =&gt; {
  /* apply transformations */
  return entity;
};

export const keycloakBackendModuleTransformer = createBackendModule({
  pluginId: 'catalog',
  moduleId: 'keycloak-transformer',
  register(reg) {
    reg.registerInit({
      deps: {
        keycloak: keycloakTransformerExtensionPoint,
      },
      async init({ keycloak }) {
        keycloak.setUserTransformer(customUserTransformer);
        keycloak.setGroupTransformer(customGroupTransformer);
        /* highlight-add-end */
      },
    });
  },
});</pre><div class="admonition important"><div class="admonition_header">Important</div><div><p>
							Set the module’s <code class="literal">pluginId</code> to <code class="literal">catalog</code> to match the <code class="literal">pluginId</code> of the <code class="literal">keycloak-backend</code>; otherwise, the module fails to initialize.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Install this new backend module into your Developer Hub backend.
					</p><pre class="programlisting language-javascript">backend.add(import(backstage-plugin-catalog-backend-module-keycloak-transformer))</pre></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Developer Hub imports the users and groups each time when started. Check the console logs to verify the synchronization result.
					</p><p class="simpara">
						Successful synchronization example:
					</p><pre class="programlisting language-json">{"class":"KeycloakOrgEntityProvider","level":"info","message":"Read 3 Keycloak users and 2 Keycloak groups in 1.5 seconds. Committing...","plugin":"catalog","service":"backstage","taskId":"KeycloakOrgEntityProvider:default:refresh","taskInstanceId":"bf0467ff-8ac4-4702-911c-380270e44dea","timestamp":"2024-09-25 13:58:04"}
{"class":"KeycloakOrgEntityProvider","level":"info","message":"Committed 3 Keycloak users and 2 Keycloak groups in 0.0 seconds.","plugin":"catalog","service":"backstage","taskId":"KeycloakOrgEntityProvider:default:refresh","taskInstanceId":"bf0467ff-8ac4-4702-911c-380270e44dea","timestamp":"2024-09-25 13:58:04"}</pre></li><li class="listitem">
						After the first import is complete, go to the <span class="strong strong"><strong>Catalog</strong></span> page and select <span class="strong strong"><strong>User</strong></span> to view the list of users.
					</li><li class="listitem">
						When you select a user, you see the information imported from RHBK.
					</li><li class="listitem">
						You can select a group, view the list, and access or review the information imported from RHBK.
					</li><li class="listitem">
						You can log in with an RHBK account.
					</li></ul></div></section></section><section class="section" id="enabling-authentication-with-github"><div class="titlepage"><div><div><h2 class="title">4. Enabling authentication with GitHub</h2></div></div></div><section class="section" id="enabling-user-authentication-with-github-with-optional-steps"><div class="titlepage"><div><div><h3 class="title">4.1. Enabling user authentication with GitHub, with optional steps</h3></div></div></div><p>
				Authenticate users with GitHub by provisioning the users and groups from GitHub to the Developer Hub software catalog, and configuring the GitHub authentication provider in Red Hat Developer Hub.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						You have enough permissions in GitHub to create and manage a <a class="link" href="https://docs.github.com/en/apps/overview">GitHub App</a>.
					</p><div class="admonition tip"><div class="admonition_header">Tip</div><div><p>
						Alternatively, ask your GitHub administrator to prepare the required GitHub App.
					</p></div></div></li><li class="listitem">
						You have <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_red_hat_developer_hub/index">added a custom Developer Hub application configuration</a>, and have enough permissions to change it.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Allow Developer Hub to authenticate with GitHub, by creating a GitHub App.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Use a GitHub App instead of an OAuth app to use fine-grained permissions, use short-lived tokens, scale with the number of installations by avoiding rate limits, and have a more transparent integration by avoiding to request user input.
						</p></div></div><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								<a class="link" href="https://docs.github.com/en/apps/creating-github-apps/registering-a-github-app/registering-a-github-app">Register a GitHub App</a> with the following configuration:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">GitHub App name</span></dt><dd>
											Enter a unique name identifying your GitHub App, such as <code class="literal">authenticating-with-rhdh-<span class="emphasis"><em>&lt;GUID&gt;</em></span></code>.
										</dd><dt><span class="term">Homepage URL</span></dt><dd>
											Enter your Developer Hub URL: <code class="literal">https://<span class="emphasis"><em>&lt;my_developer_hub_domain&gt;</em></span></code>.
										</dd><dt><span class="term">Authorization callback URL</span></dt><dd>
											Enter your Developer Hub authentication backend URL: <code class="literal">https://<span class="emphasis"><em>&lt;my_developer_hub_domain&gt;</em></span>/api/auth/github/handler/frame</code>.
										</dd><dt><span class="term">Webhook</span></dt><dd>
											Clear "Active".
										</dd><dt><span class="term">Organization permissions</span></dt><dd>
											Enable <code class="literal">Read-only</code> access to <span class="strong strong"><strong>Members</strong></span>.
										</dd><dt><span class="term">Where can this GitHub App be installed?</span></dt><dd>
											Select <code class="literal">Only on this account</code>.
										</dd></dl></div></li><li class="listitem">
								In the <span class="strong strong"><strong>General</strong></span> → <span class="strong strong"><strong>Clients secrets</strong></span> section, click <span class="strong strong"><strong>Generate a new client secret</strong></span>.
							</li><li class="listitem">
								In the <span class="strong strong"><strong>Install App</strong></span> tab, choose an account to install your GitHub App on.
							</li><li class="listitem"><p class="simpara">
								Save the following values for the next step:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>Client ID</strong></span>
									</li><li class="listitem">
										<span class="strong strong"><strong>Client secret</strong></span>
									</li></ul></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Add your GitHub credentials to Developer Hub by adding the following key/value pairs to <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_red_hat_developer_hub/index#provisioning-your-custom-configuration">your Developer Hub secrets</a>. You can use these secrets in the Developer Hub configuration files by using their environment variable name.
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">GITHUB_CLIENT_ID</code></span></dt><dd>
									Enter the saved <span class="strong strong"><strong>Client ID</strong></span>.
								</dd><dt><span class="term"><code class="literal">GITHUB_CLIENT_SECRET</code></span></dt><dd>
									Enter the saved <span class="strong strong"><strong>Client Secret</strong></span>.
								</dd><dt><span class="term"><code class="literal">GITHUB_URL</code></span></dt><dd>
									Enter the GitHub host domain: <code class="literal">github.com</code>.
								</dd><dt><span class="term"><code class="literal">GITHUB_ORG</code></span></dt><dd>
									Enter your GitHub organization name, such as <code class="literal"><span class="emphasis"><em>&lt;your_github_organization_name&gt;</em></span></code>.
								</dd></dl></div></li><li class="listitem"><p class="simpara">
						Enable the GitHub catalog provider plugin in your <code class="literal">dynamic-plugins.yaml</code> file to import GitHub users and groups to the Developer Hub software catalog.
					</p><pre class="programlisting language-yaml">plugins:
  - package: './dynamic-plugins/dist/backstage-plugin-catalog-backend-module-github-org'
    disabled: false</pre></li><li class="listitem"><p class="simpara">
						Enable provisioning GitHub users and groups to the Developer Hub software catalog by adding the GitHub catalog provider section to your <code class="literal">app-config.yaml</code> file:
					</p><pre class="programlisting language-yaml" id="githubProviderId">catalog:
  providers:
    githubOrg:
      id: githuborg
      githubUrl: "${GITHUB_URL}"
      orgs: [ "${GITHUB_ORG}" ]
      schedule:
        frequency:
          minutes: 30
        initialDelay:
          seconds: 15
        timeout:
          minutes: 15</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">id</code></span></dt><dd>
									Enter a stable identifier for this provider, such as <code class="literal">githuborg</code>.
								</dd></dl></div></li></ol></div><div class="informalexample"><p>
				Entities from this provider are associated with this identifier. Therefore, do not to change the identifier over time since that might lead to orphaned entities or conflicts.
			</p></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">githubUrl</code></span></dt><dd>
							Enter the configured secret variable name: <code class="literal">${GITHUB_URL}</code>.
						</dd><dt><span class="term"><code class="literal">orgs</code></span></dt><dd>
							Enter the configured secret variable name: <code class="literal">${GITHUB_ORG}</code>.
						</dd><dt><span class="term"><code class="literal">schedule.frequency</code></span></dt><dd>
							Enter your schedule frequency, in the cron, ISO duration, or "human duration" format.
						</dd><dt><span class="term"><code class="literal">schedule.timeout</code></span></dt><dd>
							Enter your schedule timeout, in the ISO duration or "human duration" format.
						</dd><dt><span class="term"><code class="literal">schedule.initialDelay</code></span></dt><dd><p class="simpara">
							Enter your schedule initial delay, in the ISO duration or "human duration" format.
						</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
									Enable the GitHub authentication provider, by adding the GitHub authentication provider section to your <code class="literal">app-config.yaml</code> file:
								</p><pre class="programlisting language-yaml">auth:
  environment: production
  providers:
    github:
      production:
        clientId: ${GITHUB_CLIENT_ID}
        clientSecret: ${GITHUB_CLIENT_SECRET}
signInPage: github</pre></li></ol></div></dd><dt><span class="term"><code class="literal">environment</code></span></dt><dd>
							Enter <code class="literal">production</code> to disable the Guest login option in the Developer Hub login page.
						</dd><dt><span class="term"><code class="literal">clientId</code></span></dt><dd>
							Enter the configured secret variable name: <code class="literal">${GITHUB_CLIENT_ID}</code>.
						</dd><dt><span class="term"><code class="literal">clientSecret</code></span></dt><dd>
							Enter the configured secret variable name: <code class="literal">${GITHUB_CLIENT_SECRET}</code>.
						</dd><dt><span class="term"><code class="literal">signInPage</code></span></dt><dd><p class="simpara">
							Enter <code class="literal">github</code> to enable the GitHub provider as your Developer Hub sign-in provider.
						</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								</p><p class="simpara">
									Optional: Add optional fields to the GitHub authentication provider section in your <code class="literal">app-config.yaml</code> file:
								</p><pre class="programlisting language-yaml">auth:
  environment: production
  providers:
    github:
      production:
        clientId: ${GITHUB_CLIENT_ID}
        clientSecret: ${GITHUB_CLIENT_SECRET}
        callbackUrl: <span class="emphasis"><em>&lt;your_intermediate_service_url/handler&gt;</em></span>
        sessionDuration: { hours: 24 }
        signIn:
          resolvers:
            - resolver: usernameMatchingUserEntityName
              dangerouslyAllowSignInWithoutUserInCatalog: true
signInPage: github</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">callbackUrl</code></span></dt><dd>
												Enter the callback URL that GitHub uses when initiating an OAuth flow, such as: <span class="emphasis"><em>&lt;your_intermediate_service_url/handler&gt;</em></span>. Define it when Developer Hub is not the immediate receiver, such as in cases when you use one OAuth app for many Developer Hub instances.
											</dd><dt><span class="term"><code class="literal">sessionDuration</code></span></dt><dd>
												Enter the user session lifespan, in <code class="literal">ms</code> library format (such as '24h', '2 days'), ISO duration, or "human duration".
											</dd><dt><span class="term"><code class="literal">signIn</code></span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">resolvers</code></span></dt><dd>
															After successful authentication, Developer Hub resolves the user signing in to an existing user in the Developer Hub catalog. Configure a specific resolver to best match users securely for your use case..
														</dd></dl></div><p class="simpara">
												Enter the resolver list to override the default resolver: <code class="literal">usernameMatchingUserEntityName</code>.
											</p><p class="simpara">
												The authentication provider tries each sign-in resolver in order until it succeeds. If none of the attempts succeed, the sign-in fails.
											</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
													In production mode, configure only one resolver to make sure users are securely matched.
												</p></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">resolver</code></span></dt><dd><p class="simpara">
															Enter the sign-in resolver name. Available resolvers:
														</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
																	<code class="literal">usernameMatchingUserEntityName</code>
																</li><li class="listitem">
																	<code class="literal">preferredUsernameMatchingUserEntityName</code>
																</li><li class="listitem">
																	<code class="literal">emailMatchingUserEntityProfileEmail</code>
																</li></ul></div></dd><dt><span class="term"><code class="literal">dangerouslyAllowSignInWithoutUserInCatalog</code></span></dt><dd><p class="simpara">
															Enter <code class="literal">true</code> to configure the sign-in resolver to bypass the user provisioning requirement in the Developer Hub software catalog.
														</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
																In production more, do not enable <code class="literal">dangerouslyAllowSignInWithoutUserInCatalog</code>.
															</p></div></div></dd></dl></div></dd></dl></div></li></ol></div></dd></dl></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Verify user and group provisioning by checking the console logs.
					</p><p class="simpara">
						Successful synchronization example:
					</p><pre class="programlisting language-json">{"class":"GithubMultiOrgEntityProvider","level":"info","message":"Reading GitHub users and teams for org: rhdh-dast","plugin":"catalog","service":"backstage","target":"https://github.com","taskId":"GithubMultiOrgEntityProvider:githuborg:refresh","taskInstanceId":"801b3c6c-167f-473b-b43e-e0b4b780c384","timestamp":"2024-09-09 23:55:58"}
{"class":"GithubMultiOrgEntityProvider","level":"info","message":"Read 7 GitHub users and 2 GitHub groups in 0.4 seconds. Committing...","plugin":"catalog","service":"backstage","target":"https://github.com","taskId":"GithubMultiOrgEntityProvider:githuborg:refresh","taskInstanceId":"801b3c6c-167f-473b-b43e-e0b4b780c384","timestamp":"2024-09-09 23:55:59"}</pre></li><li class="listitem"><p class="simpara">
						To verify GitHub authentication:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Go to the Developer Hub login page.
							</li><li class="listitem">
								Your Developer Hub sign-in page displays <span class="strong strong"><strong>Sign in using GitHub</strong></span> and the Guest user sign-in is disabled.
							</li><li class="listitem">
								Log in with a GitHub account.
							</li></ol></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/integrating_red_hat_developer_hub_with_github/index">Integrating Red Hat Developer Hub with GitHub</a>
					</li></ul></div></section><section class="section" id="enabling-user-authentication-with-github-as-an-auxiliary-authentication-provider"><div class="titlepage"><div><div><h3 class="title">4.2. Enabling user authentication with GitHub as an auxiliary authentication provider</h3></div></div></div><p>
				If your primary authentication provider is not GitHub, users might lack the permissions needed for templates or plugins that require GitHub access. The recommended solution is to configure GitHub as an auxiliary authentication provider. This approach uses the primary provider for user identity management and the auxiliary provider to grant the necessary GitHub permissions, without re-resolving the user’s identity.
			</p><p>
				Give users access to these features by configuring GitHub as an auxiliary authentication provider.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						You have enough permissions in GitHub to create and manage a <a class="link" href="https://docs.github.com/en/apps/overview">GitHub App</a>.
					</p><div class="admonition tip"><div class="admonition_header">Tip</div><div><p>
						Alternatively, ask your GitHub administrator to prepare the required GitHub App.
					</p></div></div></li><li class="listitem">
						You have <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_red_hat_developer_hub/index">added a custom Developer Hub application configuration</a>, and have enough permissions to change it.
					</li><li class="listitem">
						You have configured a primary authentication provider to provision user and group identities to the Red Hat Developer Hub software catalog, and establish Developer Hub user sessions.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Add the <code class="literal">auth.providers.github</code> section to your <code class="literal">app-config.yaml</code> file:
					</p><pre class="programlisting language-yaml">auth:
  providers:
    github:
      production:
        clientId: ${GITHUB_CLIENT_ID}
        clientSecret: ${GITHUB_CLIENT_SECRET}
        disableIdentityResolution: true</pre><p class="simpara">
						where: <code class="literal">clientId</code>:: Enter the configured secret variable name: <code class="literal">${GITHUB_CLIENT_ID}</code>.
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">clientSecret</code></span></dt><dd>
									Enter the configured secret variable name: <code class="literal">${GITHUB_CLIENT_SECRET}</code>.
								</dd><dt><span class="term"><code class="literal">disableIdentityResolution</code></span></dt><dd><p class="simpara">
									Enter <code class="literal">true</code> to skip user identity resolution for this provider to enable sign-in from an auxiliary authentication provider.
								</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
										Do not enable this setting on the primary authentication provider you plan on using for sign-in and identity management.
									</p></div></div></dd></dl></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Go to the Developer Hub login page.
					</li><li class="listitem">
						Log in with your primary authentication provider account.
					</li><li class="listitem">
						In the top user menu, go to <span class="strong strong"><strong>Settings</strong></span> &gt; <span class="strong strong"><strong>Authentication Providers</strong></span>.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>GitHub</strong></span> line, click the <span class="strong strong"><strong>Sign in</strong></span> button and log in.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>GitHub</strong></span> line, the button displays <span class="strong strong"><strong>Sign out</strong></span>.
					</li></ol></div><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/integrating_red_hat_developer_hub_with_github/index">Integrating Red Hat Developer Hub with GitHub</a>
					</li></ul></div></section></section><section class="section" id="enabling-user-authentication-with-microsoft-azure-with-optional-steps"><div class="titlepage"><div><div><h2 class="title">5. Enabling user authentication with Microsoft Azure, with optional steps</h2></div></div></div><p>
			Authenticate users with Microsoft Azure by provisioning the users and groups from Azure to the Developer Hub software catalog, and configuring the Azure authentication provider in Red Hat Developer Hub.
		</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
					You have the permission to register an application in Azure.
				</p><div class="admonition tip"><div class="admonition_header">Tip</div><div><p>
					Alternatively, ask your Azure administrator to prepare the required Azure application.
				</p></div></div></li><li class="listitem">
					You <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_red_hat_developer_hub/index">added a custom Developer Hub application configuration</a>, and have enough permissions to change it.
				</li><li class="listitem"><p class="simpara">
					Your Developer Hub backend can access the following hosts:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">login.microsoftonline.com</code></span></dt><dd>
								The Microsoft Azure authorization server, which enables the authentication flow.
							</dd><dt><span class="term"><code class="literal">graph.microsoft.com</code></span></dt><dd>
								The server for retrieving organization data, including user and group data, to import into the Developer Hub catalog.
							</dd></dl></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
					Register your Developer Hub app in Azure, <a class="link" href="https://learn.microsoft.com/en-us/entra/identity-platform/scenario-web-app-sign-user-app-registration?tabs=aspnetcore#register-an-app-by-using-the-azure-portal">by using the Azure portal</a>.
				</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
							Sign in to the <a class="link" href="https://entra.microsoft.com/">Microsoft Entra admin center</a>.
						</li><li class="listitem">
							Optional: If you have access to multiple tenants, use the <span class="strong strong"><strong>Settings</strong></span> icon in the top menu to switch to the tenant in which you want to register the application from the <span class="strong strong"><strong>Directories + subscriptions</strong></span> menu.
						</li><li class="listitem"><p class="simpara">
							Browse to <span class="strong strong"><strong>Applications &gt; App registrations</strong></span>, and create a <span class="strong strong"><strong>New registration</strong></span> with the configuration:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd>
										Enter a name to identify your application in Azure, such as <span class="emphasis"><em>&lt;Authenticating with Developer Hub&gt;</em></span>.
									</dd><dt><span class="term">Supported account types</span></dt><dd>
										Select <span class="strong strong"><strong>Accounts in this organizational directory only</strong></span>.
									</dd><dt><span class="term">Redirect URI</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">Select a platform</span></dt><dd>
													Select <span class="strong strong"><strong>Web</strong></span>.
												</dd><dt><span class="term">URL</span></dt><dd>
													Enter the backend authentication URI set in Developer Hub: <code class="literal">https://<span class="emphasis"><em>&lt;my_developer_hub_domain&gt;</em></span>/api/auth/microsoft/handler/frame</code>
												</dd></dl></div></dd></dl></div></li><li class="listitem"><p class="simpara">
							On the <span class="strong strong"><strong>Applications &gt; App registrations &gt; <span class="emphasis"><em>&lt;Authenticating with Developer Hub&gt;</em></span> &gt; Manage &gt; API permissions</strong></span> page, <span class="strong strong"><strong>Add a Permission</strong></span>, <span class="strong strong"><strong>Microsoft Graph</strong></span>, select the following permissions:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Application Permissions</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">GroupMember.Read.All</code>, </span><span class="term"><code class="literal">User.Read.All</code></span></dt><dd><p class="simpara">
													Enter permissions that enable provisioning user and groups to the Developer Hub software catalog.
												</p><p class="simpara">
													Optional: <span class="strong strong"><strong>Grant admin consent</strong></span> for these permissions. Even if your company does not require admin consent, consider doing so as it means users do not need to individually consent the first time they access Developer Hub.
												</p></dd></dl></div></dd><dt><span class="term">Delegated Permissions</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">User.Read</code>, </span><span class="term"><code class="literal">email</code>, </span><span class="term"><code class="literal">offline_access</code>, </span><span class="term"><code class="literal">openid</code>, </span><span class="term"><code class="literal">profile</code></span></dt><dd><p class="simpara">
													Enter permissions that enable authenticating users.
												</p><p class="simpara">
													Optional: Enter optional custom scopes for the Microsoft Graph API that you define both here and in your <code class="literal">app-config.yaml</code> Developer Hub configuration file.
												</p></dd></dl></div></dd></dl></div></li><li class="listitem">
							On the <span class="strong strong"><strong>Applications &gt; App registrations &gt; <span class="emphasis"><em>&lt;Authenticating with Developer Hub&gt;</em></span> &gt; Manage &gt; Certificates &amp; secrets</strong></span> page, in the <span class="strong strong"><strong>Client secrets</strong></span> tab, create a <span class="strong strong"><strong>New client secret</strong></span>.
						</li><li class="listitem"><p class="simpara">
							Save the following values for the next step:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<span class="strong strong"><strong>Directory (tenant) ID</strong></span>
								</li><li class="listitem">
									<span class="strong strong"><strong>Application (client) ID</strong></span>
								</li><li class="listitem">
									<span class="strong strong"><strong>Application (client) Secret ID</strong></span>
								</li></ul></div></li></ol></div></li><li class="listitem"><p class="simpara">
					Add your Azure credentials to Developer Hub, by adding the following key/value pairs to <a class="link" href="https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html-single/configuring_red_hat_developer_hub/index#provisioning-your-custom-configuration">your Developer Hub secrets</a>:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">AUTHENTICATION_AZURE_TENANT_ID</code></span></dt><dd>
								Enter your saved <span class="strong strong"><strong>Directory (tenant) ID</strong></span>.
							</dd><dt><span class="term"><code class="literal">AUTHENTICATION_AZURE_CLIENT_ID</code></span></dt><dd>
								Enter your saved <span class="strong strong"><strong>Application (client) ID</strong></span>.
							</dd><dt><span class="term"><code class="literal">AUTHENTICATION_AZURE_CLIENT_SECRET</code></span></dt><dd>
								Enter your saved <span class="strong strong"><strong>Application (client) secret</strong></span>.
							</dd></dl></div></li><li class="listitem"><p class="simpara">
					Enable the Microsoft Graph catalog provider plugin in your <code class="literal">dynamic-plugins.yaml</code> file. This plugin imports Azure users and groups to the Developer Hub software catalog.
				</p><pre class="programlisting language-yaml">plugins:
  - package: './dynamic-plugins/dist/backstage-plugin-catalog-backend-module-msgraph-dynamic'
    disabled: false</pre></li><li class="listitem"><p class="simpara">
					Enable provisioning Azure users and groups to the Developer Hub software catalog, by adding the Microsoft Graph catalog provider section in your <code class="literal">app-config.yaml</code> file:
				</p><pre class="programlisting language-yaml" id="microsoftGraphOrgProviderId">catalog:
  providers:
    microsoftGraphOrg:
      providerId:
        target: https://graph.microsoft.com/v1.0
        tenantId: ${AUTHENTICATION_AZURE_TENANT_ID}
        clientId: ${AUTHENTICATION_AZURE_CLIENT_ID}
        clientSecret: ${AUTHENTICATION_AZURE_CLIENT_SECRET}
        schedule:
          frequency:
            hours: 1
          timeout:
            minutes: 50
          initialDelay:
            minutes: 50</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">target</code></span></dt><dd>
								Enter <code class="literal">https://graph.microsoft.com/v1.0</code> to define the MSGraph API endpoint the provider is connecting to. You might change this parameter to use a different version, such as the <a class="link" href="https://learn.microsoft.com/en-us/graph/api/overview?view=graph-rest-beta#call-the-beta-endpoint">beta endpoint</a>.
							</dd><dt><span class="term"><code class="literal">tenandId</code></span></dt><dd>
								Enter the configured secret variable name: <code class="literal">${AUTHENTICATION_AZURE_TENANT_ID}</code>.
							</dd><dt><span class="term"><code class="literal">clientId</code></span></dt><dd>
								Enter the configured secret variable name: <code class="literal">${AUTHENTICATION_AZURE_CLIENT_ID}</code>.
							</dd><dt><span class="term"><code class="literal">clientSecret</code></span></dt><dd>
								Enter the configured secret variable name: <code class="literal">${AUTHENTICATION_AZURE_CLIENT_SECRET}</code>.
							</dd><dt><span class="term"><code class="literal">schedule</code></span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">frequency</code></span></dt><dd>
											Enter the schedule frequency in the cron, ISO duration, or human duration format. In a large organization, user provisioning might take a long time, therefore avoid using a low value.
										</dd><dt><span class="term"><code class="literal">timeout</code></span></dt><dd>
											Enter the schedule timeout in the ISO duration or human duration format. In a large organization, user provisioning might take a long time, therefore avoid using a low value.
										</dd><dt><span class="term"><code class="literal">initialDelay</code></span></dt><dd>
											Enter the schedule initial delay in the ISO duration or human duration format.
										</dd></dl></div></dd></dl></div></li><li class="listitem"><p class="simpara">
				</p><p class="simpara">
					Optional: Add optional fields to the Microsoft authentication provider section in your <code class="literal">app-config.yaml</code> file:
				</p><pre class="programlisting language-yaml">catalog:
  providers:
    microsoftGraphOrg:
      providerId:
        authority: https://login.microsoftonline.com/
        queryMode: advanced
        user:
          expand: manager
          filter: accountEnabled eq true and userType eq 'member'
          loadPhotos: true
          select: ['id', 'displayName', 'description']
        userGroupMember:
          filter: "displayName eq 'Backstage Users'"
          search: '"description:One" AND ("displayName:Video" OR "displayName:Drive")'
        group:
          expand: member
          filter: securityEnabled eq false and mailEnabled eq true and groupTypes/any(c:c+eq+'Unified')
          search: '"description:One" AND ("displayName:Video" OR "displayName:Drive")'
          select: ['id', 'displayName', 'description']</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">authority</code></span></dt><dd>
								Enter your <a class="link" href="https://learn.microsoft.com/en-us/graph/deployments#app-registration-and-token-service-root-endpoints">Azure authority URL</a> if it is different from the default: <code class="literal">https://login.microsoftonline.com</code>.
							</dd><dt><span class="term"><code class="literal">queryMode</code></span></dt><dd>
								Enter <code class="literal">advanced</code> when the default <code class="literal">basic</code> query mode is insufficient for your queries to the Microsoft Graph API. See <a class="link" href="https://learn.microsoft.com/en-us/graph/aad-advanced-queries">Microsoft Azure advanced queries</a>.
							</dd><dt><span class="term"><code class="literal">user</code></span></dt><dd><p class="simpara">
								Add this section to configure optional user query parameters.
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">expand</code></span></dt><dd><p class="simpara">
											Enter your expansion parameter to include the expanded resource or collection referenced by a single relationship (navigation property) in your results. A single request can expand only one relationship. See <a class="link" href="https://learn.microsoft.com/en-us/graph/query-parameters#expand-parameter">Microsoft Graph query expand parameter</a>.
										</p><p class="simpara">
											You can combine this parameter with <code class="literal">userGroupMember.filter</code> or <code class="literal">user.filter</code>.
										</p></dd><dt><span class="term"><code class="literal">filter</code></span></dt><dd><p class="simpara">
											Enter your user filter. See <a class="link" href="https://learn.microsoft.com/en-us/graph/api/resources/user?view=graph-rest-1.0#properties">Microsoft Graph API</a> and <a class="link" href="https://learn.microsoft.com/en-us/graph/query-parameters#filter-parameter">Microsoft Graph API query filter parameters syntax</a>.
										</p><p class="simpara">
											This parameter and <code class="literal">userGroupMember.filter</code> are mutually exclusive, specify only one.
										</p></dd><dt><span class="term"><code class="literal">loadPhotos</code></span></dt><dd>
											Developer Hub loads photos by default. Enter <code class="literal">false</code> to avoid loading user photos.
										</dd><dt><span class="term"><code class="literal">select</code></span></dt><dd>
											Enter the <a class="link" href="https://learn.microsoft.com/en-us/graph/api/resources/schemaextension?view=graph-rest-1.0">Microsoft Graph resource type</a> list to retrieve.
										</dd></dl></div></dd><dt><span class="term"><code class="literal">userGroupMember</code></span></dt><dd><p class="simpara">
								Add this section to use group membership to get users.
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">filter</code></span></dt><dd><p class="simpara">
											Enter your filter to filter groups and fetch their members.
										</p><p class="simpara">
											This parameter and <code class="literal">user.filter</code> are mutually exclusive, specify only one.
										</p></dd><dt><span class="term"><code class="literal">search</code></span></dt><dd><p class="simpara">
											Enter your search query to search for groups and fetch their members.
										</p><p class="simpara">
											This parameter and <code class="literal">user.filter</code> are mutually exclusive, specify only one.
										</p></dd></dl></div></dd><dt><span class="term"><code class="literal">group</code></span></dt><dd><p class="simpara">
								Enter your configuration to get groups.
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">expand</code></span></dt><dd><p class="simpara">
											Enter your expansion parameter to include the expanded resource or collection referenced by a single relationship (navigation property) in your results. A single request can expand only one relationship. See <a class="link" href="https://learn.microsoft.com/en-us/graph/query-parameters#expand-parameter">Customize Microsoft Graph responses with query parameters</a>.
										</p><p class="simpara">
											You can combine this parameter with <code class="literal">user.filter</code> or <code class="literal">userGroupMember.filter</code>.
										</p></dd><dt><span class="term"><code class="literal">filter</code></span></dt><dd>
											Enter your group filter parameter. See <a class="link" href="https://learn.microsoft.com/en-us/graph/api/resources/group?view=graph-rest-1.0#properties">Microsoft Graph API query group syntax</a>.
										</dd><dt><span class="term"><code class="literal">search</code></span></dt><dd>
											Enter your group search parameter. See <a class="link" href="https://learn.microsoft.com/en-us/graph/search-query-parameter">Microsoft Graph API query search parameter</a>.
										</dd><dt><span class="term"><code class="literal">select</code></span></dt><dd>
											Enter the <a class="link" href="https://learn.microsoft.com/en-us/graph/api/resources/schemaextension?view=graph-rest-1.0">Microsoft Graph resource type</a> list to retrieve.
										</dd></dl></div></dd></dl></div></li><li class="listitem"><p class="simpara">
				</p><p class="simpara">
					Enable Azure authentication, by adding the Microsoft authentication provider to your <code class="literal">app-config.yaml</code> file content:
				</p><pre class="programlisting language-yaml">auth:
  environment: production
  providers:
    microsoft:
      production:
        clientId: ${AUTHENTICATION_AZURE_CLIENT_ID}
        clientSecret: ${AUTHENTICATION_AZURE_CLIENT_SECRET}
        tenantId: ${AUTHENTICATION_AZURE_TENANT_ID}
signInPage: microsoft</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">environment</code></span></dt><dd>
								Enter <code class="literal">production</code> to disable the <span class="strong strong"><strong>Guest</strong></span> login option in the Developer Hub login page.
							</dd><dt><span class="term"><code class="literal">clientId</code></span></dt><dd>
								Enter the configured secret variable name: <code class="literal">${AUTHENTICATION_AZURE_CLIENT_ID}</code>.
							</dd><dt><span class="term"><code class="literal">clientSecret</code></span></dt><dd>
								Enter the configured secret variable name: <code class="literal">${AUTHENTICATION_AZURE_CLIENT_SECRET}</code>.
							</dd><dt><span class="term"><code class="literal">tenantId</code></span></dt><dd>
								Enter the configured secret variable name: <code class="literal">${AUTHENTICATION_AZURE_TENANT_ID}</code>.
							</dd><dt><span class="term"><code class="literal">signInPage</code></span></dt><dd>
								Enter <code class="literal">microsoft</code> to set the Azure provider as your Developer Hub sign-in provider.
							</dd></dl></div></li><li class="listitem"><p class="simpara">
				</p><p class="simpara">
					Optional: Add optional fields to the Microsoft authentication provider section in your <code class="literal">app-config.yaml</code> file:
				</p><pre class="programlisting language-yaml">auth:
  environment: production
  providers:
    microsoft:
      production:
        clientId: ${AUTHENTICATION_AZURE_CLIENT_ID}
        clientSecret: ${AUTHENTICATION_AZURE_CLIENT_SECRET}
        tenantId: ${AUTHENTICATION_AZURE_TENANT_ID}
        domainHint: ${AUTHENTICATION_AZURE_TENANT_ID}
        additionalScopes:
           - Mail.Send
        sessionDuration:
          hours: 24
        signIn:
          resolvers:
            - resolver: usernameMatchingUserEntityName
              dangerouslyAllowSignInWithoutUserInCatalog: true
signInPage: microsoft</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">domainHint</code></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Leave this parameter empty, or enter the tenant ID when your application registration is single-tenant.
									</li><li class="listitem">
										Leave this parameter empty when your application registration is multi-tenant.
									</li><li class="listitem"><p class="simpara">
										Enter the tenant ID to reduce login friction for users with accounts in multiple tenants, by automatically filtering out accounts from other tenants.
									</p><p class="simpara">
										For more information, see <a class="link" href="https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/home-realm-discovery-policy">Home Realm Discovery</a>.
									</p></li></ul></div></dd><dt><span class="term"><code class="literal">additionalScopes</code></span></dt><dd><p class="simpara">
								Enter the list of additional scopes to add scopes for the application registration. The default and mandatory value lists following scopes:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<code class="literal">openid</code>
									</li><li class="listitem">
										<code class="literal">offline_access</code>
									</li><li class="listitem">
										<code class="literal">profile</code>
									</li><li class="listitem">
										<code class="literal">email</code>
									</li><li class="listitem">
										<code class="literal">User.Read</code>
									</li></ul></div></dd><dt><span class="term"><code class="literal">sessionDuration</code></span></dt><dd>
								Lifespan of the user session. Enter a duration in <code class="literal">ms</code> library (such as '24h', '2 days'), ISO duration, or "human duration" format.
							</dd><dt><span class="term"><code class="literal">signIn.resolvers</code></span></dt><dd><p class="simpara">
								After successful authentication, Developer Hub resolves the user signing in to an existing user in the Developer Hub catalog. To best match users securely for your use case, consider configuring a specific resolver.
							</p><p class="simpara">
								Enter the resolver list to override the default resolver: <code class="literal">userIdMatchingUserEntityAnnotation</code>.
							</p><p class="simpara">
								The authentication provider tries each sign-in resolver in order until it succeeds, and fails if none succeed.
							</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
									In production mode, configure only one resolver to make sure users are securely matched.
								</p></div></div></dd><dt><span class="term"><code class="literal">resolver</code></span></dt><dd><p class="simpara">
								Enter the sign-in resolver name. Available resolvers:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">emailMatchingUserEntityAnnotation</code></span></dt><dd>
											Use this resolver to look up the user by matching their Microsoft email to the email entity annotation.
										</dd><dt><span class="term"><code class="literal">emailLocalPartMatchingUserEntityName</code></span></dt><dd>
											Use this resolver to look up the user by matching their Microsoft email user name to the user entity name.
										</dd><dt><span class="term"><code class="literal">emailMatchingUserEntityProfileEmail</code></span></dt><dd>
											Use this resolver to look up the user by matching their Microsoft email to the user entity profile email.
										</dd></dl></div></dd><dt><span class="term"><code class="literal">dangerouslyAllowSignInWithoutUserInCatalog</code></span></dt><dd><p class="simpara">
								Enter <code class="literal">true</code> to configure the sign-in resolver to bypass the user provisioning requirement in the Developer Hub software catalog.
							</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
									In production mode, do not enable <code class="literal">dangerouslyAllowSignInWithoutUserInCatalog</code>.
								</p></div></div></dd></dl></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
					To verify user and group provisioning, check the console logs for <code class="literal">MicrosoftGraphOrgEntityProvider</code> events.
				</p><p class="simpara">
					Successful synchronization example:
				</p><pre class="screen">2025-06-23T13:37:55.804Z catalog info Read 9 msgraph users and 3 msgraph groups in 1.5 seconds. Committing... class="MicrosoftGraphOrgEntityProvider" taskId="MicrosoftGraphOrgEntityProvider:providerId:refresh" taskInstanceId="e104a116-6481-4ceb-9bc4-0f8f9581f959" trace_id="e4c633659cffd6b1529afa55a5bfbad7" span_id="76affd0420e8baa6" trace_flags="01"

2025-06-23T13:37:55.811Z catalog info Committed 9 msgraph users and 3 msgraph groups in 0.0 seconds. class="MicrosoftGraphOrgEntityProvider" taskId="MicrosoftGraphOrgEntityProvider:providerId:refresh" taskInstanceId="e104a116-6481-4ceb-9bc4-0f8f9581f959" trace_id="e4c633659cffd6b1529afa55a5bfbad7" span_id="76affd0420e8baa6" trace_flags="01"</pre></li><li class="listitem"><p class="simpara">
					To verify Azure user authentication:
				</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
							Go to the Developer Hub login page.
						</li><li class="listitem">
							Your Developer Hub sign-in page displays <span class="strong strong"><strong>Sign in using Microsoft</strong></span> and the Guest user sign-in is disabled.
						</li><li class="listitem">
							Log in with an Azure account.
						</li></ol></div></li></ol></div></section><div><div xml:lang="en-US" class="legalnotice" id="idm45684598812080"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"/>© 2025 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri" href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></section></div></div><script type="text/javascript">
                        jQuery(document).ready(function() {
                            initSwitchery();
                            jQuery('pre[class*="language-"]').each(function(i, block){hljs.highlightBlock(block);});
                        });
                    </script></body></html>