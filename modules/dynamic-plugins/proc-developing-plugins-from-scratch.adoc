:_mod-docs-content-type: PROCEDURE

[id="proc-developing-plugins-from-scratch_{context}"]
= Develop a new plugin

== Determine {product-very-short} version
To ensure your plugin uses dependencies compatible with the {product-very-short} instance that it will run on, check the target {product-very-short} version and identify the vompatible Backstage version.

.{product-very-short} compatibility matrix
[cols="33%,34%,33%", frame="all", options="header"]
|===
|{product-very-short} version
|Backstage version
|create-app version

|1.9
|1.45.3
|0.7.6

|1.8	
|1.42.5	
|0.7.3

|1.7	
|1.39.1	
|0.6.2

|1.6	
|1.36.1	
|0.5.25

|===

== Create a new Backstage application
To ensure that you use the compatible version of the Backstage CLI to create your plugin, create a new Backstage application in your workspace by using the `create-app` command.

.Prerequisites
* Determine the `create-app` version based on the {product-very-short} compatibility matrix.

.Procedure
. Create a directory for your workspace, as follows:
+
[source,terminal]
----
$ mkdir rhdh-plugin-dev
$ cd rhdh-plugin-dev
----
. Initialize the Backstage application, as follows:
+
[source,terminal]
----
$ npx @backstage/create-app@0.7.6 --path .
----

.Verification
Your workspace should contain the following:

* `packages/app/` folder
* `packages/backend/` folder
* `plugins/` folder
* `package.json` file containing the Backstage dependencies.

== Create a new plugin
.Prerequisites
* You have created a Backstage application.

.Procedure
. In your Backstage application root folder, create a new plugin by using the `yarn new` command, for example:
+
[source,terminal]
--
$ cd rhdh-plugin-dev
$ yarn new
--
.Output from the `yarn new` command
+
[source,terminal]
--
? What do you want to create? (Use arrow keys)
❯ frontend-plugin - A new frontend plugin 
  backend-plugin - A new backend plugin 
  backend-plugin-module - A new backend module that extends an existing backend plugin 
  plugin-web-library - A new web library plugin package 
  plugin-node-library - A new Node.js library plugin package 
  plugin-common-library - A new isomorphic common plugin package 
  web-library - A library package, exporting shared functionality for web environments 
--

. Select the type of plugin to create, for example, `frontend-plugin`.
. Enter the ID of the plugin, for example:
+
[source,terminal]
--
? What do you want to create? frontend-plugin - A new frontend plugin
? Enter the ID of the plugin [required] simple-example
--

. (Optional) To preview your plugin with {product-very-short} styling, configure the {product-very-short} theme package in the plugin, as follows:
+
[source,terminal]
--
$ cd plugins/simple-example
$ yarn add --dev @red-hat-developer-hub/backstage-plugin-theme
--
+
Update `dev/index.tsx` file, as follows, to use {product-very-short} themes:
+
[source,javascript]
--
// Import the RHDH themes from the plugin
import { getAllThemes } from '@red-hat-developer-hub/backstage-plugin-theme';
// ...
// ...
createDevApp()
  // ...
  // ...
  // Add RHDH themes to the development harness
  .addThemes(getAllThemes())
  .render();
--
+
[NOTE]
====
This configuration is only for the local development harness (`dev/index.tsx`). When deployed to {product-very-short}, the application provides theming automatically.
====

.Verification
The system generates a new Backstage plugin using your provided ID, then automatically builds and integrates it into the application. The `plugins/simple-example/` directory should exist with `src/`, `dev/` folders, and a `package.json` file.

You can also serve the plugin in isolation by running `yarn start` in the plugin directory, for example:

[source, terminal]
----
$ cd plugins/simple-example
$ yarn start
----

// Implementing a plugin component (TBD)

== Implement a plugin component
By default, the frontend plugin already has a sample page component defined in `src/components/ExampleComponent/`. This page is automatically registered in `src/plugin.ts` as `SimpleExamplePage`.

One of the common extensions is to create a new entity card component.

.Procedure
. In the `src/components/` directory create an `ExampleCard` sub-directory.
. Create an `ExampleCard.tsx` file, as follows:
+
[source, javascript]
----
import React from 'react';
import { InfoCard } from '@backstage/core-components';
import { useEntity } from '@backstage/plugin-catalog-react';

export const ExampleCard = () => {
  const { entity } = useEntity();
  return (
    <InfoCard title="Simple Example Info">
      <p>Entity: {entity.metadata.name}</p>
    </InfoCard>
  );
};
----
. In the `src/components/ExampleCard` directory, create and edit the `index.ts` file, as follows:
+
[source, javascript]
----
export { ExampleCard } from './ExampleCard';
----

. To register the new entity card component, edit the `src/plugin.ts` file to add the new component to the plugin, as follows:
+
[source, javascript]
----
import { createComponentExtension } from '@backstage/core-plugin-api';

// ...
// ...
export const ExampleCard = simpleExamplePlugin.provide(
  createComponentExtension({
    name: 'ExampleCard',
    component: {
      lazy: () =>
        import('./components/ExampleCard').then(m => m.ExampleCard),
    },
  }),
);
----

. Export all components in `src/index.ts` so they can be loaded dynamically:
+
[source, javascript]
----
export { simpleExamplePlugin, SimpleExamplePage, ExampleCard } from './plugin';
----

.Verification
Your plugin should have the following new files: 

* `src/components/ExampleCard/ExampleCard.tsx`
* `src/components/ExampleCard/index.ts`. 

The `src/plugin.ts` should export `ExampleCard`, and `src/index.ts` should re-export it.

== Test your plugin Locally
You can test a plugin locally by using your Backstage application.

[NOTE]
====
You can also use {product-very-short} Local to test your plugins by copying the `dist-dynamic/` folder contents to the {product-very-short} Local `local-plugins` folder. For more details, see _Verify plugins locally_.
====

For example, to test your component card locally in your Backstage application by using the development harness, update the `dev/index.tsx` file to include the new component card.

.Procedure
. Add backstage dependencies
+
[source, terminal]
----
$ yarn add @backstage/catalog-model @backstage/plugin-catalog-react
----
. Edit your `dev/index.tsx` file, as follows:
+
[source, javascript]
----
// ...
// ...
import { Entity } from '@backstage/catalog-model';
import { EntityProvider } from '@backstage/plugin-catalog-react';
import { Page, Header, Content } from '@backstage/core-components';
import { Grid } from '@material-ui/core';
import { ExampleCard } from '../src/plugin';


// Mock entity for the component card
const mockEntity: Entity = {
  apiVersion: 'backstage.io/v1alpha1',
  kind: 'Component',
  metadata: {
    name: 'example-service',
    description: 'An example service component for plugin development.',
    annotations: {
      'backstage.io/techdocs-ref': 'dir:.',
    },
  },
  spec: {
    type: 'service',
    lifecycle: 'production',
    owner: 'team-platform',
  },
};

// Create a page with the mock entity and the component card
const entityPage = (
  <EntityProvider entity={mockEntity}>
    <Page themeId="service">
      <Header
        title={mockEntity.metadata.name}
        subtitle={`${mockEntity.kind} · ${mockEntity.spec?.type}`}
      />
      <Content>
        <Grid container spacing={3} alignItems="stretch">
          <Grid item md={6} xs={12}>
            <ExampleCard />
          </Grid>
        </Grid>
      </Content>
    </Page>
  </EntityProvider>
);

createDevApp()
  // ...
  // ...
  .addPage({
    element: entityPage,
    title: 'Entity Page',
    path: '/simple-example/entity',
  })
  // ...
  // ...
  .render();
----
. Run the development server:
+
[source, terminal]
----
$ yarn start
----

.Verification
Navigate to `http://localhost:3000/simple-example/entity` in your browser. You should see the Entity Page with your `ExampleCard` component displaying "Entity: example-service".

== Configure frontend plugin wiring

Dynamic frontend plugins are registered and configured in the `dynamic-plugins.yaml` file. 

[IMPORTANT]
====
If you are using {product-very-short} Local for development and testing, use `dynamic-plugins.override.yaml` instead. 
====

This configuration determines how the plugin is integrated with the {product-very-short} interface, such as adding routes, sidebar menu items, and mount points.

.`dynamic-plugins.yaml` example
[source, yaml]
----
plugins:
  # Option 1: Load from an OCI image
  - package: oci://quay.io/<namespace>/simple-example:v0.1.0!backstage-plugin-simple-example
    disabled: false
    pluginConfig:
      dynamicPlugins:
        frontend:
          # The package name must match package.json (usually internal.backstage-plugin-<id>)
          internal.backstage-plugin-simple-example:
            dynamicRoutes:
              - path: /simple-example
                # Must match the export in src/index.ts
                importName: SimpleExamplePage
                menuItem:
                  icon: extension
                  text: Simple Example
            mountPoints:
              - mountPoint: entity.page.overview/cards
                # Must match the export in src/index.ts
                importName: ExampleCard
                config:
                  layout:
                    gridColumnEnd: 'span 4'
                  if:
                    allOf:
                      - isKind: component

  # Option 2: Load from local directory (for local RHDH testing)
  # - package: ./local-plugins/simple-example
  #   disabled: false
  #   pluginConfig: ... (same as above)
----

.Verification
After restarting {product-very-short}, you should see "Simple Example" in the sidebar menu. Clicking it should display your plugin page. Navigate to any Component entity page to verify the `ExampleCard` appears in the Overview tab.

.Additional resources
link:https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html/installing_and_viewing_plugins_in_red_hat_developer_hub/assembly-front-end-plugin-wiring.adoc[Frontend Plugin Wiring]