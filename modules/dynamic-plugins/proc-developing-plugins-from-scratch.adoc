:_mod-docs-content-type: PROCEDURE

[id="proc-developing-plugins-from-scratch_{context}"]
= Developing a new plugin

== Determine {product-very-short} version
To ensure your plugin uses dependencies compatible with the {product-very-short} instance that it will run on, check the target {product-very-short} version and identify the vompatible Backstage version.

.{product-very-short} compatibility matrix
[cols="33%,34%,33%", frame="all", options="header"]
|===
|{product-very-short} version
|Backstage version
|create-app version

|1.9
|1.45.3
|0.7.6

|1.8	
|1.42.5	
|0.7.3

|1.7	
|1.39.1	
|0.6.2

|1.6	
|1.36.1	
|0.5.25

|===

== Creating a new Backstage application
To ensure that you use the compatible version of the Backstage CLI to create your plugin, create a new Backstage application in your workspace by using the `create-app` command.

[NOTE]
====
Adjust the `create-app` version based on the {product-very-short} compatibility matrix.
====

.Prerequisites
* A minimum of 20 GB disk space to run the standalone Backstage application with demo data. NOTE: As you add more modules and plugins to an installation, the disk space requirements will increase, accordingly.
* A minimum of 6 GB memory.
Access to a Unix-based operating system, such as Linux, macOS or Windows Subsystem for Linux. The Linux version must support the required Node.js version.
* A GNU-like build environment available at the command line. For example, on Debian/Ubuntu you will want to have the make and build-essential packages installed. On macOS, you will want to run xcode-select --install to get the XCode command line build tooling in place.
* An account with elevated rights to install the dependencies
* curl or wget installed
* Node.js Active LTS Release installed using one of these methods:
** Using nvm (recommended)
*** Installing nvm
*** Install and change Node version with nvm
*** Node 22 is a good starting point, this can be installed using `nvm install lts/krypton`
** Binary Download
** Package manager
** Using NodeSource packages
* yarn Installation
** Backstage currently uses Yarn 4.4.1, once you've ran corepack enable you'll want to then run yarn set version 4.4.1
* docker installation
* git installation
* If the system is not directly accessible over your network the following ports need to be opened: 3000, 7007. This is quite uncommon, unless you're installing in a container, VM or remote system.

.Procedure
. Create a Backstage application, as follows:
+
[source,terminal]
----
# Create a directory for your workspace
mkdir my-backstage-app
cd my-backstage-app

# Initialize the Backstage app
# For RHDH 1.9 (adjust version based on the table above)
npx @backstage/create-app@0.7.6 --path .
----

. If this is the first time that you are installing a Backstage application on this device, the following question is displayed:
+
[terminal,source]
--
Need to install the following packages:
@backstage/create-app@0.7.4
ok to proceed? (y)
--
+
Enter `y` and proceed with the installation.
. Enter the name for your application and select Enter. This is the root directory of your application. In this example, the name is set to my-backstage-app.
+
.Output from create app
[terminal,source]
--
? Enter a name for the app [required] my-backstage-app

Creating the app...

 Checking if the directory is available:
  checking      my-backstage-app ✔ 

 Creating a temporary app directory:

 Preparing files:
  copying       .dockerignore ✔ 
  templating    .eslintrc.js.hbs ✔ 
  copying       .eslintignore ✔ 
  templating    .gitignore.hbs ✔ 
  copying       .prettierignore ✔ 
  templating    .yarnrc.yml.hbs ✔ 
  copying       app-config.production.yaml ✔ 
  copying       app-config.local.yaml ✔ 
  templating    app-config.yaml.hbs ✔ 
  copying       README.md ✔ 
  templating    backstage.json.hbs ✔ 
  templating    catalog-info.yaml.hbs ✔ 
  templating    package.json.hbs ✔ 
  copying       playwright.config.ts ✔ 
  copying       tsconfig.json ✔ 
  copying       yarn.lock ✔ 
  copying       README.md ✔ 
  copying       yarn-4.4.1.cjs ✔ 
  copying       entities.yaml ✔ 
  copying       org.yaml ✔ 
  copying       template.yaml ✔ 
  copying       catalog-info.yaml ✔ 
  copying       index.js ✔ 
  copying       package.json ✔ 
  copying       README.md ✔ 
  templating    .eslintrc.js.hbs ✔ 
  copying       Dockerfile ✔ 
  copying       README.md ✔ 
  templating    package.json.hbs ✔ 
  copying       index.ts ✔ 
  copying       .eslintignore ✔ 
  templating    .eslintrc.js.hbs ✔ 
  templating    package.json.hbs ✔ 
  copying       app.test.ts ✔ 
  copying       android-chrome-192x192.png ✔ 
  copying       apple-touch-icon.png ✔ 
  copying       favicon-16x16.png ✔ 
  copying       favicon.ico ✔ 
  copying       favicon-32x32.png ✔ 
  copying       robots.txt ✔ 
  copying       index.html ✔ 
  copying       safari-pinned-tab.svg ✔ 
  copying       manifest.json ✔ 
  copying       App.test.tsx ✔ 
  copying       apis.ts ✔ 
  copying       App.tsx ✔ 
  copying       setupTests.ts ✔ 
  copying       index.tsx ✔ 
  copying       LogoFull.tsx ✔ 
  copying       LogoIcon.tsx ✔ 
  copying       Root.tsx ✔ 
  copying       index.ts ✔ 
  copying       SearchPage.tsx ✔ 
  copying       EntityPage.tsx ✔ 

 Moving to final location:
  moving        my-backstage-app ✔ 
  fetching      yarn.lock seed ✔ 
  init          git repository ◜ 
 Installing dependencies:
  init          git repository ✔ 
  executing     yarn install ◞ 
➤ YN0000: · Yarn 4.4.1
➤ YN0000: └ Completed
➤ YN0000: ┌ Fetch step
➤ YN0000: └ Completed in 0s 833ms
--

.Verification
Your workspace should now contain `packages/app/`, `packages/backend/`, and `plugins/` directories, along with a root `package.json` with Backstage dependencies.

== Creating a new plugin
.Procedure
. Create a new plugin by using the `yarn new` command, as follows:
+
[source,terminal]
--
$ yarn new
--
.Output from the `yarn new` command
+
[source,terminal]
--
? What do you want to create? (Use arrow keys)
❯ frontend-plugin - A new frontend plugin 
  backend-plugin - A new backend plugin 
  backend-plugin-module - A new backend module that extends an existing backend plugin 
  plugin-web-library - A new web library plugin package 
  plugin-node-library - A new Node.js library plugin package 
  plugin-common-library - A new isomorphic common plugin package 
  web-library - A library package, exporting shared functionality for web environments 
--

. Select the type of plugin to create, for example, `frontend-plugin`.
. Enter the ID of the plugin, for example:
+
[source,terminal]
--
? What do you want to create? frontend-plugin - A new frontend plugin
? Enter the ID of the plugin [required] my-plugin
  templating    plugins/my-plugin ✔ 
  app           adding import ✔ 
  executing     yarn install ✔ 
  executing     yarn lint --fix ✔ 

Successfully created frontend-plugin
--

. (Optional) To preview your plugin with {product-very-short} styling, configure the {product-very-short} theme package in the plugin, as follows:
+
[source,terminal]
--
$ cd plugins/my-plugin
$ yarn add --dev @red-hat-developer-hub/backstage-plugin-theme
--
+
Update `dev/index.tsx` file to use {product-very-short} themes:
+
[source,javascript]
--
// dev/index.tsx

// Import the RHDH themes from the plugin
import { getAllThemes } from '@red-hat-developer-hub/backstage-plugin-theme';
// ...
// ...
createDevApp()
  // ...
  // ...
  // Add RHDH themes to the development harness
  .addThemes(getAllThemes())
  .render();
--
+
[NOTE]
====
This configuration is only for the local development harness (`dev/index.tsx`). When deployed to {product-very-short}, the application provides theming automatically.
====
.Verification
The system generates a new Backstage plugin using your provided ID, then automatically builds and integrates it into the application.

The `plugins/my-plugin/` directory should exist with `src/`, `dev/` folders, and a `package.json` file.

// If you have started your development server, by executing the `yarn start` command, you can view the plugin by navigating to link:http://localhost:3000/my-plugin[]

// image::rhdh/bs-created-plugin.png[backstage-plugin-creation]

You can also serve the plugin in isolation by running `yarn start` in the plugin directory, for example:

[source, terminal]
----
$ cd plugins/my-plugin
$ yarn start
----

// Implementing a plugin component (TBD)



