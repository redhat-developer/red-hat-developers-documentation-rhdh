:_mod-docs-content-type: PROCEDURE

[id="proc-example-custom-plugin-installation_{context}"]
= Example of installing a custom plugin in {product}
This example demonstrates how to package and install dynamic plugins using the {product-custom-resource-type} *Entity Feedback* community plugin that is not included in {product} pre-installed dynamic plugins. 

.Limitations
* You need to ensure that your custom plugin is built with a compatible version of {product-custom-resource-type}. In {product-short}, click *Settings*. Your custom plugin must be compatible with the *Backstage Version* version (or the closest previous version) that is displayed in the *Metadata* section of {product}.
+
For example, if you view the link:https://github.com/backstage/community-plugins/commits/main/workspaces/entity-feedback/backstage.json[history] of the `backstage.json` file for the *Entity Feedback* plugin, the `1fc87de` commit is closest previous version to {product-custom-resource-type} version of 1.39.1.
+
.`backstage.json` file history in Github
image::rhdh/custom-limitations.png[]


.Prerequisites
Ensure that your local environment meets the following requirements:

* *Node.js:* Version 22.x
* *Yarn:* Version 4.x
* *git CLI*
* *jq CLI:* Command-line JSON processor
* *OpenShift CLI (oc):* The client for interacting with your OpenShift cluster.
* *Container runtime:* Either podman or docker is required for packaging the plugin into an OCI image and logging into registries.
* *Container registry access:* Access to an OCI-compliant container registry (such as the internal OpenShift registry or a public registry like Quay.io).
//* *Command-line tool to build and package plugins:* The `@red-hat-developer-hub/cli` package. For compatibility with the most recent features and fixes, use the latest version (`@latest` tag) version of the  `@red-hat-developer-hub/cli` package.

.Procedure
. Clone the source code for the *Entity Feedback* plugin, as follows:
+
[source,terminal]
----
git clone https://github.com/backstage/community-plugins.git
cd community-plugins
----

. Prepare your environment to build the plugin by enabling Yarn for your Node.js installation, as follows:
+
[source,terminal]
----
corepack enable yarn
----

. Install the dependencies, compile the code, and build the plugins, as follows:
+
[source,terminal]
----
cd workspaces/entity-feedback
yarn install
yarn tsc
yarn build:all
----
+
[NOTE]
====
At this point, with {product-custom-resource-type}, you need to publish the built plugins to a NPM or NPM-compatible registry. However, as you are building this plugin to support it being loaded dynamically by {product}, you do not need to publish the plugin to a NPM registry. Instead, you can package the plugin for dynamic loading and publish it as a container image on `Quay.io` or your preferred container registry.
====

. Prepare the *Entity Feedback* frontend plugin by using the {product} CLI. The following command uses the plugin files in the `dist` folder that was generated by the `yarn build:all` command, and creates a new `dist-scalprum` folder that contains the necessary configuration and source files to enable dynamic loading:
+
[source,terminal]
----
cd plugins/entity-feedback
npx @red-hat-developer-hub/cli@latest plugin export
----
+
When this command packages a frontend plugin, it uses a default Scalprum configuration if one is not found. The Scalprum configuration is used to specify the plugin entry point and exports, and then to build a `dist-scalprum` folder that contains the dynamic plugin. The default Scalprum configuration is shown below, however a `scalprum` key can be added to the `package.json` file used by your plugin to set custom values, if necessary:
+
[source,json]
----
{
  "name": "backstage-community.plugin-entity-feedback",
  "exposedModules": {
    "PluginRoot": "./src/index.ts"
  }
}
----
+
The following `plugin-manifest.json` file, which {product} uses to load the plugin, is located in the `dist-dynamic/dist-scalprum` folder:
+
.`plugin-manifest.json` file
[source,json]
----
{
  "name": "backstage-community.plugin-entity-feedback",
  "version": "0.6.0",
  "extensions": [],
  "registrationMethod": "callback",
  "baseURL": "auto",
  "loadScripts": [
    "backstage-community.plugin-entity-feedback.fd691533c03cb52c30ac.js"
  ],
  "buildHash": "fd691533c03cb52c30acbb5a80197c9d"
}
----

. Package the plugin into a container image and publish it to Quay.io or your preferred container registry:
+
[source,terminal]
----
export QUAY_USER=replace-with-your-username
export PLUGIN_NAME=entity-feedback-plugin
export VERSION=$(cat package.json | jq .version -r)

npx @red-hat-developer-hub/cli@latest plugin package \
  --tag quay.io/$QUAY_USER/$PLUGIN_NAME:$VERSION

podman login quay.io
podman push quay.io/$QUAY_USER/$PLUGIN_NAME:$VERSION
----

. Repeat the same steps for the backend plugin. Scalprum is not required for backend plugins, and a `dist-dynamic` folder is generated instead of a `dist-scalprum` folder:
+
[source,terminal]
----
cd ../entity-feedback-backend/
npx @red-hat-developer-hub/cli@latest plugin export

export QUAY_USER=replace-with-your-username
export PLUGIN_NAME=entity-feedback-plugin-backend
export VERSION=$(cat package.json | jq .version -r)

npx @red-hat-developer-hub/cli@latest plugin package \
  --tag quay.io/$QUAY_USER/$PLUGIN_NAME:$VERSION

podman push quay.io/$QUAY_USER/$PLUGIN_NAME:$VERSION
----
+
Those commands result in two container images being published to your container registry. 
+
.Container images published to Quay.io
image::rhdh/custom-container-images.png[]