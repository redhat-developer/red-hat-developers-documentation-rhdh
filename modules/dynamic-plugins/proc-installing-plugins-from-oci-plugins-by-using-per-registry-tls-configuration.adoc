:_mod-docs-content-type: PROCEDURE

[id="proc-installing-plugins-from-oci-plugins-by-using-per-registry-tls-configuration_{context}"]

= Installing plugins from OCI plugins by using per-registry TLS configuration

.Procedure

. Create a ConfigMap from the CA certificate in the namespace where you are deploying your RHDH instance:
+
[source,terminal,subs="+attributes,+quotes"]
----
oc create configmap registry-ca-crt --from-file=ca.crt
----

. Mount the CA cert ConfigMap into your RHDH configuration:
.. Helm. Update your Helm values file:
+
[source,yaml]
----
upstream:
  backstage:
    extraVolumes:
      # IMPORTANT: Due to a Helm limitation with arrays, you must also
      # include all the volumes defined in the default Helm Chart
      # before adding the new one
      # ...
      - name: registry-ca-crt
        configMap:
          name: registry-ca-crt

    initContainers:
      - name: install-dynamic-plugins
        # IMPORTANT: Due to a Helm limitation with arrays, you must also
        # include all the other fields defined in the default Helm Chart
        # ...

        volumeMounts:
          # IMPORTANT: Due to a Helm limitation with arrays, you must also
          # include all the volume mounts defined in the default Helm Chart
          # before adding the new one
          # ...
          - name: registry-ca-crt
            # Hostname and port must match your target registry
            mountPath: '/etc/containers/certs.d/reg.example.com:5000'
----

.. Operator. Add this to your Backstage Custom Resource (CR):
+
[source,yaml]
----
spec:
  application:
    extraFiles:
      configMaps:
        - name: registry-ca-crt
          # Hostname and port must match your target registry
          mountPath: '/etc/containers/certs.d/reg.example.com:5000'
          containers:
            - install-dynamic-plugins
----

