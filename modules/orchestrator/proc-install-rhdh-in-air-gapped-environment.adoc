:_mod-docs-content-type: PROCEDURE

[id="proc-install-in-air-gapped-environment.adoc_{context}"]
=  Installing {product} with the Orchestrator in an air-gapped environment

You can install {product} with the Orchestrator in an air-gapped environment by mirroring required container images, Helm charts, and NPM packages to internal registries.

.Prerequisites

* You have administrative access to the {ocp-short} cluster and mirroring tools such as `oc`, `podman`, or `skopeo`.
* You have access to `npm.registry.redhat.com` from a connected network to pull and mirror Orchestrator plugin tarballs.
* You have mirroring permissions and credentials for all required sources.

.Procedure

. From a connected network, log in to the external registries:
+
[source,bash]
----
podman login registry.redhat.io
podman login registry.access.redhat.com
podman login npm.registry.redhat.com
----

. Identify and mirror all required container images to your internal registry:
+
[source,bash]
----
oc image mirror \
  registry.redhat.io/openshift-serverless/*=internal-registry.example.com/openshift-serverless/* \
  registry.redhat.io/openshift-knative/*=internal-registry.example.com/openshift-knative/* \
  registry.redhat.io/sonataflow/*=internal-registry.example.com/sonataflow/* \
  registry.redhat.io/rhdh/*=internal-registry.example.com/rhdh/* \
  registry.redhat.io/postgresql/*=internal-registry.example.com/postgresql/*
----

. Mirror the Orchestrator plugin NPM packages to your internal NPM registry:
+
[source,bash]
----
npm pack @redhat/backstage-plugin-orchestrator@<version>
npm pack @redhat/backstage-plugin-orchestrator-backend-dynamic@<version>
npm pack @redhat/backstage-plugin-scaffolder-backend-module-orchestrator-dynamic@<version>
npm pack @redhat/backstage-plugin-orchestrator-form-widgets@<version>

npm publish <package>.tgz --registry https://internal-npm.example.com
----

. Update the `dynamic-plugins` configuration to reference the internal NPM registry:
+
[source,yaml]
----
plugins:
  - package: "@redhat/backstage-plugin-orchestrator@<version>"
    disabled: false
    registry: https://internal-npm.example.com
----

. If using Helm charts, download them from a connected environment and push them to your internal chart repository:
+
[source,bash]
----
helm pull <chart> --version <version>
helm push <chart>.tgz oci://internal-chart-repo.example.com/rhdh
----

. Ensure NetworkPolicies, Role, and RoleBinding resources for the SonataFlow platform are included in your deployment configuration. The {product-short} Operator applies these automatically when the `SonataFlowPlatform` CR is created.

[NOTE]
====
For the connected environment resource requirements, see link:{installing-orch-on-ocp-book-url}[Resource requirements for the Operator-based Orchestrator].
====

.Verification
* Ensure all pods for OpenShift Serverless, Knative Serving/Eventing, SonataFlow, and PostgreSQL start successfully.