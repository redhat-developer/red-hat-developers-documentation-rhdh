:_mod-docs-content-type: PROCEDURE

[id="proc-deploying-workflows-on-a-cluster_{context}"]
= Deploying workflows on a cluster

You can deploy the workflow on a cluster, because the image is pushed to the image registry and the deployment manifests are available.

.Prerequisites

* You have an {ocp-short} cluster with the following versions of components installed:

** {product} ({product-very-short}) {product-version}
** Orchestrator plugins {orchestrator-plugin-version}
** OpenShift Serverless {rhoserverless-version}
** OpenShift Serverless Logic {rhoserverless-version}
+
For instructions on how to install these components, see the {orchestrator-book-link}#con-orchestrator-plugin-components.adoc_orchestrator-rhdh[Orchestrator plugin components on {ocp-short}].

* You must apply the workflow manifests in a namespace that contains a `SonataflowPlatform` custom resource (CR), which manages the {rhoserverless-link}#serverless-logic-configuring-workflow-services[supporting services].

.Procedure

. Use the `kubectl create` command specifying the target namespace to apply the Kubernetes manifests as shown in the following example:
+
[source,bash]
----
$ kubectl create -n <your_namespace> -f ./01_basic/manifests/.
----

. After deployment, monitor the status of the workflow pods as shown in the following example:
+
[source,bash]
----
$ kubectl get pods -n <your_namespace> -l app=basic
----
+
The pod may initially appear in an `Error` state because of missing or incomplete configuration in the Secret or ConfigMap.

. Inspect the Pod logs as shown in the following example:
+
[source,bash]
----
$ oc logs -n <your_namespace> basic-f7c6ff455-vwl56
----
+
The following code is an example of the output:
+
[source,yaml]
----
SRCFG00040: The config property quarkus.openapi-generator.notifications.auth.BearerToken.bearer-token is defined as the empty String ("") which the following Converter considered to be null: io.smallrye.config.Converters$BuiltInConverter
java.lang.RuntimeException: Failed to start quarkus
...
Caused by: io.quarkus.runtime.configuration.ConfigurationException: Failed to read configuration properties
----
+
The error indicates a missing property: `quarkus.openapi-generator.notifications.auth.BearerToken.bearer-token`.

. In such a case where the logs show the `ConfigurationException: Failed to read configuration properties` error or indicate a missing value, retrieve the ConfigMap as shown in the following example:
+
[source,bash]
----
$ oc get -n <your_namespace> configmaps basic-props -o yaml
----
+
The following code is an example of the sample output:
+
[source,yaml]
----
apiVersion: v1
data:
  application.properties: |
    # Backstage notifications service
    quarkus.rest-client.notifications.url=${BACKSTAGE_NOTIFICATIONS_URL}
    quarkus.openapi-generator.notifications.auth.BearerToken.bearer-token=${NOTIFICATIONS_BEARER_TOKEN}
...
----
+
Resolve the placeholders using values provided using a Secret.

. You must edit the corresponding Secret and provide appropriate base64-encoded values to resolve the placeholders in `application.properties` as shown in the following example:
+
[source,bash]
----
$ kubectl edit secrets -n <your_namespace> basic-secrets
----
. Restart the workflow Pod for Secret changes to take effect in OpenShift Serverless Logic {rhoserverless-version}.

.Verification

. Verify the deployment status by checking the Pods again as shown in the following example:
+
[source,bash]
----
$ oc get pods -n <your_namespace> -l app=basic
----
+
The expected status for a successfully deployed workflow Pod is as shown in the following example:
+
[source,yaml]
----
NAME                    READY   STATUS    RESTARTS   AGE
basic-f7c6ff455-grkxd   1/1     Running   0          47s
----

. Once the Pod is in the `Running` state, the workflow now appears in the Orchestrator plugin inside the {product}.

.Next steps
* Inspect the provided build script to extract the actual steps and implement them in your preferred CI/CD tool, for example, GitHub Actions, GitLab CI, Jenkins, and Tekton.