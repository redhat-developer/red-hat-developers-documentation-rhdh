:_mod-docs-content-type: PROCEDURE

[id="proc-rhdh-deploy-aks-operator_{context}"]
= Deploying {product-short} on {aks-short} with the Operator

You can install the {product-short} Operator on {aks-brand-name} ({aks-short}) using the https://olm.operatorframework.io[Operator Lifecycle Manager (OLM) framework].
Following that, you can proceed to deploy your {product-short} instance in {aks-short}.

For information about the OLM, see link:https://olm.operatorframework.io/docs/[Operator Lifecycle Manager(OLM)] documentation.

.Prerequisites
* You have installed the Operator Lifecycle Manager (OLM).
For more information about installation and troubleshooting, see https://operatorhub.io/how-to-install-an-operator#How-do-I-get-Operator-Lifecycle-Manager?[How do I get Operator Lifecycle Manager?]

* You have subscribed to `registry.redhat.io`.
For more information, see link:https://access.redhat.com/articles/RegistryAuthentication[{company-name} Container Registry Authentication].

* You have installed `kubectl`.
For more information, see https://kubernetes.io/docs/tasks/tools/#kubectl[Install kubetl].

* Your system meets the link:https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.7/html-single/about_red_hat_developer_hub/index#rhdh-sizing_about-rhdh[sizing requirements for {product}].

.Procedure
. Create an `ImagePull Secret` named `rhdh-pull-secret` using your Red Hat credentials to access images from the protected `registry.redhat.io` as shown in the following example:
+
--
[source,bash]
----
kubectl -n <your_namespace> create secret docker-registry rhdh-pull-secret \
    --docker-server=registry.redhat.io \
    --docker-username=<redhat_user_name> \
    --docker-password=<redhat_password> \
    --docker-email=<email>
----
--

. Create an Ingress manifest file, named `rhdh-ingress.yaml`, specifying your {product-short} service name as follows:
+
--
[source,yaml,subs="+attributes,+quotes"]
----
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: rhdh-ingress
  namespace: {my-product-namespace}
spec:
  ingressClassName: webapprouting.kubernetes.azure.com
  rules:
    - http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: backstage-<your-CR-name>
                port:
                  name: http-backend
----
--

. To deploy the created Ingress, run the following command:
+
--
[source,terminal]
----
kubectl -n <your_namespace> apply -f rhdh-ingress.yaml
----
--

. Create a `{my-app-config-config-map}` config map containing the `{my-app-config-file}` {product-short} configuration file by using the following example:
+
--
[source,yaml,subs="+attributes,+quotes"]
----
apiVersion: v1
kind: ConfigMap
metadata:
  name: {my-app-config-config-map}
data:
  "{my-app-config-file}": |
    app:
      title: {product}
      baseUrl: {my-product-url}
    backend:
      auth:
        externalAccess:
            - type: legacy
              options:
                subject: legacy-default-config
                secret: "${BACKEND_SECRET}"
      baseUrl: {my-product-url}
      cors:
        origin: {my-product-url}
----
--

. Create a `_<my_product_secrets>_` secret and add a key named `BACKEND_SECRET` with a `Base64-encoded` string value as shown in the following example:
+
--
[source,yaml,subs="+attributes,+quotes"]
----
apiVersion: v1
kind: Secret
metadata:
  name: `_<my_product_secrets>_` <1>
stringData:
  BACKEND_SECRET: "xxx"
----

<1> `_<my_product_secrets>_` is your preferred {product-short} secret name, where `_<my_product_secrets>_` specifies the identifier for your secret configuration within {product-short}.
--

. Create your `{product-custom-resource-type}` custom resource (CR) manifest file named `_<your-rhdh-cr>_` and include the previously created `rhdh-pull-secret` as follows:
+
--
[source,yaml,subs="+quotes,+attributes"]
----
apiVersion: rhdh.redhat.com/v1alpha3
kind: Backstage
metadata:
  name: `_<your-rhdh-cr>_`
spec:
  application:
    imagePullSecrets:
      - rhdh-pull-secret
    appConfig:
      configMaps:
        - name: {my-app-config-config-map}
    extraEnvs:
      secrets:
        - name: `_<my_product_secrets>_` <1>
----

<1> `_<my_product_secrets>_` is your preferred {product-short} secret name, where `_<my_product_secrets>_` specifies the identifier for your secret configuration within {product-short}.
--

. Apply the CR manifest to your namespace:
+
--
[source,terminal,subs="+attributes,+quotes"]
----
kubectl -n {my-product-namespace} apply -f rhdh.yaml
----
--

. Access the deployed {product-short} using the URL: `pass:c,a,q[https://<app_address>]`, where _<app_address>_ is the Ingress address obtained earlier (for example, `pass:[https://108.141.70.228]`).
. Optional: To delete the CR, run the following command:
+
--
[source,terminal,subs="+attributes,+quotes"]
----
kubectl -n {my-product-namespace} delete -f rhdh.yaml
----
--
