:_mod-docs-content-type: PROCEDURE

[id="proc-integrating-github-health-metrics-using-scorecards_{context}"]
= Integrating GitHub health metrics using Scorecards

You can configure the GitHub Scorecard plugin to display repository metrics in your {product-very-short} catalog. This integration allows you to monitor component health and security risks directly from {product}.

You can grant {product-very-short} access to the GitHub API by using a https://docs.github.com/en/apps/overview[GitHub App] or a https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens[GitHub token].

[IMPORTANT]
====
For long-lived integrations or organizational access, you must use a GitHub App.
====

.Prerequisites

* You have {install-category-link}[installed your {product-very-short} instance].
* You have {scorecard-plugin-book-link}#proc-installing-scorecard-plugin-in-rhdh-instance[installed the Scorecard images].
* Optional: If you choose the GitHub App option, you must have permissions in GitHub to create and manage a GitHub App.
* You must have {configuring-book-link}[added a custom {product-very-short} application configuration] and have enough permissions to change it.

.Procedure
To install and configure GitHub Scorecards in your {product-very-short} instance, complete the following steps:

. Grant GitHub API access: Create one of the following authentication methods:
** Configure using a GitHub App.
... Create a https://docs.github.com/en/apps/overview[GitHub App] with the required permissions (Read-only for Contents to allow reading repositories).
+
[NOTE]
====
You must install the GitHub App on the organization (or user account) that owns repositories you want access to, granting it the necessary repository access permissions.
====
.... In the *General > Clients secrets* section, click *Generate a new client secret*.
.... In the *General > Private keys* section, click *Generate a private key*.
.... In the *Install App* tab, choose an account to install your GitHub App on.
.... Record the *App ID*, *Client ID*, *Client Secret*, and *Private key* values.

... Add secrets to {product-very-short} by adding the following key/value pairs to your 
{configuring-book-link}#provisioning-your-custom-configuration[{product-very-short} secrets]. You can use these secrets in the {product-very-short} configuration files by using their respective environment variable names.
+
* `GITHUB_INTEGRATION_APP_ID`:: The saved *App ID*.
* `GITHUB_INTEGRATION_CLIENT_ID`:: The saved *Client ID*.
* `GITHUB_INTEGRATION_CLIENT_SECRET`:: The saved *Client Secret*.
* `GITHUB_INTEGRATION_HOST_DOMAIN`:: The GitHub host domain: `github.com`.
* `GITHUB_INTEGRATION_ORGANIZATION`:: Your GitHub organization name, such as `_<your_github_organization_name>_`.
* `GITHUB_INTEGRATION_PRIVATE_KEY_FILE`:: The saved *Private key* content.

... Configure the GitHub integration in your {product-very-short} `{my-app-config-file}` file by adding the authentication details to the `integrations.github` section:
+
[source,yaml]
----
integrations:
  github:
    - host: ${GITHUB_INTEGRATION_HOST_DOMAIN}
      apps:
        - appId: ${GITHUB_INTEGRATION_APP_ID}
          clientId: ${GITHUB_INTEGRATION_CLIENT_ID}
          clientSecret: ${GITHUB_INTEGRATION_CLIENT_SECRET}
          privateKey: |
            ${GITHUB_INTEGRATION_PRIVATE_KEY_FILE}
----

** Configure using a GitHub token.
... Create a https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens[GitHub token] with the following permissions:
**** https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-personal-access-token-classic[Classic Personal Access Token] (PAT): Select the `repo` scope for read/write access to private repositories.
**** https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/managing-your-personal-access-tokens#creating-a-fine-grained-personal-access-token[Fine-Grained Personal Access Token] (PAT):
***** Choose the specific repositories that {product-very-short} must access.
***** Grant the token a **Read** permission for **Contents**.

... Add the token to {product-very-short} secrets by adding the following key/value pair to your {configuring-book-link}#provisioning-your-custom-configuration[{product-very-short} secrets].
+
where:

`GITHUB_TOKEN`:: The generated GitHub token.

... Configure the GitHub integration in your {product-very-short} `{my-app-config-file}` file by adding the authentication details to the `integrations.github` section:
+
[source,yaml]
----
integrations:
  github:
    - host: github.com
      token: ${GITHUB_TOKEN}
----

. Enable the GitHub Scorecard plugin: Add the GitHub Scorecard module to your {product-very-short} `dynamic-plugins-config.yaml` file:
+
[source,yaml]
----
plugins:
  - package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-scorecard-backend-module-github:bs_1.45.3__2.3.5!red-hat-developer-hub-backstage-plugin-scorecard-backend-module-github
    disabled: false
----

. Annotate catalog entities: Link a component to the GitHub data source by editing the `catalog-info.yaml` file for your {product-very-short} entity and adding the required annotations as shown in the following code:
+
[source,yaml]
----
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: my-service
  annotations:
    # Required: GitHub project slug in format "owner/repository"
    github.com/project-slug: myorg/my-service
    # Required: Entity source location
    backstage.io/source-location: url:https://github.com/myorg/my-service
spec:
  type: service
  lifecycle: production
  owner: _<your_team_name>_
----
+
where:

`annotations:github.com/project-slug`:: The GitHub repository format, for example, `owner/repository`.
`annotations:backstage.io/source-location`:: The entity source location format, for example, `url:https://github.com/owner/repository`.
`spec:owner`:: Your team name.
+
[NOTE]
====
You must add the team entity to the Catalog to ensure the provided permissions are applicable.
====

. Ingest the catalog entity: Add the location of your `catalog-info.yaml` to the `catalog.locations` section in your {product-very-short} `{my-app-config-file}` file:
+
[source,yaml]
----
catalog:
  locations:
    - type: url
      target: https://github.com/<owner>/<repository>/catalog-info.yaml
----

. Optional: Customize thresholds:  Define custom roles for the *GitHub Open Pull Requests* (`github.open_prs`) metric in your {product-very-short} `{my-app-config-file}` file:
+
[source,yaml]
----
scorecard:
  plugins:
    github:
      open_prs:
        thresholds:
          rules:
            - key: success
              expression: '<10'
            - key: warning
              expression: '10-50'
            - key: error
              expression: '>50'
----
+
where:

`scorecard:plugins:github:open_prs:thresholds`:: Lists the default threshold values for the GitHub open PRs metric.
