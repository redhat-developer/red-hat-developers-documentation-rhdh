:_mod-docs-content-type: PROCEDURE

[id="proc-using-question-validation_{context}"]
= Using Question Validation in {ls-short}

Question Validation is a feature utilized by {ls-short} to validate user queries, making sure they relate specifically to {product-very-short} and related topics. When enabled, this feature restricts questions to {product-very-short}-related topics for enhanced security.

.Prerequisites

* The {ls-brand-name} plugin must be configured in your {product-very-short} instance.
* The {lcs-short} and Llama Stack sidecars must be deployed, as LCS implements `Question Validation` as a safety shield on the Llama Stack.

.Procedure

The `Question Validation` feature is controlled through configuration settings in both the frontend plugin configuration and the Llama Stack backend.

. To ensure the feature is explicitly enabled or to confirm its state, in the {ls-short} application configuration file (`lightspeed-app-config.yaml`), verify the setting as shown in the following code:
+
[source,yaml]
----
lightspeed:
# OPTIONAL: Enable/disable question validation (default: true)
# When enabled, restricts questions to RHDH-related topics for better security
  questionValidation: true
----
[NOTE]
====
* By default, `Question Validation` is typically enabled, restricting queries to {product-very-short}-related topics. 

* This file must also include the LLM server configuration, referencing environment variables sourced from a Kubernetes Secret.
====
. Verify backend safety shield configuration by configuring the `lightspeed_question_validity` provider in the Llama Stack sidecar `run.yaml` file. This shield defines the allowed topics (Backstage, {product-very-short}, Kubernetes, Openshift, CI/CD, and GitOps Pipelines). For example:
+
[source,yaml,subs=+attributes]
----
safety:
  - config:
      excluded_categories: []
    provider_id: llama-guard
    provider_type: inline::llama-guard
  - provider_id: lightspeed_question_validity
    provider_type: inline::lightspeed_question_validity
    config:
      model_id: ${env.VALIDATION_PROVIDER:=vllm}/${env.VALIDATION_MODEL_NAME}
      model_prompt: |-
        Instructions:

        You are a question classification tool. You are an expert in the following categories:
        - {backstage}
        - {product} ({product-very-short})
        - Kubernetes
        - Openshift
        - CI/CD
        - GitOps
        - Pipelines
        - Developer Portals
        - Deployments
        - Software Catalogs
        - Software Templates
        - Tech Docs
        
        Your job is to determine if a user's question is related to the categories you are an expert in. If the question is related to those categories, \
        or any features that may be related to those categories, you will answer with ${allowed}.

        If a question is not related to your expert categories, answer with ${rejected}.

        You do not need to explain your answer.

        Below are some example questions:
        Example Question:
        Why is the sky blue?
        Example Response:
        ${rejected}

        Example Question:
        Can you help configure my cluster to automatically scale?
        Example Response:
        ${allowed}

        Example Question:
        How do I create import an existing software template in Backstage?
        Example Response:
        ${allowed}

        Example Question:
        How do I accomplish a task in {product-very-short}?
        Example Response:
        ${allowed}

        Example Question:
        How do I explore a component in {product-very-short} catalog?
        Example Response:
        ${allowed}

        Example Question:
        How can I integrate GitOps into my pipeline?
        Example Response:
        ${allowed}

        Question:
        ${message}
        Response:
      invalid_question_response: |-
        Hi, I'm the Red Hat Developer Hub Lightspeed assistant, I can help you with questions about Red Hat Developer Hub or Backstage.
        Please ensure your question is about these topics, and feel free to ask again!
...
shields:
  - shield_id: lightspeed_question_validity-shield
    provider_id: lightspeed_question_validity
----