// ARCHIVED

:_mod-docs-content-type: PROCEDURE
[id="proc-installing-and-configuring-lightspeed_{context}"]
= Installing and configuring {ls-brand-name}

You must install and configure both the {ls-short} and the {rcs-short} sidecar container manually.

.Prerequisites
* You are logged into your {ocp-short} account.
* You have an {product-very-short} instance installed either of the following ways:
** {installing-on-ocp-book-link}#assembly-install-rhdh-ocp-operator[Using the Operator]
** {installing-on-ocp-book-link}#assembly-install-rhdh-ocp-helm[Using the Helm chart]

.Procedure

. Create the {rcs-short} ConfigMap.
.. In the {ocp-short} web console, go to your {product-very-short} instance and select the *ConfigMaps* tab.
.. Click *Create ConfigMaps*.
.. From the *Create ConfigMap* page, select the *YAML view* option in *Configure via*, and edit the file as shown in the following example:
+
[source,yaml]
----
kind: ConfigMap
apiVersion: v1
metadata:
 name: rcsconfig
 namespace: _<namespace>_ # Enter your namespace (For example, `rhdh`)
data:
 rcsconfig.yaml: |
  llm_providers:
    # Start: Do not remove this block
    - name: dummy
      type: openai
      url: https://dummy.com
      models:
        - name: dummymodel
      # End: Do not remove this block
  ols_config:
    user_data_collection:
      log_level: "DEBUG"
      feedback_disabled: false
      feedback_storage: "/tmp/feedback"
    reference_content:
      product_docs_index_path: "./vector_db/rhdh_product_docs/1.7"
      product_docs_index_id: rhdh-product-docs-1_7
      embeddings_model_path: "./embeddings_model"
    conversation_cache:
      type: memory
      memory:
        max_entries: 1000
    logging_config:
      app_log_level: info
      lib_log_level: warning
      uvicorn_log_level: info
      suppress_metrics_in_log: false
      suppress_auth_checks_warning_in_log: false
    authentication_config:
      module: "noop"
    default_provider: dummy
    default_model: dummymodel
    query_validation_method: disabled
  dev_config:
    enable_dev_ui: false
    disable_auth: false
    disable_tls: true
    enable_system_prompt_override: true
  user_data_collector_config:
    user_agent: "example-user-agent"
    ingress_url: "https://example.ingress.com/upload"
----
+
[IMPORTANT]
====
Do not remove the block in the `llm_providers` section. This requirement is crucial when working with {ls-short} because of limitations discovered in Road Core. For instances where you decide to use an alternative LLM provider, you should refer to additional information in the guide. For more information, see {developer-lightspeed-link}#proc-changing-your-llm-provider_customizing-developer-lightspeed[Changing your LLM provider].
====
.. Optional: Configure the number of workers that scale the REST API by specifying the following example to the `ols_config.max_workers` parameter in the {rcs-short} ConfigMap.
+
[source,yaml]
----
ols_config:
    max_workers: _<number_of_workers>_
----
.. Click *Create*.

. Create the {ls-short} ConfigMap.
+
[NOTE]
====
Create a dedicated {ls-short} ConfigMap instead of adding an additional section to your existing {product-very-short} custom application configuration file (for example, `lightspeed-app-config.yaml`). Creating two files prevents the entire {product-very-short} ConfigMap from being loaded into {rcs-short}.
====
.. In the {ocp-short} web console, go to your {product-very-short} instance and select the *ConfigMaps* tab.
.. Click *Create ConfigMap*.
.. From the *Create ConfigMap* page, select the *YAML view* option in *Configure via*, and add the following example:
+
[source,yaml,subs="+attributes"]
----
kind: ConfigMap
apiVersion: v1
metadata:
  name: lightspeed-app-config
  namespace: <__namespace__> # Enter your {product-very-short} instance namespace
data:
  app-config.yaml: |-
    backend:
      csp:
         upgrade-insecure-requests: false
       img-src:
          - "'self'"
          - "data:"
          - https://img.freepik.com
          - https://cdn.dribbble.com
          - https://avatars.githubusercontent.com # This is to load GitHub avatars in the UI
       script-src:
           - "'self'"
           - https://cdn.jsdelivr.net

    lightspeed:
      # REQUIRED: Configure LLM servers with OpenAI API compatibility
      servers:
        - id: ${LLM_SERVER_ID}
          url: ${LLM_SERVER_URL}
          token: ${LLM_SERVER_TOKEN}

      # OPTIONAL: Enable/disable question validation (default: true)
      # When enabled, restricts questions to RHDH-related topics for better security
      questionValidation: true

      # OPTIONAL: Custom users prompts displayed to users
      # If not provided, the plugin uses built-in default prompts
      prompts:
        - title: 'Getting Started with {product}'
          message: Can you guide me through the first steps to start using {product-short} as a developer, like exploring the Software Catalog and adding my service?

      # OPTIONAL: Port for lightspeed service (default: 8080)
      # servicePort: ${LIGHTSPEED_SERVICE_PORT}

      # OPTIONAL: Override default RHDH system prompt
      # systemPrompt: "You are a helpful assistant focused on {product} development."
----
. Create {ls-short} secret file.
.. In the {ocp-short} web console, go to *Secrets*.
.. Click *Create > Key/value secret*.
.. In the *Create key/value secret* page, select the *YAML view* option in *Configure via*, and add the following example:
+
[source,yaml]
----
kind: Secret
apiVersion: v1
metadata:
  name: lightspeed-secrets
  namespace: _<namespace>_ # Enter your rhdh instance namespace
stringData:
  LLM_SERVER_ID: _<server_id>_ # Enter your server ID (for example, `ollama` or `granite`)
  LLM_SERVER_TOKEN: _<token>_ # Enter your server token value
  LLM_SERVER_URL: _<server_url>_ # Enter your server URL
type: Opaque
----
.. Click *Create*.

. To your existing dynamic plugins ConfigMap (for example, `dynamic-plugins-rhdh.yaml`), add the {ls-short} plugin image as shown in the following example:
+
[source,yaml,subs="+attributes"]
----
includes:
  - dynamic-plugins.default.yaml
 plugins:
  - package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-lightspeed:bs_1.39.1__0.5.7!red-hat-developer-hub-backstage-plugin-lightspeed
    disabled: false
    pluginConfig:
      lightspeed:
        # OPTIONAL: Custom users prompts displayed to users
        # If not provided, the plugin uses built-in default prompts
        prompts:
          - title: 'Getting Started with {product}'
            message: Can you guide me through the first steps to start using {product-short}
              as a developer, like exploring the Software Catalog and adding my
              service?
      dynamicPlugins:
        frontend:
          red-hat-developer-hub.backstage-plugin-lightspeed:
            appIcons:
              - name: LightspeedIcon
                module: LightspeedPlugin
                importName: LightspeedIcon
            dynamicRoutes:
              - path: /lightspeed
                importName: LightspeedPage
                module: LightspeedPlugin
                menuItem:
                  icon: LightspeedIcon
                  text: Lightspeed
  - package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-lightspeed-backend:bs_1.39.1__0.5.7!red-hat-developer-hub-backstage-plugin-lightspeed-backend
    disabled: false
    pluginConfig:
      lightspeed:
        # REQUIRED: Configure LLM servers with OpenAI API compatibility
        servers:
          - id: ${LLM_SERVER_ID}
            url: ${LLM_SERVER_URL}
            token: ${LLM_SERVER_TOKEN}

        # OPTIONAL: Port for lightspeed service (default: 8080)
        # servicePort: ${LIGHTSPEED_SERVICE_PORT}
----

. Update your deployment configuration based on your installation method:
.. For an Operator-installed {product-very-short} instance, update your {product-custom-resource-type} custom resource (CR).
... In the `spec.application.appConfig.configMaps` section, add the {ls-short} custom app configuration as shown in the following example:
+
[source,yaml]
----
      appConfig:
        configMaps:
          - name: lightspeed-app-config
        mountPath: /opt/app-root/src
----
... Update the `extraVolumes` specification to include the {rcs-short} ConfigMap as shown in the following example:
+
[source,yaml]
----
            volumes:
              - configMap:
                  name: rcsconfig
                name: rcsconfig
----
... Update the `volumeMounts` specification to mount the {rcs-short} ConfigMap as shown in the following example:
+
[source,yaml]
----
        volumeMounts:
          - mountPath: /app-root/config/rcsconfig.yaml
            name: rcsconfig
            subPath: rcsconfig.yaml
          - mountPath: /app-root/config/app-config-rhdh.yaml
            name: lightspeed-app-config
            subPath: app-config.yaml
----
... Add the {ls-short} Secret file as shown in the following example:
+
[source,yaml]
----
        envFrom:
          - secretRef:
              name: lightspeed-secrets
----
... In your `deployment.patch.spec.template.spec.containers.env` section, set the {rcs-short} environment variables as shown in the following example:
+
[source,yaml]
----
    - name: PROJECT
      value: rhdh
    - name: RCS_CONFIG_FILE
      value: /app-root/config/rcsconfig.yaml
    - name: RHDH_CONFIG_FILE
      value: /app-root/config/app-config-rhdh.yaml
----
+
[NOTE]
====
Your {product-very-short} container is typically already present in your CR. You are adding the second container definition `road-core-sidecar` as the {rcs-short} sidecar.
====
... Click *Save*. The Pods are automatically restarted.
+
.Example of a Backstage CR with the {rcs-short} container
[source,yaml,subs=+attributes]
----
apiVersion: rhdh.redhat.com/v1alpha3
kind: Backstage
metadata:
  name: backstage
  namespace: _<namespace>_ # your {product-very-short} instance namespace
spec:
  application:
    appConfig:
     configMaps:
# Adding the Developer Lightspeed custom app config file
       - name: lightspeed-app-config
     mountPath: /opt/app-root/src
    dynamicPluginsConfigMapName: dynamic-plugins-rhdh
    extraEnvs:
# Adding the Developer Lightspeed secrets file
      secrets:
        - name: lightspeed-secrets
    replicas: 1
    extraFiles:
      mounthPath: /opt/app-root/src
    replicas: 1
    route:
      enabled: true
  database:
    enableLocalDb: true
  deployment:
    patch:
      spec:
        template:
          spec:
            containers:
              - env:
                  - name: PROJECT
                    value: rhdh
# Mounting the RCS sidecar to your {product-very-short} instance
                  - name: RCS_CONFIG_FILE
                    value: /app-root/config/rcsconfig.yaml
# Your existing {product-very-short} ConfigMap
                  - name: RHDH_CONFIG_FILE
                    value: /app-root/config/app-config-rhdh.yaml
                envFrom:
                  - secretRef:
                      name: lightspeed-secrets
                image: 'quay.io/redhat-ai-dev/road-core-service:rcs-06302025-rhdh-1.7'
                name: road-core-sidecar
                ports:
                  - containerPort: 8080
                    name: rcs-backend
                    protocol: TCP
                volumeMounts:
# Mounting the RCS sidecar to your {product-very-short} instance
                  - mountPath: /app-root/config/rcsconfig.yaml
                    name: rcsconfig
                    subPath: rcsconfig.yaml
# Mounting the Lightspeed app config file to your RCS container
                  - mountPath: /app-root/config/app-config-rhdh.yaml
                    name: lightspeed-app-config
                    subPath: app-config.yaml
            volumes:
              - configMap:
                  name: rcsconfig
                name: rcsconfig

----
.. For a Helm-installed {product-very-short} instance, update your Helm chart.
... Add your dynamic plugins configuration in the`global.dynamic` property as shown in the following example:
+
[source,yaml,subs="+attributes"]
----
global:
dynamic:
  includes:
  - dynamic-plugins.default.yaml
  plugins:
  - package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-lightspeed:bs_1.39.1__0.5.7!red-hat-developer-hub-backstage-plugin-lightspeed
    disabled: false
    pluginConfig:
      lightspeed:
        # OPTIONAL: Custom users prompts displayed to users
        # If not provided, the plugin uses built-in default prompts
        prompts:
          - title: 'Getting Started with {product}'
            message: Can you guide me through the first steps to start using {product-short}
              as a developer, like exploring the Software Catalog and adding my
              service?
      dynamicPlugins:
        frontend:
          red-hat-developer-hub.backstage-plugin-lightspeed:
            appIcons:
              - name: LightspeedIcon
                module: LightspeedPlugin
                importName: LightspeedIcon
            dynamicRoutes:
              - path: /lightspeed
                importName: LightspeedPage
                module: LightspeedPlugin
                menuItem:
                  icon: LightspeedIcon
                  text: Lightspeed
  - package: oci://ghcr.io/redhat-developer/rhdh-plugin-export-overlays/red-hat-developer-hub-backstage-plugin-lightspeed-backend:bs_1.39.1__0.5.7!red-hat-developer-hub-backstage-plugin-lightspeed-backend
    disabled: false
    pluginConfig:
      lightspeed:
        # REQUIRED: Configure LLM servers with OpenAI API compatibility
        servers:
          - id: ${LLM_SERVER_ID}
            url: ${LLM_SERVER_URL}
            token: ${LLM_SERVER_TOKEN}
        # OPTIONAL: Port for lightspeed service (default: 8080)
        # servicePort: ${LIGHTSPEED_SERVICE_PORT}
----
... Add your {ls-short} custom app config file as shown in the following example:
+
[source,yaml]
----
 extraAppConfig:
      - configMapRef: lightspeed-app-config
        filename: app-config.yaml
----
... Update the `extraVolumes` section to include the {rcs-short} ConfigMap as shown in the following example:
+
[source,yaml]
----
extraVolumes:
      - configMap:
          name: rcsconfig
        name: rcsconfig
----
... Update the `extraVolumeMounts` section to mount the {rcs-short} ConfigMap as shown in the following example:
+
[source,yaml]
----
 extraVolumeMounts:
      - mountPath: /app-root/config/rcsconfig.yaml
        name: rcsconfig
----
... Add the {ls-short} Secret file as shown in the following example:
+
[source,yaml]
----
 extraEnvVarsSecrets:
      - lightspeed-secrets
----
... Add the {rcs-short} image as shown in the following example:
+
[source,yaml,subs="+attributes"]
----
   extraContainers:
      - env:
          - name: PROJECT
            value: rhdh
          - name: RCS_CONFIG_FILE
            value: /app-root/config/rcsconfig.yaml
          - name: RHDH_CONFIG_FILE
            value: /app-root/config/lightspeed-app-config.yaml
        envFrom:
          - secretRef:
              name: lightspeed-secrets
        image: 'quay.io/redhat-ai-dev/road-core-service:rcs-06302025-rhdh-1.7'
        name: road-core-sidecar
        ports:
          - containerPort: 8080
            name: rcs-backend
            protocol: TCP
        volumeMounts:
          - mountPath: /app-root/config/rcsconfig.yaml
            name: rcsconfig
            subPath: rcsconfig.yaml
          - mountPath: /app-root/config/lightspeed-app-config.yaml
            name: lightspeed-app-config
            subPath: app-config.yaml
----
+
[NOTE]
====
Your {product-very-short} container is typically already present in your Helm chart. You are adding the second container definition `road-core-sidecar` as the {rcs-short} sidecar.
====
... Click *Save*.
... Click *Helm upgrade*.
+
.Example of a Helm chart with the RCS container
[source,yaml,subs="+attributes"]
----
global:
 ...
upstream:
 backstage:
   appConfig:
     ...
   args:
     ...
   extraAppConfig:
     - configMapRef: lightspeed-app-config
       filename: app-config.yaml
   extraContainers:
     - env:
         - name: PROJECT
           value: rhdh
         - name: RCS_CONFIG_FILE
           value: /app-root/config/rcsconfig.yaml
         - name: RHDH_CONFIG_FILE
           value: /app-root/config/lightspeed-app-config.yaml
       envFrom:
         - secretRef:
             name: lightspeed-secrets
       image: 'quay.io/redhat-ai-dev/road-core-service:rcs-06302025-rhdh-1.7'
       name: road-core-sidecar
       ports:
         - containerPort: 8080
           name: rcs-backend
           protocol: TCP
       volumeMounts:
         - mountPath: /app-root/config/rcsconfig.yaml
           name: rcsconfig
           subPath: rcsconfig.yaml
         - mountPath: /app-root/config/lightspeed-app-config.yaml
           name: lightspeed-app-config
           subPath: lightspeed-app-config.yaml
   extraEnvVars:
     ...
   extraEnvVarsSecrets:
     - lightspeed-secrets
   extraVolumeMounts:
     - mountPath: /app-root/config/rcsconfig.yaml
       name: rcsconfig
   extraVolumes:
     - configMap:
         name: rcsconfig
       name: rcsconfig
     ...
   image:
     ...
   initContainers:
     ...
----

. Manage your authorization based on your installation method:
.. For an Operator-installed {product-very-short} instance, define permissions and roles for your users who are not administrators by completing the following steps:
... Configure the required RBAC permission by defining an `rbac-policies.csv` file as shown in the following example:
+
[source,yaml]
----
p, role:default/_<your_team>_, lightspeed.chat.read, read, allow
p, role:default/_<your_team>_, lightspeed.chat.create, create, allow
p, role:default/_<your_team>_, lightspeed.chat.delete, delete, allow

g, user:default/_<your_user>_, role:default/_<your_team>_
----
... Upload your `rbac-policies.csv` file to an `rbac-policies` config map in your {ocp-short} project containing {product-very-short}.
... Update your {product-custom-resource-type} custom resource to mount in the {product-very-short} filesystem your files from the `rbac-policies` ConfigMap:
+
[source,yaml]
----
apiVersion: rhdh.redhat.com/v1alpha3
kind: Backstage
spec:
  application:
    extraFiles:
      mountPath: /opt/app-root/src
      configMaps:
        - name: rbac-policies
----
For detailed information, see {authorization-book-link}##con-rbac-conditional-policies-rhdh_title-authorization[Managing authorizations by using external files].

.. For a Helm-installed {product-very-short} instance,  define permissions and roles for your users who are not administrators by completing the following steps:

... Configure the required RBAC permission by defining an `rbac-policies.csv` file as shown in the following example:
+
[source,yaml]
----
p, role:default/_<your_team>_, lightspeed.chat.read, read, allow
p, role:default/_<your_team>_, lightspeed.chat.create, create, allow
p, role:default/_<your_team>_, lightspeed.chat.delete, delete, allow

g, user:default/_<your_user>_, role:default/_<your_team>_
----
... Declare policy administrators to enable a select number of authenticated users to configure RBAC policies through the REST API or Web UI, instead of modifying the CSV file directly. The permissions can be specified in a separate CSV file referenced in your `my-rhdh-app-config` config map, or permissions can be created using the REST API or Web UI.
To declare users such as _<your_policy_administrator_name>_ as policy administrators, edit your custom {product-very-short} ConfigMap, such as `app-config-rhdh`, and add following code to the `app-config.yaml` content:
+
[source,yaml]
----
permission:
  enabled: true
  rbac:
    policies-csv-file: /opt/app-root/src/rbac-policies.csv
    policyFileReload: true
    admin:
      users:
        - name: user:default/<your_policy_administrator_name>
----

See {authorization-book-link}##defining-authorizations-in-external-files-by-using-helm[Defining authorizations in external files by using Helm].

.Verification

. Log in to your {product-very-short} instance.
. In your {product} navigation menu, you are able to see and access the *Lightspeed* menu item. Clicking this menu takes you to the {ls-short} screen.

image::rhdh-plugins-reference/developer-lightspeed.png[]
