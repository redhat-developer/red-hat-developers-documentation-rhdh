[id="enabling-authentication-with-rhsso"]
= Enabling authentication with {rhsso-brand-name} ({rhsso})

To authenticate users with Red Hat Single Sign-On ({rhsso}), enable the OpenID Connect (OIDC) authentication provider in {product}.


.Prerequisites
* You link:https://docs.redhat.com/en/documentation/red_hat_developer_hub/{product-version}/html/administration_guide_for_red_hat_developer_hub/assembly-add-custom-app-file-openshift_admin-rhdh[added a custom {product-short} application configuration], and have sufficient permissions to modify it.
* You have sufficient permissions in {rhsso} to create and manage a realm.

.Procedure
. To allow {product-short} to authenticate with {rhsso}, complete the steps in {rhsso}, to link:https://docs.redhat.com/en/documentation/red_hat_single_sign-on/7.6/html-single/getting_started_guide/index#realms-apps_[create a realm and a user] and link:https://docs.redhat.com/en/documentation/red_hat_single_sign-on/7.6/html-single/getting_started_guide/index#registering-app_[register the {product-short} application]:

.. Use an existing realm, or link:https://docs.redhat.com/en/documentation/red_hat_single_sign-on/7.6/html-single/getting_started_guide/index#create-realm_[create a realm], with a distinctive **Name** such as __<my_realm>__.
Save the value for the next step:
* **{rhsso} realm base URL**, such as: __<your_rhsso_URL>__/auth/realms/__<your_realm>__.

.. To register your {product-short} in {rhsso}, in the created realm, link:https://docs.redhat.com/en/documentation/red_hat_single_sign-on/7.6/html-single/getting_started_guide/index#registering-app_[create a Client ID], with:
... **Client ID**: A distinctive client ID, such as __<{product-very-short}>__.
... **Valid redirect URIs**: Set to the OIDC handler URL: `https://__<RHDH_URL>__/api/auth/oidc/handler/frame`.
... Navigate to the **Credentials** tab and copy the **Client secret**.
... Save the values for the next step:
* **Client ID**
* **Client Secret**

.. To prepare for the verification steps, in the same realm, get the credential information for an existing user or link:https://docs.redhat.com/en/documentation/red_hat_single_sign-on/7.6/html-single/getting_started_guide/index#create-user_[create a user]. Save the user credential information for the verification steps.

. To add your {rhsso} credentials to your {product-short} secrets, edit your {product-short} secrets, such as `secrets-rhdh`, and add the following key/value pairs:
+
`AUTH_OIDC_CLIENT_ID`:: Enter the saved **Client ID**.
`AUTH_OIDC_CLIENT_SECRET`:: Enter the saved **Client Secret**.
`AUTH_OIDC_METADATA_URL`:: Enter the saved **{rhsso} realm base URL**.

. To set up the {rhsso} authentication provider in your {product-short} custom configuration, edit your custom {product-short} ConfigMap such as `app-config-rhdh`, and add the following lines to the `app-config-rhdh.yaml` content:
+
--
.`app-config-rhdh.yaml` fragment with mandatory fields to enable authentication with {rhsso}
[source,yaml]
----
auth:
  environment: production
  providers:
    oidc:
      production:
        metadataUrl: ${AUTH_OIDC_METADATA_URL}
        clientId: ${AUTH_OIDC_CLIENT_ID}
        clientSecret: ${AUTH_OIDC_CLIENT_SECRET}
signInPage: oidc
----

`environment: production`::
Mark the environment as `production` to hide the Guest login in the {product-short} home page.

`metadataUrl`, `clientId`, `clientSecret`::
To configure the OIDC provider with your secrets.

`sigInPage: oidc`::
To enable the OIDC provider as default sign-in provider.


Optional: Consider adding the following optional fields:

`dangerouslyAllowSignInWithoutUserInCatalog: true`::
+
--
To enable authentication without requiring to provision users in the {product-short} software catalog.
+
WARNING: Use this option to explore {product-short} features, but do not use it in production.
+
.`app-config-rhdh.yaml` fragment with optional field to allow authenticating users absent from the software catalog
[source,yaml]
----
auth:
  environment: production
  providers:
    oidc:
      production:
        metadataUrl: ${AUTH_OIDC_METADATA_URL}
        clientId: ${AUTH_OIDC_CLIENT_ID}
        clientSecret: ${AUTH_OIDC_CLIENT_SECRET}
signInPage: oidc
dangerouslyAllowSignInWithoutUserInCatalog: true
----
--

`callbackUrl`::
--
{rhsso} callback URL.

.`app-config-rhdh.yaml` fragment with optional `callbackURL` field
[source,yaml]
----
auth:
  providers:
    oidc:
      production:
        callbackUrl: ${AUTH_OIDC_CALLBACK_URL}
----
--

`tokenEndpointAuthMethod`::
--
Token endpoint authentication method.

.`app-config-rhdh.yaml` fragment with optional `tokenEndpointAuthMethod` field
[source,yaml]
----
auth:
  providers:
    oidc:
      production:
        tokenEndpointAuthMethod: ${AUTH_OIDC_TOKEN_ENDPOINT_METHOD}
----
--

`tokenSignedResponseAlg`::
--
Token signed response algorithm.

.`app-config-rhdh.yaml` fragment with optional `tokenSignedResponseAlg` field
[source,yaml]
----
auth:
  providers:
    oidc:
      production:
        tokenSignedResponseAlg: ${AUTH_OIDC_SIGNED_RESPONSE_ALG}
----
--

`scope`::
--
{rhsso} scope.

.`app-config-rhdh.yaml` fragment with optional `scope` field
[source,yaml]
----
auth:
  providers:
    oidc:
      production:
        scope: ${AUTH_OIDC_SCOPE}
----
--

`signIn.resolvers`::
--
Declarative resolvers to override the default resolver: `emailLocalPartMatchingUserEntityName`.
The authentication provider tries each sign-in resolver until it succeeds, and fails if none succeed.

.`app-config-rhdh.yaml` fragment with optional `callbackURL` field
[source,yaml]
----
auth:
  providers:
    oidc:
      production:
        signIn:
          resolvers:
            - resolver: preferredUsernameMatchingUserEntityName
            - resolver: emailMatchingUserEntityProfileEmail
            - resolver: emailLocalPartMatchingUserEntityName
----
--

--

.Verification
. Go to the {product-short} login page.
. Your {product-short} sign-in page displays *Sign in using OIDC* and the Guest user sign-in is disabled.
. Log in with OIDC by using the saved **Username** and **Password** values.

