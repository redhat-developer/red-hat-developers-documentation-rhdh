[id="provisioning-users-from-rhsso-to-the-software-catalog"]
= Provisioning users from {rhsso-brand-name} ({rhsso}) to the software catalog

.Prerequisites
* You xref:enabling-authentication-with-rhsso[enabled authentication with {rhsso}].

.Procedure

* To enable {rhsso} member discovery, edit your custom {product-short} ConfigMap, such as `app-config-rhdh`, and add the following lines to the `app-config-rhdh.yaml` content:
+
--
[id=keycloakOrgProviderId]
.`app-config.yaml` fragment with mandatory `keycloakOrg` fields
[source,yaml]
----
dangerouslyAllowSignInWithoutUserInCatalog: false
catalog:
  providers:
    keycloakOrg:
      default:
        baseUrl: ${AUTH_OIDC_METADATA_URL}
        clientId: ${AUTH_OIDC_CLIENT_ID}
        clientSecret: ${AUTH_OIDC_CLIENT_SECRET}
----

`dangerouslyAllowSignInWithoutUserInCatalog: false`::
 Allow authentication only for users present in the {product-short} software catalog.

`baseUrl`::
Your {rhsso} server URL, defined when xref:enabling-authentication-with-rhsso[enabling authentication with {rhsso}].

`clientId`::
Your {product-short} application client ID in {rhsso}, defined when xref:enabling-authentication-with-rhsso[enabling authentication with {rhsso}].

`clientSecret`::
Your {product-short} application client secret in {rhsso}, defined when xref:enabling-authentication-with-rhsso[enabling authentication with {rhsso}].

Optional: Consider adding the following optional fields:

`realm`::
Realm to synchronize.
Default value: `master`.
+
.`app-config.yaml` fragment with optional `realm` field
[source,yaml]
----
catalog:
  providers:
    keycloakOrg:
      default:
        realm: master
----

`loginRealm`::
Realm used to authenticate.
Default value: `master`.
+
.`app-config.yaml` fragment with optional `loginRealm` field
[source,yaml]
----
catalog:
  providers:
    keycloakOrg:
      default:
        loginRealm: master
----

`userQuerySize`::
User number to query simultaneously.
Default value: `100`.
+
.`app-config.yaml` fragment with optional `userQuerySize` field
[source,yaml]
----
catalog:
  providers:
    keycloakOrg:
      default:
        userQuerySize: 100
----

`groupQuerySize`::
Group number to query simultaneously.
Default value: `100`.
+
.`app-config.yaml` fragment with optional `groupQuerySize` field
[source,yaml]
----
catalog:
  providers:
    keycloakOrg:
      default:
        groupQuerySize: 100
----

`schedule.frequency`::
To specify custom schedule frequency.
Supports cron, ISO duration, and "human duration" as used in code.
+
.`app-config.yaml` fragment with optional `schedule.frequency` field
[source,yaml]
----
catalog:
  providers:
    keycloakOrg:
      default:
        schedule:
          frequency: { hours: 1 }
----

`schedule.timeout`::
To specify custom timeout.
Supports ISO duration and "human duration" as used in code.
+
.`app-config.yaml` fragment with optional `schedule.timeout` field
[source,yaml]
----
catalog:
  providers:
    keycloakOrg:
      default:
        schedule:
          timeout: { minutes: 50 }
----

`schedule.initialDelay`::
To specify custom initial delay.
Supports ISO duration and "human duration" as used in code.
+
.`app-config.yaml` fragment with optional `schedule.initialDelay` field
[source,yaml]
----
catalog:
  providers:
    keycloakOrg:
      default:
        schedule:
          initialDelay: { seconds: 15}
----
--

.Verification

. Check the console logs to verify that the synchronization is completed.
+
.Successful synchronization example:
[source,json]
----
{"class":"KeycloakOrgEntityProvider","level":"info","message":"Read 3 Keycloak users and 2 Keycloak groups in 1.5 seconds. Committing...","plugin":"catalog","service":"backstage","taskId":"KeycloakOrgEntityProvider:default:refresh","taskInstanceId":"bf0467ff-8ac4-4702-911c-380270e44dea","timestamp":"2024-09-25 13:58:04"}
{"class":"KeycloakOrgEntityProvider","level":"info","message":"Committed 3 Keycloak users and 2 Keycloak groups in 0.0 seconds.","plugin":"catalog","service":"backstage","taskId":"KeycloakOrgEntityProvider:default:refresh","taskInstanceId":"bf0467ff-8ac4-4702-911c-380270e44dea","timestamp":"2024-09-25 13:58:04"}
----

. Log in with an {rhsso} account.
