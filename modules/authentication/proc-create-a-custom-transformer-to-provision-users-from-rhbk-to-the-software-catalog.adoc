:_mod-docs-content-type: PROCEDURE

[id="create-a-custom-transformer-to-provision-users-from-rhbk-to-the-software-catalog"]
= Create a custom transformer to provision users from {rhbk-brand-name} ({rhbk}) to the software catalog

Customize how {product} provisions users and groups to {product} software catalog entities,
by creating a backend module that uses the `keycloakTransformerExtensionPoint` to offer custom user and group transformers for the Keycloak backend.

.Prerequisites
* You have xref:enable-user-authentication-with-rhbk-with-optional-steps[enabled provisioning users from {rhbk-brand-name} ({rhbk}) to the software catalog].

.Procedure
. Create a new backend module with the `yarn new` command.
+
----
$ yarn new
? What type of module would you like to create? backend-plugin-module
? Enter the ID of the plugin [required] catalog
? Enter the ID of the module [required] keycloak-org-transformer
----
+
The command creates a plugin named: `catalog-backend-module-keycloak-org-transformer`.

. Install required packages:
+
[source,shell]
----
$ yarn --cwd plugins/catalog-backend-module-keycloak-org-transformer add @backstage/plugin-catalog-backend-module-keycloak-org
----

. Refer to the link:https://github.com/redhat-developer/rhdh-examples/tree/main/plugins/backstage-plugin-catalog-backend-module-keycloak-org-transformer[sample plugin] and implement `plugins/catalog-backend-module-keycloak-org-transformer/src/module.ts`.

. Package and export the plugin as a Dynamic Plugin, and embed the required package for the custom transformer.
+
[source,shell]
----
$ npx @red-hat-developer-hub/cli@latest plugin export \
  --embed-package @backstage/plugin-catalog-backend-module-keycloak-org
----

[IMPORTANT]
====
Verify that the installed plugin version is compatible with the Backstage version

See plugin marketplace for the version to import.
====

.Verification

* {product-short} imports the users and groups each time when started.
Check the console logs to verify the synchronization result.
+
Successful synchronization example:
+
[source,json]
----
{"class":"KeycloakOrgEntityProvider","level":"info","message":"Read 3 Keycloak users and 2 Keycloak groups in 1.5 seconds. Committing...","plugin":"catalog","service":"backstage","taskId":"KeycloakOrgEntityProvider:default:refresh","taskInstanceId":"bf0467ff-8ac4-4702-911c-380270e44dea","timestamp":"2024-09-25 13:58:04"}
{"class":"KeycloakOrgEntityProvider","level":"info","message":"Committed 3 Keycloak users and 2 Keycloak groups in 0.0 seconds.","plugin":"catalog","service":"backstage","taskId":"KeycloakOrgEntityProvider:default:refresh","taskInstanceId":"bf0467ff-8ac4-4702-911c-380270e44dea","timestamp":"2024-09-25 13:58:04"}
----

* After the first import is complete, go to the *Catalog* page and select **User** to view the list of users.

* When you select a user, you see the information imported from {rhbk}.

* You can select a group, view the list, and access or review the information imported from {rhbk}.

* You can log in with an {rhbk} account.
