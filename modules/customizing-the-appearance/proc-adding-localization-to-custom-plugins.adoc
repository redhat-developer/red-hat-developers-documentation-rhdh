:_mod-docs-content-type: PROCEDURE

[id="proc-adding-localization-to-custom-plugins_{context}"]
= Implementing localization support for your custom plugins
You can implement localization support in your custom {product-very-short} plugins so that your plugins are accessible to a diverse, international user base and follow recommended best practices.

.Procedure
. Create the following translation files in your plugin's `src/translations/` directory:
+
.`src/translations/ref.ts` English reference
[source,json]
----
import { createTranslationRef } from "@backstage/core-plugin-api/alpha";

export const myPluginMessages = {
 page: {
   title: "My Plugin",
   subtitle: "Plugin description",
 },
 common: {
   exportCSV: "Export CSV",
   noResults: "No results found",
 },
 table: {
   headers: {
     name: "Name",
     count: "Count",
   },
 },
};

export const myPluginTranslationRef = createTranslationRef({
 id: "plugin.my-plugin",
 messages: myPluginMessages,
});
----
+
.`src/translations/de.ts` German translation
[source,json]
----
import { createTranslationMessages } from "@backstage/core-plugin-api/alpha";
import { myPluginTranslationRef } from "./ref";

const myPluginTranslationDe = createTranslationMessages({
 ref: myPluginTranslationRef,
 messages: {
   "page.title": "Mein Plugin",
   "page.subtitle": "Plugin-Beschreibung",
   "common.exportCSV": "CSV exportieren",
   "common.noResults": "Keine Ergebnisse gefunden",
   "table.headers.name": "Name",
   "table.headers.count": "Anzahl",
 },
});

export default myPluginTranslationDe;
----
+
.`src/translations/fr.ts` French translation
[source,json]
----
import { createTranslationMessages } from "@backstage/core-plugin-api/alpha";
import { myPluginTranslationRef } from "./ref";

const myPluginTranslationFr = createTranslationMessages({
 ref: myPluginTranslationRef,
 messages: {
   "page.title": "Mon Plugin",
   "page.subtitle": "Description du plugin",
   "common.exportCSV": "Exporter CSV",
   "common.noResults": "Aucun résultat trouvé",
   "table.headers.name": "Nom",
   "table.headers.count": "Nombre",
 },
});

export default myPluginTranslationFr;
----
+
.`src/translations/index.ts` Translation resource
[source,json]
----
import { createTranslationResource } from "@backstage/core-plugin-api/alpha";
import { myPluginTranslationRef } from "./ref";

export const myPluginTranslations = createTranslationResource({
 ref: myPluginTranslationRef,
 translations: {
   de: () => import("./de"),
   fr: () => import("./fr"),
 },
});

export { myPluginTranslationRef };
----

. Create translation hooks file, as follows:
+
.`src/hooks/useTranslation.ts` Translation hooks
[source,json]
----
import { useTranslationRef } from "@backstage/core-plugin-api/alpha";
import { myPluginTranslationRef } from "../translations";

export const useTranslation = () => useTranslationRef(myPluginTranslationRef);
----

. Update your plugin components to replace hard-coded strings with translation calls as shown in the following example:
+
.Before (hardcoded):
[source,json]
----
const MyComponent = () => {
 return (
   <div>
     <h1>My Plugin</h1>
     <button>Export CSV</button>
   </div>
 );
};
----
+
.After (translated):
[source,json]
----
import { useTranslation } from '../hooks/useTranslation';

const MyComponent = () => {
 const { t } = useTranslation();

 return (
   <div>
     <h1>{t('page.title')}</h1>
     <button>{t('common.exportCSV')}</button>
   </div>
 );
};
----

. (Optional) If your content contains variables, use interpolation:
+
[source,json]
----
// In your translation files
'table.pagination.topN': 'Top {{count}} items'

// In your component
const { t } = useTranslation();
const message = t('table.pagination.topN', { count: '10' });
----

. (Optional) If your content contains dynamic translation keys (for example, from your plugin configuration):
+
[source,json]
----
// Configuration object with translation keys
const CARD_CONFIGS = [
 { id: 'overview', titleKey: 'cards.overview.title' },
 { id: 'details', titleKey: 'cards.details.title' },
 { id: 'settings', titleKey: 'cards.settings.title' },
];

// In your component
const { t } = useTranslation();

const CardComponent = ({ config }) => {
 return (
   <div>
     <h2>{t(config.titleKey as any)}</h2>
     {/* Use 'as any' for dynamic keys */}
   </div>
 );
};
----

. Export the translation resources
+
[source,json]
.`src/alpha.ts` file fragment
----
// Export your plugin
export { myPlugin } from "./plugin";

// Export translation resources for RHDH
export { myPluginTranslations, myPluginTranslationRef } from "./translations";
----

. Update your `dynamic-plugins.default.yaml` file, as follows:
+
[source,json]
.`dynamic-plugins.default.yaml` file fragment
----
backstage-community.plugin-my-plugin:
 translationResources:
   - importName: myPluginTranslations
     ref: myPluginTranslationRef
     module: Alpha
----

.Verification
To verify your translations, create a test mock file. For example:

.`src/test-utils/mockTranslations.ts` Test mock file
[source,json]
----
import { myPluginMessages } from "../translations/ref";

function flattenMessages(obj: any, prefix = ""): Record<string, string> {
 const flattened: Record<string, string> = {};
 for (const key in obj) {
   if (obj.hasOwnProperty(key)) {
     const value = obj[key];
     const newKey = prefix ? `${prefix}.${key}` : key;
     if (typeof value === "object" && value !== null) {
       Object.assign(flattened, flattenMessages(value, newKey));
     } else {
       flattened[newKey] = value;
     }
   }
 }
 return flattened;
}

const flattenedMessages = flattenMessages(myPluginMessages);

export const mockT = (key: string, params?: any) => {
 let message = flattenedMessages[key] || key;
 if (params) {
   for (const [paramKey, paramValue] of Object.entries(params)) {
     message = message.replace(
       new RegExp(`{{${paramKey}}}`, "g"),
       String(paramValue),
     );
   }
 }
 return message;
};

export const mockUseTranslation = () => ({ t: mockT });
----

.Update your tests
[source,json]
----
import { mockUseTranslation } from "../test-utils/mockTranslations";

jest.mock("../hooks/useTranslation", () => ({
 useTranslation: mockUseTranslation,
}));

// Your test code...
----