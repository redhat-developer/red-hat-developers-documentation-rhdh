:_mod-docs-content-type: PROCEDURE

[id="provisioning-your-custom-configuration"]
= Provisioning your custom {product} configuration

To configure {product}, provision your custom {product} config maps and secrets to {platform-long} before running {product}.

[TIP]
====
On {ocp-brand-name}, you can skip this step to run {product-short} with the default config map and secret.
Your changes on this configuration might get reverted on {product-short} restart.
====

.Prerequisites
* By using the {platform-cli-link}, you have access, with developer permissions, to the {platform-generic} cluster aimed at containing your {product-short} instance.

ifeval::["{context}" == "setting-up-and-configuring-your-first-rhdh-instance"]
include::snip-provisioning-your-custom-configuration-prerequisites-in-setting-up-and-configuring-your-first-rhdh-instance-context.adoc[]
endif::[]

.Procedure
. For security, store your secrets as environment variables values in an {ocp-short} secret, rather than in clear text in your configuration files.
Collect all your secrets in the `secrets.txt` file, with one secret per line in `KEY=value` form.
+
--
ifeval::["{context}" == "setting-up-and-configuring-your-first-rhdh-instance"]
include::snip-provisioning-your-custom-configuration-secrets-steps-in-setting-up-and-configuring-your-first-rhdh-instance-context.adoc[]
endif::[]
ifeval::["{context}" != "setting-up-and-configuring-your-first-rhdh-instance"]
include::snip-provisioning-your-custom-configuration-secrets-steps-in-default-context.adoc[]
endif::[]
--

. Author your custom `{my-app-config-file}` file.
This is the main {product-short} configuration file.
You need a custom `{my-app-config-file}` file to avoid the {product-short} installer to revert user edits during upgrades.
When your custom `{my-app-config-file}` file is empty, {product-short} is using default values.
+
--
include::snip-provisioning-your-custom-configuration-appconfig-step-with-optional-steps-{optional-steps}d.adoc[]
--

. Author your custom `dynamic-plugins.yaml` file to enable plugins.
By default, {product-short} enables a minimal plugin set, and disables plugins that require configuration or secrets, such as the GitHub repository discovery plugin and the Role-based access control (RBAC) plugin.
+
Enable the GitHub repository discovery and the RBAC features:
+
.`dynamic.plugins.yaml`
[source,yaml]
----
includes:
  - dynamic-plugins.default.yaml
plugins:
  - package: ./dynamic-plugins/dist/backstage-plugin-catalog-backend-module-github
    disabled: false
  - package: ./dynamic-plugins/dist/backstage-community-plugin-rbac
    disabled: false
----

. Provision your custom configuration files to your {platform} cluster.

.. Create the _<{my-product-namespace}>_ {namespace} aimed at containing your {product-short} instance.
+
[source,terminal,subs="+attributes,+quotes"]
----
$ oc create namespace {my-product-namespace}
----

.. Provision your `{my-app-config-file}` and `dynamic-plugins.yaml` files respectively to the `{my-app-config-config-map}` and `dynamic-plugins-rhdh` config maps in the _<{my-product-namespace}>_ project.
+
[source,terminal,subs="+attributes,+quotes"]
----
$ oc create configmap {my-app-config-config-map} --from-file={my-app-config-file} --namespace={my-product-namespace}
$ oc create configmap dynamic-plugins-rhdh --from-file=dynamic-plugins.yaml --namespace={my-product-namespace}
----
+
Alternatively,
link:https://docs.redhat.com/en/documentation/openshift_container_platform/{ocp-version}/html-single/nodes/index#nnodes-pods-configmap-create-from-console_configmaps[create the config maps by using the web console].

.. Provision your `secrets.txt` file to the `{my-product-secrets}` secret in the _<{my-product-namespace}>_ project.
+
[source,terminal,subs="+attributes,+quotes"]
----
$ oc create secret generic {my-product-secrets} --from-file=secrets.txt --namespace={my-product-namespace}
----
+
Alternatively,
link:https://docs.redhat.com/en/documentation/openshift_container_platform/{ocp-version}/html-single/nodes/index#nodes-pods-secrets-creating-web-console-secrets_nodes-pods-secrets[create the secret by using the web console].

ifeval::["{context}" == "setting-up-and-configuring-your-first-rhdh-instance"]
include::snip-provisioning-your-custom-configuration-next-steps-in-setting-up-and-configuring-your-first-rhdh-instance-context.adoc[]
endif::[]
ifeval::["{context}" != "setting-up-and-configuring-your-first-rhdh-instance"]
include::snip-provisioning-your-custom-configuration-next-steps-in-default-context.adoc[]
endif::[]
