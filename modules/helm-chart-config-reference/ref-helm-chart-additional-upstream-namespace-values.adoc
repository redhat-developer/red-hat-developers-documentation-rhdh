:_mod-docs-content-type: REFERENCE

[id="helm-chart-additional-upstream-namespace-values_{context}"]

= Additional upstream Backstage Chart values

Add the following Backstage Chart values to the upstream namespace
to customize your {product-very-short} configuration further.

[cols="1m, 1, 1, 1m"]
|===
d|*Key* |*Description* |*Type* d|*Default*

|upstream.backstage
|Backstage parameters.
|object
e|see below

|upstream.backstage.affinity
|link:https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity[Affinity] for pod assignment.
|object
|{}

|upstream.backstage.annotations
|Additional custom annotations for the Deployment resource.
|object
|{}

|upstream.backstage.appConfig
|Generates a `ConfigMap` and configures it in the Backstage pods.
|object
|{}

|upstream.backstage.args
|Backstage container command arguments.
|list
|[]

|upstream.backstage.autoscaling
|link:https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/[Autoscaling] configuration.
|object
|{"enabled":false,"maxReplicas":100,"minReplicas":1,"targetCPUUtilizationPercentage":80}

|upstream.backstage.command
|Backstage container command.
|list
|[]

|upstream.backstage.containerPorts
|Deployment container ports.
|object
|{"backend":7007}

|upstream.backstage.containerSecurityContext
|link:https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-container[Container security settings.]
|object
|{}

|upstream.backstage.extraAppConfig
|Extra app configuration files to inline into command arguments.
|list
|[]

|upstream.backstage.extraContainers
|Deployment sidecars.
|list
|[]

|upstream.backstage.extraEnvVars
|Backstage container environment variables.
|list
|[]

|upstream.backstage.extraEnvVarsCM
|Backstage container environment variables from existing `ConfigMaps`.
|list
|[]

|upstream.backstage.extraEnvVarsSecrets
|Backstage container environment variables from existing secrets.
|list
|[]

|upstream.backstage.extraPorts
|Backstage container additional ports.
|list
|[]

|upstream.backstage.extraVolumeMounts
|Backstage container additional volume mounts.
|list
|[]

|upstream.backstage.extraVolumes
|Backstage container additional volumes.
|list
|[]

|upstream.backstage.hostAliases
|link:https://kubernetes.io/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/[Host Aliases] for the pod.
|list
|[]

|upstream.backstage.image.digest
a|Backstage image digest.
Takes precedence over image tag.

[IMPORTANT]
====
The image digest must match the repository used for {product-very-short}.
====
|string
|""

|upstream.backstage.image.pullPolicy
a|Specifies the link:https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy/[image pull policy].
|string
|""

|upstream.backstage.image.pullSecrets
a|Specifies an array of link:https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/[`imagePullSecrets`].

[IMPORTANT]
====
Secrets must be manually created in the namespace.
====
|list
|[]

|upstream.backstage.image.registry
|Backstage image registry.
|string
|"registry.redhat.io"

|upstream.backstage.image.repository
|Backstage image repository.
|string
|"rhdh/rhdh-hub-rhel9@sha256"

|upstream.backstage.image.tag
a|Backstage image tag.

[NOTE]
====
It is recommended to use immutable tags.
====
|string
|"digest"

|upstream.backstage.initContainers
|Backstage container init containers.
|list
|[]

|upstream.backstage.installDir
a|Directory containing the backstage installation.

[IMPORTANT]
====
Before using this value, check that there are no restrictions placed on customizing `installDir`.
====
|string
|"/opt/app-root/src"

|upstream.backstage.livenessProbe
|link:https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes[Liveness probe].
|object
|{"httpGet":{"path":"/.backstage/health/v1/liveness","port":backend,"scheme":"HTTP"}}

|upstream.backstage.nodeSelector
|link:https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector[Node labels] for pod assignment.
|object
|{}

|upstream.backstage.pdb
|link:https://kubernetes.io/docs/tasks/run-application/configure-pdb/[Pod Disruption Budget] configuration.
|object
|{"create":false,"maxUnavailable":"","minAvailable":""}

|upstream.backstage.podAnnotations
|Annotations added to the backend deployment pods.
|object
|{}

|upstream.backstage.podLabels
|Labels added to the backend deployment pods.
|object
|{}

|upstream.backstage.podSecurityContext
a|link:https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod[Security settings] for a pod.
They apply to all containers in the pod.

[IMPORTANT]
====
Before using this value, check the Openshift security policy.
====
|object
|{}

|upstream.backstage.readinessProbe
|link:https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes[Readiness probe].
|object
|{"httpGet":{"path":"/.backstage/health/v1/readiness","port":backend,"scheme":"HTTP"}}

|upstream.backstage.replicas
|Number of deployment replicas.
|int
|1

|upstream.backstage.resources
|link:https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#resource-requests-and-limits-of-pod-and-container[Resource requests and limits].
|object
|{}

|upstream.backstage.revisionHistoryLimit
a|Defines the link:https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#clean-up-policy[count
of deployment revisions] to be kept.

[NOTE]
====
For GitOps deployment, the count might be set to `0`.
====
|int
|10

|upstream.backstage.startupProbe
|link:https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes[Startup probe].
|object
|{"httpGet":{"path":"/.backstage/health/v1/liveness","port":backend,"scheme":"HTTP"}}

|upstream.backstage.tolerations
|Node tolerations for server scheduling to link:https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/[nodes with taints].
|list
|[]

|upstream.backstage.topologySpreadConstraints
|link:https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#pod-topology-spread-constraints[Topology spread constraints] for pod assignment.
|list
|[]

|upstream.clusterDomain
a|Default Kubernetes cluster domain.

[IMPORTANT]
====
Use this value only if the underlying Backstage chart exposes and uses it.
====
|string
|"cluster.local"

|upstream.commonAnnotations
|Annotations to add to all deployed objects.
|object
|{}

|upstream.commonLabels
|Labels to add to all deployed objects.
|object
|{}

|upstream.diagnosticMode
|Enables diagnostic mode in the deployment.
|object
|{"args":["infinity"],"command":["sleep"],"enabled":false}

|upstream.diagnosticMode.args
|Arguments to override all containers in the deployment.
|list
|["infinity"]

|upstream.diagnosticMode.command
|Command to override all containers in the deployment.
|list
|["sleep"]

|upstream.diagnosticMode.enabled
|Enables diagnostic mode.
|bool
|false

|upstream.extraDeploy
|Array of extra objects to deploy with the release.
|list
|[]

|upstream.fullnameOverride
|String to fully override `common.names.fullname`.
|string
|""

|upstream.ingress
|Ingress parameters.
|object
|{"annotations":{},"className":"","enabled":false,"extraHosts":[],"extraTls":[],"host":"","path":"/","tls":{"enabled":false,"secretName":""}}

|upstream.ingress.annotations
|Additional annotations for the Ingress resource.
|object
|{}

|upstream.ingress.className
|Name of the `IngressClass` cluster resource that defines which controller implements the resource, such as `nginx`.
|string
|""

|upstream.ingress.enabled
|Enables the creation of the Ingress resource.
|bool
|false

|upstream.ingress.extraHosts
|List of additional hostnames to be covered with this Ingress record, such as `CNAME`.
|list
|[]

|upstream.ingress.extraTls
|The link:https://kubernetes.io/docs/concepts/services-networking/ingress/#tls[TLS configuration] for additional hostnames to be covered with this Ingress record.
|list
|[]

|upstream.ingress.host
|Hostname to be used to expose the route to access the Backstage application, such as `backstage.IP.nip.io`.
|string
|""

|upstream.ingress.path
|Path to be used to expose the full route to access the Backstage application, such as `backstage.IP.nip.io`.
|string
|"/"

|upstream.ingress.tls
|Ingress TLS parameters.
|object
|{"enabled":false,"secretName":""}

|upstream.ingress.tls.enabled
|Enables TLS configuration for the host defined at `ingress.host` parameter.
|bool
|false

|upstream.ingress.tls.secretName
|The name to which the TLS Secret is called.
|string
|""

|upstream.kubeVersion
|Overrides Kubernetes version.
|string
|""

|upstream.metrics
|Metrics configuration.
|object
|{"serviceMonitor":{"annotations":{},"enabled":false,"interval":null,"labels":{},"path":"/metrics","port":"http-metrics"}}

|upstream.metrics.serviceMonitor
|`ServiceMonitor` configuration for link:https://github.com/prometheus-operator/prometheus-operator[Prometheus Operator].
|object
|{"annotations":{},"enabled":false,"interval":null,"labels":{},"path":"/metrics","port":"http-metrics"}

|upstream.metrics.serviceMonitor.annotations
|`ServiceMonitor` annotations.
|object
|{}

|upstream.metrics.serviceMonitor.enabled
a|Creates a `ServiceMonitor` resource for link:https://github.com/prometheus-operator/prometheus-operator[Prometheus Operator]

[IMPORTANT]
====
You must install Prometheus Operator in your cluster before  you enable this value.
====
|bool
|false

|upstream.metrics.serviceMonitor.interval
|`ServiceMonitor` scrape interval. |string |nil

|upstream.metrics.serviceMonitor.labels
|Additional `ServiceMonitor` labels.
|object
|{}

|upstream.metrics.serviceMonitor.path
a|`ServiceMonitor` endpoint path.

[IMPORTANT]
====
The `/metrics` endpoint is not present in a freshly scaffolded
Backstage application.
Follow link:https://github.com/backstage/backstage/blob/master/contrib/docs/tutorials/prometheus-metrics.md[this tutorial]
to set it up.
====
|string
|"/metrics"

|upstream.metrics.serviceMonitor.port
a|`ServiceMonitor` endpoint port.

[IMPORTANT]
====
If you use link:https://backstage.io/docs/tutorials/setup-opentelemetry/[OpenTelemetry],
the port must be explicitly specified.
The default port for OpenTelemetry is `9464`.
====
|string
|"http-metrics"

|upstream.nameOverride
|String to partially override `common.names.fullname`.
|string
|"developer-hub"

|upstream.networkPolicy.egressRules.customRules
|Additional custom egress rules.
|list
|[]

|upstream.networkPolicy.egressRules.denyConnectionsToExternal
a|Denies external connections.

[IMPORTANT]
====
Do not enable this value when working with external databases.
====
|bool
|false

|upstream.networkPolicy.enabled
|Specifies if a `NetworkPolicy` is created.
|bool
|false

|upstream.networkPolicy.ingressRules.customRules
|Additional custom Ingress rules.
|list
|[]

|upstream.networkPolicy.ingressRules.namespaceSelector
|Namespace selector label allowed to access the Backstage instance.
|object
|{}

|upstream.networkPolicy.ingressRules.podSelector
|Pod selector label allowed to access the Backstage instance.
|object
|{}

|upstream.postgresql
|link:https://github.com/bitnami/charts/blob/master/bitnami/postgresql/values.yaml[PostgreSQL chart configuration].
|object
e|see below

|upstream.postgresql.architecture
|PostgreSQL architecture.
|string
|"standalone"

|upstream.postgresql.auth
|Authentication details of the PostgreSQL database.
|object
|{"existingSecret":"","password":"","secretKeys":{"adminPasswordKey":"postgres-password","replicationPasswordKey":"replication-password","userPasswordKey":"password"},"username":"bn_backstage"}

|upstream.postgresql.auth.existingSecret
|Name of existing secret used for PostgreSQL credentials.
|string
|""

|upstream.postgresql.auth.password
|Password created by custom user.
|string
|""

|upstream.postgresql.auth.secretKeys
|The secret keys PostgreSQL looks for to retrieve the relevant password.
|object
|{"adminPasswordKey":"admin-password","replicationPasswordKey":"replication-password","userPasswordKey":"user-password"}

|upstream.postgresql.auth.secretKeys.adminPasswordKey
|The key in the existing secret where PostgreSQL looks for the admin password.
|string
|"postgres-password"

|upstream.postgresql.auth.secretKeys.replicationPasswordKey
|The key in the existing secret where PostgreSQL looks for the replication password.
|string
|"replication-password"

|upstream.postgresql.auth.secretKeys.userPasswordKey
|The key in the existing secret where PostgreSQL looks for the user password.
|string
|"password"

|upstream.postgresql.auth.username
|Creates a name for a custom user.
|string
|"bn_backstage"

|upstream.postgresql.enabled
a|Enables the PostgreSQL helm chart.

[NOTE]
====
PostgreSQL has many link:https://github.com/bitnami/charts/blob/postgresql/12.10.0/bitnami/postgresql/README.md#parameters[values]
you can use in {product-very-short}.
However,
using your own external database is recommended for production.
====
|bool
|true

|upstream.postgresql.image
|Changes default PostgreSQL image location.
|object
|{"registry":"registry.redhat.io","repository":"rhel9/postgresql-15@sha256"}

|upstream.service
|Service parameters.
|object
e|see below

|upstream.service.annotations
|Additional custom annotations for Backstage service.
|object
|{}

|upstream.service.clusterIP
|Backstage service cluster IP.
|string
|""

|upstream.service.externalTrafficPolicy
|link:https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/#preserving-the-client-source-ip[Backstage service external traffic policy].
|string
|"Cluster"

|upstream.service.extraPorts
|Extra ports to expose in the Backstage service. Typically used with the sidecar value.
|list
|[]

|upstream.service.ipFamilies
|link:https://kubernetes.io/docs/concepts/services-networking/dual-stack[IP families].
|list
|[]

|upstream.service.ipFamilyPolicy
|link:https://kubernetes.io/docs/concepts/services-networking/dual-stack[IP Family Policy].
|string
|""

|upstream.service.loadBalancerIP
|link:https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer[Backstage service Load Balancer IP].
|string
|""

|upstream.service.loadBalancerSourceRanges
|link:https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer[Load Balancer sources].
|list
|[]

|upstream.service.nodePorts
a|Node port for the Backstage client connections.

[NOTE]
====
Choose a port between 30000-32767.
====
|object
|{"backend":""}

|upstream.service.ports
|Backstage SVC port for client connections.
|object
|{"backend":7007,"name":"http-backend","targetPort":"backend"}

|upstream.service.ports.name
|Backstage SVC port name.
|string
|"http-backend"

|upstream.service.ports.targetPort
|Backstage SVC target port referencing receiving pod container port.
|string
|"backend"

|upstream.service.sessionAffinity
|link:https://kubernetes.io/docs/concepts/services-networking/service/#session-stickiness[Controls where client requests go]: either the same pod or round-robin.
|string
|"None"

|upstream.service.type
|Kubernetes service type.
|string
|"ClusterIP"

|upstream.serviceAccount
|Service account configuration.
|object
e|see below

|upstream.serviceAccount.annotations
|Additional custom annotations for the `ServiceAccount`.
|object
|{}

|upstream.serviceAccount.automountServiceAccountToken
|Auto-mounts the service account token in the pod.
|bool
|true

|upstream.serviceAccount.create
|Enable the creation of a `ServiceAccount` for Backstage pods.
|bool
|false

|upstream.serviceAccount.labels
|Additional custom labels for the `ServiceAccount`.
|object
|{}

|upstream.serviceAccount.name
a|Name of the ServiceAccount to use.

[NOTE]
====
If you do not set this value set and `serviceAccount.create` is set to `true`, a name is generated.
|string
|""
|===
