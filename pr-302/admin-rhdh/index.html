<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<title>Administration guide for Red Hat Developer Hub</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body id="title-admin" class="book">
<div id="header">
<h1>Administration guide for Red Hat Developer Hub</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#snip-customer-support-info_admin-rhdh">Red Hat Developer Hub support</a></li>
<li><a href="#proc-install-operator_admin-rhdh">1. Installing the Red Hat Developer Hub Operator</a></li>
<li><a href="#assembly-install-rhdh-ocp">2. Deploying Red Hat Developer Hub on OpenShift Container Platform</a>
<ul class="sectlevel2">
<li><a href="#proc-install-rhdh-ocp-helm_admin-rhdh">2.1. Deploying Red Hat Developer Hub on OpenShift Container Platform using Helm Chart</a></li>
<li><a href="#proc-install-rhdh-ocp-operator_admin-rhdh">2.2. Deploying Red Hat Developer Hub on OpenShift Container Platform using the Operator</a></li>
</ul>
</li>
<li><a href="#assembly-configuring-external-postgresql-databases">3. Configuring external PostgreSQL databases</a>
<ul class="sectlevel2">
<li><a href="#proc-configuring-postgresql-instance-using-operator_admin-rhdh">3.1. Configuring an external PostgreSQL instance using the Operator</a></li>
<li><a href="#proc-configuring-postgresql-instance-using-helm_admin-rhdh">3.2. Configuring an external PostgreSQL instance using the Helm Chart</a></li>
<li><a href="#proc-migrating-databases-to-an-external-server_admin-rhdh">3.3. Migrating local databases to an external database server using the Operator</a></li>
</ul>
</li>
<li><a href="#enabling-authentication">4. Enabling authentication in Red Hat Developer Hub</a>
<ul class="sectlevel2">
<li><a href="#proc-adding-azure-as-an-authentication-provider_admin-rhdh">4.1. Enabling the Microsoft Azure authentication provider</a></li>
<li><a href="#proc-adding-gitlab-oauth-as-an-authentication-provider_admin-rhdh">4.2. Enabling the GitLab OAuth authentication provider</a></li>
</ul>
</li>
<li><a href="#assembly-rhdh-telemetry">5. Telemetry data collection</a>
<ul class="sectlevel2">
<li><a href="#disabling-telemetry-data-collection_admin-rhdh">5.1. Disabling telemetry data collection in RHDH</a></li>
<li><a href="#enabling-telemetry-data-collection_admin-rhdh">5.2. Enabling telemetry data collection in RHDH</a></li>
<li><a href="#customizing-telemetry-segment_admin-rhdh">5.3. Customizing telemetry Segment source</a></li>
</ul>
</li>
<li><a href="#assembly-rhdh-observability">6. Enabling observability for Red Hat Developer Hub on OpenShift Container Platform</a>
<ul class="sectlevel2">
<li><a href="#proc-admin-enabling-metrics-ocp-helm_assembly-rhdh-observability">6.1. Enabling metrics monitoring in a Helm chart installation on an OpenShift Container Platform cluster</a></li>
<li><a href="#proc-admin-enabling-metrics-ocp-operator_assembly-rhdh-observability">6.2. Enabling metrics monitoring in a Red Hat Developer Hub Operator installation on an OpenShift Container Platform cluster</a></li>
<li><a href="#additional-resources_assembly-rhdh-observability">6.3. Additional resources</a></li>
</ul>
</li>
<li><a href="#assembly-running-rhdh-behind-a-proxy">7. Running the RHDH application behind a corporate proxy</a>
<ul class="sectlevel2">
<li><a href="#proc-configuring-proxy-in-helm-deployment_assembly-rhdh-observability">7.1. Configuring proxy information in Helm deployment</a></li>
<li><a href="#proc-configuring-proxy-in-operator-deployment_assembly-rhdh-observability">7.2. Configuring proxy information in Operator deployment</a></li>
</ul>
</li>
<li><a href="#assembly-rhdh-integration-aws_assembly-rhdh-observability">8. Red Hat Developer Hub integration with Amazon Web Services (AWS)</a>
<ul class="sectlevel2">
<li><a href="#proc-rhdh-deploy-eks-using-helm_assembly-rhdh-observability">8.1. Deploying Red Hat Developer Hub in Elastic Kubernetes Service (EKS) using Helm Chart</a></li>
<li><a href="#proc-rhdh-deploy-eks-using-operator_assembly-rhdh-observability">8.2. Deploying Red Hat Developer Hub on Elastic Kubernetes Service (EKS) using the Operator</a></li>
<li><a href="#proc-rhdh-monitoring-logging-aws_assembly-rhdh-observability">8.3. Monitoring and logging with Amazon Web Services (AWS) in Red Hat Developer Hub</a></li>
<li><a href="#proc-using-aws-cognito-auth-provider_assembly-rhdh-observability">8.4. Using Amazon Cognito as an authentication provider in Red Hat Developer Hub</a></li>
</ul>
</li>
<li><a href="#assembly-rhdh-integration-aks_assembly-rhdh-observability">9. Red Hat Developer Hub integration with Microsoft Azure Kubernetes Service (AKS)</a>
<ul class="sectlevel2">
<li><a href="#proc-rhdh-deploy-aks_assembly-rhdh-observability">9.1. Deploying Red Hat Developer Hub on Azure Kubernetes Service (AKS)</a></li>
<li><a href="#proc-rhdh-monitoring-logging-aks_assembly-rhdh-observability">9.2. Monitoring and logging with Azure Kubernetes Services (AKS) in Red Hat Developer Hub</a></li>
<li><a href="#proc-using-azure-auth-provider_assembly-rhdh-observability">9.3. Using Microsoft Azure as an authentication provider in Red Hat Developer Hub</a></li>
</ul>
</li>
<li><a href="#con-rbac-overview_assembly-rhdh-observability">10. Role-Based Access Control (RBAC) in Red Hat Developer Hub</a>
<ul class="sectlevel2">
<li><a href="#ref-rbac-permission-policies_assembly-rhdh-observability">10.1. Permission policies in Red Hat Developer Hub</a></li>
<li><a href="#con-rbac-conditional-policies-rhdh_assembly-rhdh-observability">10.2. Conditional policies in Red Hat Developer Hub</a></li>
<li><a href="#proc-rbac-ui-manage-roles_assembly-rhdh-observability">10.3. Managing role-based access controls (RBAC) using the Red Hat Developer Hub Web UI</a></li>
<li><a href="#con-rbac-rest-api_assembly-rhdh-observability">10.4. Role-based Access Control (RBAC) REST API</a></li>
</ul>
</li>
<li><a href="#assembly-admin-templates">11. Managing templates</a>
<ul class="sectlevel2">
<li><a href="#proc-creating-templates_assembly-admin-templates">11.1. Creating a template by using the Template Editor</a></li>
<li><a href="#ref-creating-templates_assembly-admin-templates">11.2. Creating a template as a YAML file</a></li>
<li><a href="#proc-adding-templates_assembly-admin-templates">11.3. Importing an existing template to Red Hat Developer Hub</a></li>
</ul>
</li>
<li><a href="#assembly-techdocs-plugin_assembly-admin-templates">12. Configuring the TechDocs plugin in Red Hat Developer Hub</a>
<ul class="sectlevel2">
<li><a href="#con-techdocs-configure-storage_assembly-admin-templates">12.1. Configuring storage for TechDocs files</a></li>
<li><a href="#con-techdocs-config-cicd_assembly-admin-templates">12.2. Configuring CI/CD to generate and publish TecDocs sites</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Red Hat Developer Hub is an enterprise-grade, open developer platform that you can use to build developer portals. This platform contains a supported and opinionated framework that helps reduce the friction and frustration of developers while boosting their productivity.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="snip-customer-support-info_admin-rhdh">Red Hat Developer Hub support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you experience difficulty with a procedure described in this documentation, visit the <a href="http://access.redhat.com">Red Hat Customer Portal</a>. You can use the Red Hat Customer Portal for the following purposes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To search or browse through the Red Hat Knowledgebase of technical support articles about Red Hat products.</p>
</li>
<li>
<p>To create a <a href="https://access.redhat.com/support/cases/#/case/new/get-support?caseCreate=true">support case</a> for Red Hat Global Support Services (GSS). For support case creation, select <strong>Red Hat Developer Hub</strong> as the product and select the appropriate product version.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="proc-install-operator_admin-rhdh">1. Installing the Red Hat Developer Hub Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As an administrator, you can install the Red Hat Developer Hub Operator. Authorized users can use the Operator to install Red Hat Developer Hub on the following platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red Hat OpenShift Container Platform (RHOCP)</p>
</li>
<li>
<p>Amazon Elastic Kubernetes Service (EKS)</p>
</li>
<li>
<p>Microsoft Azure Kubernetes Service (AKS)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>RHOCP is currently supported from version 4.12 to 4.15. See also the <a href="https://access.redhat.com/support/policy/updates/developerhub">Red Hat Developer Hub Life Cycle</a>.</p>
</div>
<div class="paragraph">
<p>Containers are available for the following CPU architectures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AMD64 and Intel 64 (x86_64)</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You are logged in as an administrator on the OpenShift Container Platform web console.</p>
</li>
<li>
<p>You have configured the appropriate roles and permissions within your project to create an application. For more information, see the <a href="https://docs.openshift.com/container-platform/4.15/applications/index.html">Red Hat OpenShift documentation on Building applications</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For enhanced security, deploy the Red Hat Developer Hub Operator in a dedicated default namespace such as <code>rhdh-operator</code>. The cluster administrator can restrict other users' access to the Operator resources through role bindings or cluster role bindings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the OpenShift Container Platform web console, navigate to <strong>Operators &gt; OperatorHub</strong>.</p>
</li>
<li>
<p>In the <strong>Filter by keyword</strong> box, enter Developer Hub and click the <strong>Red Hat Developer Hub</strong> Operator card.</p>
</li>
<li>
<p>On the <strong>Red Hat Developer Hub Operator</strong> page, click <strong>Install</strong>.</p>
</li>
<li>
<p>On the <strong>Install Operator</strong> page, use the <strong>Update channel</strong> drop-down menu to select the update channel that you want to use:</p>
<div class="ulist">
<ul>
<li>
<p>The <strong>fast</strong> channel provides y-stream (x.y) and z-stream (x.y.z) updates, for example, updating from version 1.1 to 1.2, or from 1.1.0 to 1.1.1.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>fast</code> channel includes all of the updates available for a particular version. Any update might introduce unexpected changes in your Red Hat Developer Hub deployment. Check the release notes for details about any potentially breaking changes.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <strong>fast-1.1</strong> channel only provides z-stream updates, for example, updating from version 1.1.1 to 1.1.2. If you want to update the Red Hat Developer Hub y-version in the future, for example, updating from 1.1 to 1.2, you must switch to the <strong>fast</strong> channel manually.</p>
</li>
</ul>
</div>
</li>
<li>
<p>On the <strong>Install Operator</strong> page, choose the <strong>Update approval</strong> strategy for the Operator:</p>
<div class="ulist">
<ul>
<li>
<p>If you choose the <strong>Automatic</strong> option, the Operator is updated without requiring manual confirmation.</p>
</li>
<li>
<p>If you choose the <strong>Manual</strong> option, a notification opens when a new update is released in the update channel. The update must be manually approved by an administrator before installation can begin.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Install</strong>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>To view the installed Red Hat Developer Hub Operator, click <strong>View Operator</strong>.</p>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#proc-install-rhdh-ocp-operator_admin-rhdh">Deploying Red Hat Developer Hub on OpenShift Container Platform using the Operator</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.15/operators/admin/olm-adding-operators-to-cluster.html#olm-installing-from-operatorhub-using-web-console_olm-adding-operators-to-a-cluster">Installing from OperatorHub using the web console</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-install-rhdh-ocp">2. Deploying Red Hat Developer Hub on OpenShift Container Platform</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can install Red Hat Developer Hub on OpenShift Container Platform using one of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Helm chart</p>
</li>
<li>
<p>The Red Hat Developer Hub Operator</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="proc-install-rhdh-ocp-helm_admin-rhdh">2.1. Deploying Red Hat Developer Hub on OpenShift Container Platform using Helm Chart</h3>
<div class="paragraph">
<p>You can use a Helm chart in Red Hat OpenShift Container Platform to install Developer Hub,  which is a flexible installation method.</p>
</div>
<div class="paragraph">
<p>Helm is a package manager on OpenShift Container Platform that provides the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Applies regular application updates using custom hooks</p>
</li>
<li>
<p>Manages the installation of complex applications</p>
</li>
<li>
<p>Provides charts that you can host on public and private servers</p>
</li>
<li>
<p>Supports rolling back to previous application versions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Red Hat Developer Hub Helm chart is available in the Helm catalog on OpenShift Dedicated and OpenShift Container Platform.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You are logged in to your OpenShift Container Platform account.</p>
</li>
<li>
<p>A user with the OpenShift Container Platform <code>admin</code> role has configured the appropriate roles and permissions within your project to create an application. For more information about OpenShift Container Platform roles, see <a href="https://docs.openshift.com/container-platform/4.15/authentication/using-rbac.html">Using RBAC to define and apply permissions</a>.</p>
</li>
<li>
<p>You have created a project in OpenShift Container Platform. For more information about creating a project in OpenShift Container Platform, see <a href="https://docs.openshift.com/container-platform/4.15/applications/projects/working-with-projects.html#odc-creating-projects-using-developer-perspective_projects">Red Hat OpenShift Container Platform documentation</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the <strong>Developer</strong> perspective on the Developer Hub web console, click <strong>+Add</strong>.</p>
</li>
<li>
<p>From the <strong>Developer Catalog</strong> panel, click <strong>Helm Chart</strong>.</p>
</li>
<li>
<p>In the <strong>Filter by keyword</strong> box, enter <em>Developer Hub</em> and click the <strong>Red Hat Developer Hub</strong> card.</p>
</li>
<li>
<p>From the Red Hat Developer Hub page, click <strong>Create</strong>.</p>
</li>
<li>
<p>From your cluster, copy the OpenShift Container Platform router host (for example: <code>apps.&lt;clusterName&gt;.com</code>).</p>
</li>
<li>
<p>Select the radio button to configure the Developer Hub instance with either the form view or YAML view. The Form view is selected by default.</p>
<div class="ulist">
<ul>
<li>
<p>Using <strong>Form view</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To configure the instance with the Form view, go to <strong>Root Schema</strong> &#8594; <strong>global</strong> &#8594; <strong>Enable service authentication within Backstage instance</strong> and paste your OpenShift Container Platform router host into the field on the form.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Using <strong>YAML view</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To configure the instance with the YAML view, paste your OpenShift Container Platform router hostname in the <code>global.clusterRouterBase</code> parameter value as shown in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">global:
  auth:
    backend:
      enabled: true
  clusterRouterBase: apps.&lt;clusterName&gt;.com
  # other Red Hat Developer Hub Helm Chart configurations</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Edit the other values if needed.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The information about the host is copied and can be accessed by the Developer Hub backend.</p>
</div>
<div class="paragraph">
<p>When an OpenShift Container Platform route is generated automatically, the host value for the route is inferred and the same host information is sent to the Developer Hub. Also, if the Developer Hub is present on a custom domain by setting the host manually using values, the custom host takes precedence.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Create</strong> and wait for the database and Developer Hub to start.</p>
</li>
<li>
<p>Click the <strong>Open URL</strong> icon to start using the Developer Hub platform.</p>
<div class="imageblock">
<div class="content">
<img src="images/rhdh/rhdh-helm-install.png" alt="rhdh helm install">
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Your <code>developer-hub</code> pod might be in a <code>CrashLoopBackOff</code> state if the Developer Hub container cannot access the configuration files. This error is indicated by the following log:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-log" data-lang="log">Loaded config from app-config-from-configmap.yaml, env
...
2023-07-24T19:44:46.223Z auth info Configuring "database" as KeyStore provider type=plugin
Backend failed to start up Error: Missing required config value at 'backend.database.client'</code></pre>
</div>
</div>
<div class="paragraph">
<p>To resolve the error, verify the configuration files.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="proc-add-custom-app-file-openshift-helm_admin-rhdh">2.1.1. Adding a custom application configuration file to OpenShift Container Platform using the Helm chart</h4>
<div class="paragraph">
<p>You can use the Red Hat Developer Hub Helm chart to add a custom application configuration file to your OpenShift Container Platform instance.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have created an Red Hat OpenShift Container Platform account.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the OpenShift Container Platform web console, select the <strong>ConfigMaps</strong> tab.</p>
</li>
<li>
<p>Click <strong>Create ConfigMap</strong>.</p>
</li>
<li>
<p>From <strong>Create ConfigMap</strong> page, select the <strong>YAML view</strong> option in <strong>Configure via</strong> and make changes to the file, if needed.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
<li>
<p>Go to the <strong>Helm</strong> tab to see the list of Helm releases.</p>
</li>
<li>
<p>Click the overflow menu on the Helm release that you want to use and select <strong>Upgrade</strong>.</p>
</li>
<li>
<p>Use either the <strong>Form view</strong> or <strong>YAML view</strong> to edit the Helm configuration.</p>
<div class="ulist">
<ul>
<li>
<p>Using <strong>Form view</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Expand <strong>Root Schema  Backstage chart schema  Backstage parameters  Extra app configuration files to inline into command arguments</strong>.</p>
</li>
<li>
<p>Click the <strong>Add Extra app configuration files to inline into command arguments</strong> link.</p>
</li>
<li>
<p>Enter the value in the following fields:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>configMapRef</strong>: <code>app-config-rhdh</code></p>
</li>
<li>
<p><strong>filename</strong>: <code>app-config-rhdh.yaml</code></p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Click <strong>Upgrade</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Using <strong>YAML view</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Set the value of the <code>upstream.backstage.extraAppConfig.configMapRef</code> and <code>upstream.backstage.extraAppConfig.filename</code> parameters as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ... other Red Hat Developer Hub Helm Chart configurations
upstream:
  backstage:
    extraAppConfig:
      - configMapRef: app-config-rhdh
        filename: app-config-rhdh.yaml
# ... other Red Hat Developer Hub Helm Chart configurations</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Upgrade</strong>.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-install-rhdh-airgapped-environment-ocp-helm_admin-rhdh">2.1.2. Installing Red Hat Developer Hub using the Helm Chart in an air-gapped environment</h4>
<div class="paragraph">
<p>An air-gapped environment, also known as an air-gapped network or isolated network, ensures security by physically segregating the system or network. This isolation is established to prevent unauthorized access, data transfer, or communication between the air-gapped system and external sources.</p>
</div>
<div class="paragraph">
<p>You can install Red Hat Developer Hub in an air-gapped environment to ensure security and meet specific regulatory requirements.</p>
</div>
<div class="paragraph">
<p>To install Developer Hub in an air-gapped environment, you must have access to the <code>registry.redhat.io</code> and the registry for the air-gapped environment.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed an Red Hat OpenShift Container Platform 4.12 or later.</p>
</li>
<li>
<p>You have access to the <code>registry.redhat.io</code>.</p>
</li>
<li>
<p>You have access to the Red Hat OpenShift Container Platform image registry of your cluster. For more information about exposing the image registry, see the Red Hat OpenShift Container Platform documentation about <a href="https://docs.openshift.com/container-platform/4.15/registry/securing-exposing-registry.html">Exposing the registry</a>.</p>
</li>
<li>
<p>You have installed the <code>oc</code> command line tool on your workstation.</p>
</li>
<li>
<p>You have installed the <code>podman</code> command line tools on your workstation.</p>
</li>
<li>
<p>You you have an account in <a href="https://developers.redhat.com/">Red Hat Developer</a> portal.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to your OpenShift Container Platform account using the <code>oc</code> command line tool, by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc login -u &lt;user&gt; -p &lt;password&gt; https://api.&lt;hostname&gt;:6443</code></pre>
</div>
</div>
</li>
<li>
<p>Log in to the OpenShift Container Platform image registry using the <code>podman</code> command line tool, by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">podman login -u kubeadmin -p $(oc whoami -t) default-route-openshift-image-registry.&lt;hostname&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can run the following commands to get the full host name of the OpenShift Container Platform image registry, and then use the host name in a command to log in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">REGISTRY_HOST=$(oc get route default-route -n openshift-image-registry --template='{{ .spec.host }}')</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">podman login -u kubeadmin -p $(oc whoami -t) $REGISTRY_HOST</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Log in to the <code>registry.redhat.io</code> in <code>podman</code> by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">podman login registry.redhat.io</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry authentication, see <a href="https://access.redhat.com/RegistryAuthentication">Red Hat Container Registry Authentication</a>.</p>
</div>
</li>
<li>
<p>Pull Developer Hub and PostgreSQL images from <a href="https://catalog.redhat.com/software/containers/search">Red Hat Image registry</a> to your workstation, by running the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">podman pull registry.redhat.io/rhdh/rhdh-hub-rhel9:{product-chart-version}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">podman pull registry.redhat.io/rhel9/postgresql-15:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Push both images to the internal OpenShift Container Platform image registry by running the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">podman push --remove-signatures registry.redhat.io/rhdh/rhdh-hub-rhel9:{product-chart-version} default-route-openshift-image-registry.&lt;hostname&gt;/&lt;project_name&gt;/rhdh-hub-rhel9:{product-chart-version}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">podman push --remove-signatures registry.redhat.io/rhel9/postgresql-15:latest default-route-openshift-image-registry.&lt;hostname&gt;/&lt;project_name&gt;/postgresql-15:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information about pushing images directly to the OpenShift Container Platform image registry, see <a href="https://access.redhat.com/solutions/6959306">How do I push an Image directly into the OpenShift 4 registry</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If an x509 error occurs, verify that you have <a href="https://access.redhat.com/solutions/6088891">installed the CA certificate used for OpenShift Container Platform routes on your system</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use the following command to verify that both images are present in the internal OpenShift Container Platform registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc get imagestream -n &lt;project_name&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Enable local image lookup for both images by running the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc set image-lookup postgresql-15</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc set image-lookup  rhdh-hub-rhel9</code></pre>
</div>
</div>
</li>
<li>
<p>Go to <strong>YAML view</strong> and update the <code>image</code> section for <code>backstage</code> and <code>postgresql</code> using the following values:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example values for Developer Hub image</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">upstream:
  backstage:
    image:
      registry: ""
      repository: rhdh-hub-rhel9
      tag: latest</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example values for PostgreSQL image</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">upstream:
  postgresql:
    image:
      registry: ""
      repository: postgresql-15
      tag: latest</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Install the Red Hat Developer Hub using Helm chart. For more information about installing Developer Hub, see <a href="#proc-install-rhdh-ocp-helm_admin-rhdh">Deploying Red Hat Developer Hub on OpenShift Container Platform using Helm Chart</a>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-install-rhdh-ocp-operator_admin-rhdh">2.2. Deploying Red Hat Developer Hub on OpenShift Container Platform using the Operator</h3>
<div class="paragraph">
<p>As a developer, you can deploy a Red Hat Developer Hub instance on OpenShift Container Platform by using the <strong>Developer Catalog</strong> in the Red Hat OpenShift Container Platform web console. This deployment method uses the Red Hat Developer Hub Operator.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A cluster administrator has installed the Red Hat Developer Hub Operator. For more information, see <a href="#proc-install-operator_admin-rhdh">Installing the Red Hat Developer Hub Operator</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a project in OpenShift Container Platform for your Red Hat Developer Hub instance, or select an existing project.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>For more information about creating a project in OpenShift Container Platform, see <a href="https://docs.openshift.com/container-platform/4.15/applications/projects/working-with-projects.html#creating-a-project-using-the-web-console_projects">Creating a project by using the web console</a> in the Red Hat OpenShift Container Platform documentation.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>From the <strong>Developer</strong> perspective on the OpenShift Container Platform web console, click <strong>+Add</strong>.</p>
</li>
<li>
<p>From the <strong>Developer Catalog</strong> panel, click <strong>Operator Backed</strong>.</p>
</li>
<li>
<p>In the <strong>Filter by keyword</strong> box, enter <em>Developer Hub</em> and click the <strong>Red Hat Developer Hub</strong> card.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
<li>
<p>Add <a href="#proc-add-custom-app-config-file-ocp-operator_admin-rhdh">custom configurations</a> for the Red Hat Developer Hub instance.</p>
</li>
<li>
<p>On the <strong>Create Backstage</strong> page, click <strong>Create</strong></p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>After the pods are ready, you can access the Red Hat Developer Hub platform by opening the URL.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Confirm that the pods are ready by clicking the pod in the <strong>Topology</strong> view and confirming the <strong>Status</strong> in the <strong>Details</strong> panel. The pod status is <strong>Active</strong> when the pod is ready.</p>
</li>
<li>
<p>From the <strong>Topology</strong> view, click the <strong>Open URL</strong> icon on the Developer Hub pod.</p>
<div class="imageblock">
<div class="content">
<img src="images/rhdh/operator-install-1.png" alt="operator install 1">
</div>
</div>
</li>
</ol>
</div>
<div id="additional-resources_proc-install-rhdh-ocp-operator" class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/4.15/applications/index.html">OpenShift Container Platform - Building applications overview</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="proc-add-custom-app-config-file-ocp-operator_admin-rhdh">2.2.1. Adding a custom application configuration file to OpenShift Container Platform using the Operator</h4>
<div class="paragraph">
<p>A custom application configuration file is a <code>ConfigMap</code> object that you can use to change the configuration of your Red Hat Developer Hub instance. If you are deploying your Developer Hub instance on Red Hat OpenShift Container Platform, you can use the Red Hat Developer Hub Operator to add a custom application configuration file to your OpenShift Container Platform instance by creating the <code>ConfigMap</code> object and referencing it in the Developer Hub custom resource (CR).</p>
</div>
<div class="paragraph">
<p>The custom application configuration file contains a sensitive environment variable, named <code>BACKEND_SECRET</code>. This variable contains a mandatory backend authentication key that Developer Hub uses to reference an environment variable defined in an OpenShift Container Platform secret. You must create a secret, named 'secrets-rhdh', and reference it in the Developer Hub CR.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You are responsible for protecting your Red Hat Developer Hub installation from external and unauthorized access. Manage the backend authentication key like any other secret. Meet strong password requirements, do not expose it in any configuration files, and only inject it into configuration files as an environment variable.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have an active Red Hat OpenShift Container Platform account.</p>
</li>
<li>
<p>Your administrator has installed the Red Hat Developer Hub Operator in OpenShift Container Platform. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.2/html-single/administration_guide_for_red_hat_developer_hub/index">Installing the Red Hat Developer Hub Operator</a>.</p>
</li>
<li>
<p>You have created the Red Hat Developer Hub CR in OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the <strong>Developer</strong> perspective in the OpenShift Container Platform web console, select the <strong>ConfigMaps</strong> view.</p>
</li>
<li>
<p>Click <strong>Create ConfigMap</strong>.</p>
</li>
<li>
<p>Select the <strong>YAML view</strong> option in <strong>Configure via</strong> and use the following example as a base template to create a <code>ConfigMap</code> object, such as <code>app-config-rhdh.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: app-config-rhdh
data:
  "app-config-rhdh.yaml": |
    app:
      title: Red Hat Developer Hub
      baseUrl: https://backstage-&lt;custom_resource_name&gt;-&lt;namespace_name&gt;.&lt;openshift_ingress_domain&gt;
    backend:
      auth:
        keys:
          - secret: "${BACKEND_SECRET}"
      baseUrl: https://backstage-&lt;custom_resource_name&gt;-&lt;namespace_name&gt;.&lt;openshift_ingress_domain&gt;
      cors:
        origin: https://backstage-&lt;custom_resource_name&gt;-&lt;namespace_name&gt;.&lt;openshift_ingress_domain&gt;</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use the mandatory backend authentication key for Red Hat Developer Hub to reference an environment variable defined in an OpenShift Container Platform secret.</p>
</li>
<li>
<p>Set the external URL of your Red Hat Developer Hub instance in the <code>app.baseUrl</code>, <code>backend.baseUrl</code> and <code>backend.cors.origin</code> fields of the application configuration. By default, the URL is similar to the following example:
<code>https://backstage-&lt;custom_resource_name&gt;-&lt;namespace_name&gt;.&lt;openshift_ingress_domain&gt;;</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the <code>oc get ingresses.config/cluster -o jsonpath='{.spec.domain}'</code> command to display your ingress domain. If you want to use a different host or sub-domain, customize the CR <code>spec.application.route</code> field and adjust the application configuration accordingly.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
<li>
<p>Select the <strong>Secrets</strong> view.</p>
</li>
<li>
<p>Click <strong>Create Key/value Secret</strong>.</p>
</li>
<li>
<p>Create a secret named <code>secrets-rhdh</code>.</p>
</li>
<li>
<p>Add a key named <code>BACKEND_SECRET</code> and a base64 encoded string as a value. Use a unique value for each Red Hat Developer Hub instance. For example, you can use the following command to generate a key from your terminal:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">node -p 'require("crypto").randomBytes(24).toString("base64")'</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
<li>
<p>Select the <strong>Topology</strong> view.</p>
</li>
<li>
<p>Click the overflow menu for the Red Hat Developer Hub instance that you want to use and select <strong>Edit Backstage</strong> to load the YAML view of the Red Hat Developer Hub instance.</p>
<div class="imageblock">
<div class="content">
<img src="images/rhdh/operator-install-2.png" alt="operator install 2">
</div>
</div>
</li>
<li>
<p>In the CR, enter the name of the custom application configuration config map as the value for the <code>spec.application.appConfig.configMaps</code> field, and enter the name of your secret as the value for the <code>spec.application.extraEnvs.secrets</code> field. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: example
spec:
  application:
    appConfig:
      mountPath: /opt/app-root/src
      configMaps:
         - name: app-config-rhdh
    extraEnvs:
      secrets:
         - name: secrets-rhdh
    extraFiles:
      mountPath: /opt/app-root/src
    replicas: 1
    route:
      enabled: true
  database:
    enableLocalDb: true</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Navigate back to the <strong>Topology</strong> view and wait for the Red Hat Developer Hub pod to start.</p>
</li>
<li>
<p>Click the <strong>Open URL</strong> icon to use the Red Hat Developer Hub platform with the configuration changes.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about roles and responsibilities in Developer Hub, see <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.2/html-single/administration_guide_for_red_hat_developer_hub/index">Role-Based Access Control (RBAC) in Red Hat Developer Hub</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-config-dynamic-plugins-rhdh-operator_admin-rhdh">2.2.2. Configuring dynamic plugins with the Red Hat Developer Hub Operator</h4>
<div class="paragraph">
<p>You can store the configuration for dynamic plugins in a <code>ConfigMap</code> object that your <code>Backstage</code> custom resource (CR) can reference.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the <code>pluginConfig</code> field references environment variables, you must define the variables in your <code>secrets-rhdh</code> secret.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the OpenShift Container Platform web console, select the <strong>ConfigMaps</strong> tab.</p>
</li>
<li>
<p>Click <strong>Create ConfigMap</strong>.</p>
</li>
<li>
<p>From the <strong>Create ConfigMap</strong> page, select the <strong>YAML view</strong> option in <strong>Configure via</strong> and edit the file, if needed.</p>
<div class="listingblock">
<div class="title">Example <code>ConfigMap</code> object using the GitHub dynamic plugin</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: dynamic-plugins-rhdh
data:
  dynamic-plugins.yaml: |
    includes:
      - dynamic-plugins.default.yaml
    plugins:
      - package: './dynamic-plugins/dist/backstage-plugin-catalog-backend-module-github-dynamic'
        disabled: false
        pluginConfig: {}</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
<li>
<p>Go to the <strong>Topology</strong> view.</p>
</li>
<li>
<p>Click on the overflow menu for the Red Hat Developer Hub instance that you want to use and select <strong>Edit Backstage</strong> to load the YAML view of the Red Hat Developer Hub instance.</p>
<div class="imageblock">
<div class="content">
<img src="images/rhdh/operator-install-2.png" alt="operator install 2">
</div>
</div>
</li>
<li>
<p>Add the <code>dynamicPluginsConfigMapName</code> field to your <code>Backstage</code> CR. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: rhdh.redhat.com/v1alpha1
kind: Backstage
metadata:
  name: my-rhdh
spec:
  application:
# ...
    dynamicPluginsConfigMapName: dynamic-plugins-rhdh
# ...</code></pre>
</div>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Navigate back to the <strong>Topology</strong> view and wait for the Red Hat Developer Hub pod to start.</p>
</li>
<li>
<p>Click the <strong>Open URL</strong> icon to start using the Red Hat Developer Hub platform with the new configuration changes.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Ensure that the dynamic plugins configuration has been loaded, by appending <code>/api/dynamic-plugins-info/loaded-plugins</code> to your Red Hat Developer Hub root URL and checking the list of plugins:</p>
<div class="listingblock">
<div class="title">Example list of plugins</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "name": "backstage-plugin-catalog-backend-module-github-dynamic",
    "version": "0.5.2",
    "platform": "node",
    "role": "backend-plugin-module"
  },
  {
    "name": "backstage-plugin-techdocs",
    "version": "1.10.0",
    "role": "frontend-plugin",
    "platform": "web"
  },
  {
    "name": "backstage-plugin-techdocs-backend-dynamic",
    "version": "1.9.5",
    "platform": "node",
    "role": "backend-plugin"
  },
]</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-install-rhdh-airgapped-environment-ocp-operator_admin-rhdh">2.2.3. Installing Red Hat Developer Hub using the Operator in an air-gapped environment</h4>
<div class="paragraph">
<p>On an OpenShift Container Platform cluster operating on a restricted network, public resources are not available. However, deploying the Red Hat Developer Hub Operator and running Developer Hub requires the following public resources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operator images (bundle, operator, catalog)</p>
</li>
<li>
<p>Operands images (RHDH, PostgreSQL)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To make these resources available, replace them with their equivalent resources in a mirror registry accessible to the OpenShift Container Platform cluster.</p>
</div>
<div class="paragraph">
<p>You can use a helper script that mirrors the necessary images and provides the necessary configuration to ensure those images will be used when installing the Red Hat Developer Hub Operator and creating Developer Hub instances.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This script requires a target mirror registry which you should already have installed if your OpenShift Container Platform cluster is ready to operate on a restricted network. However, if you are preparing your cluster for disconnected usage, you can use the script to deploy a mirror registry in the cluster and use it for the mirroring process.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have an active <code>oc</code> session with administrative permissions to the OpenShift Container Platform cluster. See <a href="https://docs.openshift.com/container-platform/4.15/cli_reference/openshift_cli/getting-started-cli.html">Getting started with the OpenShift CLI</a>.</p>
</li>
<li>
<p>You have an active <code>oc registry</code> session to the <code>registry.redhat.io</code> Red Hat Ecosystem Catalog. See <a href="https://access.redhat.com/RegistryAuthentication">Red Hat Container Registry Authentication</a>.</p>
</li>
<li>
<p>The <code>opm</code> CLI tool is installed. See <a href="https://docs.openshift.com/container-platform/4.15/cli_reference/opm/cli-opm-install.html">Installing the opm CLI</a>.</p>
</li>
<li>
<p>The jq package is installed. See <a href="https://jqlang.github.io/jq/download/">Download jq</a>.</p>
</li>
<li>
<p>Podman is installed. See <a href="https://podman.io/docs/installation">Podman Installation Instructions</a>.</p>
</li>
<li>
<p>Skopeo version 1.14 or higher is installed. <a href="https://github.com/containers/skopeo/blob/main/install.md">See Installing Skopeo</a>.</p>
</li>
<li>
<p>If you already have a mirror registry for your cluster, an active Skopeo session with administrative access to this registry is required. See <a href="https://github.com/containers/skopeo#authenticating-to-a-registry">Authenticating to a registry</a> and <a href="https://docs.openshift.com/container-platform/4.15/installing/disconnected_install/installing-mirroring-installation-images.html">Mirroring images for a disconnected installation</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The internal OpenShift Container Platform cluster image registry cannot be used as a target mirror registry. See <a href="https://docs.openshift.com/container-platform/4.15/installing/disconnected_install/installing-mirroring-installation-images.html#installation-about-mirror-registry_installing-mirroring-installation-images">About the mirror registry</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>If you prefer to create your own mirror registry, see <a href="https://docs.openshift.com/container-platform/4.15/installing/disconnected_install/installing-mirroring-creating-registry.html">Creating a mirror registry with mirror registry for Red Hat OpenShift</a>.</p>
</li>
<li>
<p>If you do not already have a mirror registry, you can use the helper script to create one for you and you need the following additional prerequisites:</p>
<div class="ulist">
<ul>
<li>
<p>The cURL package is installed. For Red Hat Enterprise Linux, the curl command is available by installing the curl package. To use curl for other platforms, see the <a href="https://curl.se/">cURL website</a>.</p>
</li>
<li>
<p>The <code>htpasswd</code> command is available. For Red Hat Enterprise Linux, the <code>htpasswd</code> command is available by installing the <code>httpd-tools</code> package.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download and run the mirroring script to install a custom Operator catalog and mirror the related images: <code>prepare-restricted-environment.sh</code> (<a href="https://github.com/janus-idp/operator/blob/1.1.x/.rhdh/scripts/prepare-restricted-environment.sh">source</a>).</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">curl -sSLO https://raw.githubusercontent.com/janus-idp/operator/1.1.x/.rhdh/scripts/prepare-restricted-environment.sh

# if you do not already have a target mirror registry
# and want the script to create one for you
# use the following example:
bash prepare-restricted-environment.sh \
   --prod_operator_index "registry.redhat.io/redhat/redhat-operator-index:v4.14" \
   --prod_operator_package_name "rhdh" \
   --prod_operator_bundle_name "rhdh-operator" \
   --prod_operator_version "v1.1.1"

# if you already have a target mirror registry
# use the following example:
bash prepare-restricted-environment.sh \
   --prod_operator_index "registry.redhat.io/redhat/redhat-operator-index:v4.14" \
   --prod_operator_package_name "rhdh" \
   --prod_operator_bundle_name "rhdh-operator" \
   --prod_operator_version "v1.1.1" \
   --use_existing_mirror_registry "my_registry"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The script can take several minutes to complete as it copies multiple images to the mirror registry.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-configuring-external-postgresql-databases">3. Configuring external PostgreSQL databases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As an administrator, you can configure and use external PostgreSQL databases in Red Hat Developer Hub. You can use a PostgreSQL certificate file to configure an external PostgreSQL instance using the Operator or Helm Chart.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Developer Hub supports only configuring external PostgreSQL databases. You can perform maintenance activities, such as backing up your data or configuring high availability (HA) for the external PostgreSQL databases.</p>
</div>
<div class="paragraph">
<p>Also, configuring an external PostgreSQL instance by using the Red Hat Developer Hub Operator or Helm Chart is not intended for production use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="proc-configuring-postgresql-instance-using-operator_admin-rhdh">3.1. Configuring an external PostgreSQL instance using the Operator</h3>
<div class="paragraph">
<p>You can configure an external PostgreSQL instance using the Red Hat Developer Hub Operator. By default, the Operator creates and manages a local instance of PostgreSQL in the same namespace where you have deployed the RHDH instance. However, you can change this default setting to configure an external PostgreSQL database server, for example, Amazon Web Services (AWS) Relational Database Service (RDS) or Azure database.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You are using a supported version of PostgreSQL. For more information, see the <a href="https://access.redhat.com/support/policy/updates/developerhub">Product life cycle page</a>.</p>
</li>
<li>
<p>You have the following details:</p>
<div class="ulist">
<ul>
<li>
<p><code>db-host</code>: Denotes your PostgreSQL instance Domain Name System (DNS) or IP address</p>
</li>
<li>
<p><code>db-port</code>: Denotes your PostgreSQL instance port number, such as <code>5432</code></p>
</li>
<li>
<p><code>username</code>: Denotes the user name to connect to your PostgreSQL instance</p>
</li>
<li>
<p><code>password</code>: Denotes the password to connect to your PostgreSQL instance</p>
</li>
</ul>
</div>
</li>
<li>
<p>You have installed the Red Hat Developer Hub Operator.</p>
</li>
<li>
<p>Optional: You have a CA certificate, Transport Layer Security (TLS) private key, and TLS certificate so that you can secure your database connection by using the TLS protocol. For more information, refer to your PostgreSQL vendor documentation.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, Developer Hub uses a database for each plugin and automatically creates it if none is found. You might need the <code>Create Database</code> privilege in addition to <code>PSQL Database</code> privileges for configuring an external PostgreSQL instance.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Optional: Create a certificate secret to configure your PostgreSQL instance with a TLS connection:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt;EOF | oc -n &lt;your-namespace&gt; create -f -
apiVersion: v1
kind: Secret
metadata:
 name: &lt;crt-secret&gt; <b class="conum">(1)</b>
type: Opaque
stringData:
 postgres-ca.pem: |-
  -----BEGIN CERTIFICATE-----
  &lt;ca-certificate-key&gt; <b class="conum">(2)</b>
 postgres-key.key: |-
  -----BEGIN CERTIFICATE-----
  &lt;tls-private-key&gt; <b class="conum">(3)</b>
 postgres-crt.pem: |-
  -----BEGIN CERTIFICATE-----
  &lt;tls-certificate-key&gt; <b class="conum">(4)</b>
  # ...
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Provide the name of the certificate secret.</p>
</li>
<li>
<p>Provide the CA certificate key.</p>
</li>
<li>
<p>Optional: Provide the TLS private key.</p>
</li>
<li>
<p>Optional: Provide the TLS certificate key.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a credential secret to connect with the PostgreSQL instance:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt;EOF | oc -n &lt;your-namespace&gt; create -f -
apiVersion: v1
kind: Secret
metadata:
 name: &lt;cred-secret&gt; <b class="conum">(1)</b>
type: Opaque
stringData: <b class="conum">(2)</b>
 POSTGRES_PASSWORD: &lt;password&gt;
 POSTGRES_PORT: "&lt;db-port&gt;"
 POSTGRES_USER: &lt;username&gt;
 POSTGRES_HOST: &lt;db-host&gt;
 PGSSLMODE: &lt;ssl-mode&gt; # for TLS connection <b class="conum">(3)</b>
 NODE_EXTRA_CA_CERTS: &lt;abs-path-to-pem-file&gt; # for TLS connection, e.g. /opt/app-root/src/postgres-crt.pem <b class="conum">(4)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Provide the name of the credential secret.</p>
</li>
<li>
<p>Provide credential data to connect with your PostgreSQL instance.</p>
</li>
<li>
<p>Optional: Provide the value based on the required <a href="https://www.postgresql.org/docs/15/libpq-connect.html#LIBPQ-CONNECT-SSLMODE">Secure Sockets Layer (SSL) mode</a>.</p>
</li>
<li>
<p>Optional: Provide the value only if you need a TLS connection for your PostgreSQL instance.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a <code>Backstage</code> custom resource (CR):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt;EOF | oc -n &lt;your-namespace&gt; create -f -
apiVersion: rhdh.redhat.com/v1alpha1
kind: Backstage
metadata:
  name: &lt;backstage-instance-name&gt;
spec:
  database:
    enableLocalDb: false <b class="conum">(1)</b>
  application:
    extraFiles:
      mountPath: &lt;path&gt; # e g /opt/app-root/src
      secrets:
        - name: &lt;crt-secret&gt; <b class="conum">(2)</b>
          key: postgres-crt.pem, postgres-ca.pem, postgres-key.key # key name as in &lt;crt-secret&gt; Secret
    extraEnvs:
      secrets:
        - name: &lt;cred-secret&gt; <b class="conum">(3)</b>
        # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Set the value of the <code>enableLocalDb</code> parameter to <code>false</code> to disable creating local PostgreSQL instances.</p>
</li>
<li>
<p>Provide the name of the certificate secret if you have configured a TLS connection.</p>
</li>
<li>
<p>Provide the name of the credential secret that you created.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The environment variables listed in the <code>Backstage</code> CR work with the Operator default configuration. If you have changed the Operator default configuration, you must reconfigure the <code>Backstage</code> CR accordingly.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Apply the <code>Backstage</code> CR to the namespace where you have deployed the RHDH instance.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-configuring-postgresql-instance-using-helm_admin-rhdh">3.2. Configuring an external PostgreSQL instance using the Helm Chart</h3>
<div class="paragraph">
<p>You can configure an external PostgreSQL instance by using the Helm Chart. By default, the Helm Chart creates and manages a local instance of PostgreSQL in the same namespace where you have deployed the RHDH instance. However, you can change this default setting to configure an external PostgreSQL database server, for example, Amazon Web Services (AWS) Relational Database Service (RDS) or Azure database.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You are using a supported version of PostgreSQL. For more information, see the <a href="https://access.redhat.com/support/policy/updates/developerhub">Product life cycle page</a>.</p>
</li>
<li>
<p>You have the following details:</p>
<div class="ulist">
<ul>
<li>
<p><code>db-host</code>: Denotes your PostgreSQL instance Domain Name System (DNS) or IP address</p>
</li>
<li>
<p><code>db-port</code>: Denotes your PostgreSQL instance port number, such as <code>5432</code></p>
</li>
<li>
<p><code>username</code>: Denotes the user name to connect to your PostgreSQL instance</p>
</li>
<li>
<p><code>password</code>: Denotes the password to connect to your PostgreSQL instance</p>
</li>
</ul>
</div>
</li>
<li>
<p>You have installed the RHDH application by using the Helm Chart.</p>
</li>
<li>
<p>Optional: You have a CA certificate, Transport Layer Security (TLS) private key, and TLS certificate so that you can secure your database connection by using the TLS protocol. For more information, refer to your PostgreSQL vendor documentation.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By default, Developer Hub uses a database for each plugin and automatically creates it if none is found. You might need the <code>Create Database</code> privilege in addition to <code>PSQL Database</code> privileges for configuring an external PostgreSQL instance.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Optional: Create a certificate secret to configure your PostgreSQL instance with a TLS connection:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt;EOF | oc -n &lt;your-namespace&gt; create -f -
apiVersion: v1
kind: Secret
metadata:
 name: &lt;crt-secret&gt; <b class="conum">(1)</b>
type: Opaque
stringData:
 postgres-ca.pem: |-
  -----BEGIN CERTIFICATE-----
  &lt;ca-certificate-key&gt; <b class="conum">(2)</b>
 postgres-key.key: |-
  -----BEGIN CERTIFICATE-----
  &lt;tls-private-key&gt; <b class="conum">(3)</b>
 postgres-crt.pem: |-
  -----BEGIN CERTIFICATE-----
  &lt;tls-certificate-key&gt; <b class="conum">(4)</b>
  # ...
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Provide the name of the certificate secret.</p>
</li>
<li>
<p>Provide the CA certificate key.</p>
</li>
<li>
<p>Optional: Provide the TLS private key.</p>
</li>
<li>
<p>Optional: Provide the TLS certificate key.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a credential secret to connect with the PostgreSQL instance:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt;EOF | oc -n &lt;your-namespace&gt; create -f -
apiVersion: v1
kind: Secret
metadata:
 name: &lt;cred-secret&gt; <b class="conum">(1)</b>
type: Opaque
stringData: <b class="conum">(2)</b>
 POSTGRES_PASSWORD: &lt;password&gt;
 POSTGRES_PORT: "&lt;db-port&gt;"
 POSTGRES_USER: &lt;username&gt;
 POSTGRES_HOST: &lt;db-host&gt;
 PGSSLMODE: &lt;ssl-mode&gt; # for TLS connection <b class="conum">(3)</b>
 NODE_EXTRA_CA_CERTS: &lt;abs-path-to-pem-file&gt; # for TLS connection, e.g. /opt/app-root/src/postgres-crt.pem <b class="conum">(4)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Provide the name of the credential secret.</p>
</li>
<li>
<p>Provide credential data to connect with your PostgreSQL instance.</p>
</li>
<li>
<p>Optional: Provide the value based on the required <a href="https://www.postgresql.org/docs/15/libpq-connect.html#LIBPQ-CONNECT-SSLMODE">Secure Sockets Layer (SSL) mode</a>.</p>
</li>
<li>
<p>Optional: Provide the value only if you need a TLS connection for your PostgreSQL instance.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure your PostgreSQL instance in the Helm configuration file named <code>values.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ...
upstream:
  postgresql:
    enabled: false  # disable PostgreSQL instance creation <b class="conum">(1)</b>
    auth:
      existingSecret: &lt;cred-secret&gt; # inject credentials secret to Backstage <b class="conum">(2)</b>
  backstage:
    appConfig:
      backend:
        database:
          connection:  # configure Backstage DB connection parameters
            host: ${POSTGRES_HOST}
            port: ${POSTGRES_PORT}
            user: ${POSTGRES_USER}
            password: ${POSTGRES_PASSWORD}
            ssl:
              rejectUnauthorized: true,
              ca:
                $file: /opt/app-root/src/postgres-ca.pem
              key:
                $file: /opt/app-root/src/postgres-key.key
              cert:
                $file: /opt/app-root/src/postgres-crt.pem
  extraEnvVarsSecrets:
    - &lt;cred-secret&gt; # inject credentials secret to Backstage <b class="conum">(3)</b>
  extraEnvVars:
    - name: BACKEND_SECRET
      valueFrom:
        secretKeyRef:
          key: backend-secret
          name: '{{ include "janus-idp.backend-secret-name" $ }}'
  extraVolumeMounts:
    - mountPath: /opt/app-root/src/dynamic-plugins-root
      name: dynamic-plugins-root
    - mountPath: /opt/app-root/src/postgres-crt.pem
      name: postgres-crt # inject TLS certificate to Backstage cont. <b class="conum">(4)</b>
      subPath: postgres-crt.pem
    - mountPath: /opt/app-root/src/postgres-ca.pem
      name: postgres-ca # inject CA certificate to Backstage cont. <b class="conum">(5)</b>
      subPath: postgres-ca.pem
    - mountPath: /opt/app-root/src/postgres-key.key
      name: postgres-key # inject TLS private key to Backstage cont. <b class="conum">(6)</b>
      subPath: postgres-key.key
  extraVolumes:
    - ephemeral:
        volumeClaimTemplate:
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 1Gi
      name: dynamic-plugins-root
    - configMap:
        defaultMode: 420
        name: dynamic-plugins
        optional: true
      name: dynamic-plugins
    - name: dynamic-plugins-npmrc
      secret:
        defaultMode: 420
        optional: true
        secretName: dynamic-plugins-npmrc
    - name: postgres-crt
      secret:
        secretName: &lt;crt-secret&gt; <b class="conum">(7)</b>
        # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Set the value of the <code>upstream.postgresql.enabled</code> parameter to <code>false</code> to disable creating local PostgreSQL instances.</p>
</li>
<li>
<p>Provide the name of the credential secret.</p>
</li>
<li>
<p>Provide the name of the credential secret.</p>
</li>
<li>
<p>Optional: Provide the name of the TLS certificate only for a TLS connection.</p>
</li>
<li>
<p>Optional: Provide the name of the CA certificate only for a TLS connection.</p>
</li>
<li>
<p>Optional: Provide the name of the TLS private key only if your TLS connection requires a private key.</p>
</li>
<li>
<p>Provide the name of the certificate secret if you have configured a TLS connection.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the configuration changes in your Helm configuration file named <code>values.yaml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>helm upgrade -n &lt;your-namespace&gt; &lt;your-deploy-name&gt; openshift-helm-charts/redhat-developer-hub -f values.yaml --version 1.2.0</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-migrating-databases-to-an-external-server_admin-rhdh">3.3. Migrating local databases to an external database server using the Operator</h3>
<div class="paragraph">
<p>By default, Red Hat Developer Hub hosts the data for each plugin in a PostgreSQL database. When you fetch the list of databases, you might see multiple databases based on the number of plugins configured in Developer Hub. You can migrate the data from an RHDH instance hosted on a local PostgreSQL server to an external PostgreSQL service, such as AWS RDS, Azure database, or Crunchy database. To migrate the data from each RHDH instance, you can use PostgreSQL utilities, such as <a href="https://www.postgresql.org/docs/current/app-pgdump.html"><code>pg_dump</code></a> with <a href="https://www.postgresql.org/docs/current/app-psql.html"><code>psql</code></a> or <a href="https://www.pgadmin.org/"><code>pgAdmin</code></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The following procedure uses a <a href="https://github.com/janus-idp/operator/blob/1.2.x/hack/db_copy.sh">database copy script</a> to do a quick migration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the <a href="https://www.postgresql.org/docs/current/app-pgdump.html"><code>pg_dump</code></a> and <a href="https://www.postgresql.org/docs/current/app-psql.html"><code>psql</code></a> utilities on your local machine.</p>
</li>
<li>
<p>For data export, you have the PGSQL user privileges to make a full dump of local databases.</p>
</li>
<li>
<p>For data import, you have the PGSQL admin privileges to create an external database and populate it with database dumps.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure port forwarding for the local PostgreSQL database pod by running the following command on a terminal:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc port-forward -n &lt;your-namespace&gt; &lt;pgsql-pod-name&gt; &lt;forward-to-port&gt;:&lt;forward-from-port&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>&lt;pgsql-pod-name&gt;</code> variable denotes the name of a PostgreSQL pod with the format <code>backstage-psql-&lt;deployment-name&gt;-&lt;_index&gt;</code>.</p>
</li>
<li>
<p>The <code>&lt;forward-to-port&gt;</code> variable denotes the port of your choice to forward PostgreSQL data to.</p>
</li>
<li>
<p>The <code>&lt;forward-from-port&gt;</code> variable denotes the local PostgreSQL instance port, such as <code>5432</code>.</p>
<div class="listingblock">
<div class="title">Example: Configuring port forwarding</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc port-forward -n developer-hub backstage-psql-developer-hub-0 15432:5432</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Make a copy of the following <code>db_copy.sh</code> script and edit the details based on your configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-script" data-lang="script">#!/bin/bash

to_host=&lt;db-service-host&gt; <b class="conum">(1)</b>
to_port=5432 <b class="conum">(2)</b>
to_user=postgres <b class="conum">(3)</b>

from_host=127.0.0.1 <b class="conum">(4)</b>
from_port=15432 <b class="conum">(5)</b>
from_user=postgres <b class="conum">(6)</b>

allDB=("backstage_plugin_app" "backstage_plugin_auth" "backstage_plugin_catalog" "backstage_plugin_permission" "backstage_plugin_scaffolder" "backstage_plugin_search") <b class="conum">(7)</b>

for db in ${!allDB[@]};
do
  db=${allDB[$db]}
  echo Copying database: $db
  PGPASSWORD=$TO_PSW psql -h $to_host -p $to_port -U $to_user -c "create database $db;"
  pg_dump -h $from_host -p $from_port -U $from_user -d $db | PGPASSWORD=$TO_PSW psql -h $to_host -p $to_port -U $to_user -d $db
done</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The destination host name, for example, <code>&lt;db-instance-name&gt;.rds.amazonaws.com</code>.</p>
</li>
<li>
<p>The destination port, such as <code>5432</code>.</p>
</li>
<li>
<p>The destination server username, for example, <code>postgres</code>.</p>
</li>
<li>
<p>The source host name, such as <code>127.0.0.1</code>.</p>
</li>
<li>
<p>The source port number, such as the <code>&lt;forward-to-port&gt;</code> variable.</p>
</li>
<li>
<p>The source server username, for example, <code>postgres</code>.</p>
</li>
<li>
<p>The name of databases to import in double quotes separated by spaces, for example, <code>("backstage_plugin_app" "backstage_plugin_auth" "backstage_plugin_catalog" "backstage_plugin_permission" "backstage_plugin_scaffolder" "backstage_plugin_search")</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a destination database for copying the data:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">/bin/bash TO_PSW=&lt;destination-db-password&gt; /path/to/db_copy.sh <b class="conum">(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>&lt;destination-db-password&gt;</code> variable denotes the password to connect to the destination database.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can stop port forwarding when the copying of the data is complete. For more information about handling large databases and using the compression tools, see the <a href="https://www.postgresql.org/docs/current/backup-dump.html#BACKUP-DUMP-LARGE">Handling Large Databases</a> section on the PostgreSQL website.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Reconfigure your <code>Backstage</code> custom resource (CR). For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.2/html-single/administration_guide_for_red_hat_developer_hub/index#proc-configuring-postgresql-instance-using-operator_admin-rhdh">Configuring an external PostgreSQL instance using the Operator</a>.</p>
</li>
<li>
<p>Check that the following code is present at the end of your <code>Backstage</code> CR after reconfiguration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ...
spec:
  database:
    enableLocalDb: false
  application:
  # ...
    extraFiles:
      secrets:
        - name: &lt;crt-secret&gt;
          key: postgres-crt.pem # key name as in &lt;crt-secret&gt; Secret
    extraEnvs:
      secrets:
        - name: &lt;cred-secret&gt;
# ...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Reconfiguring the <code>Backstage</code> CR deletes the corresponding <code>StatefulSet</code> and <code>Pod</code> objects, but does not delete the <code>PersistenceVolumeClaim</code> object. Use the following command to delete the local <code>PersistenceVolumeClaim</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc -n developer-hub delete pvc &lt;local-psql-pvc-name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where, the <code>&lt;local-psql-pvc-name&gt;</code> variable is in the <code>data-&lt;psql-pod-name&gt;</code> format.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Apply the configuration changes.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Verify that your RHDH instance is running with the migrated data and does not contain the local PostgreSQL database by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc get pods -n &lt;your-namespace&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Check the output for the following details:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>backstage-developer-hub-xxx</code> pod is in running state.</p>
</li>
<li>
<p>The <code>backstage-psql-developer-hub-0</code> pod is not available.</p>
<div class="paragraph">
<p>You can also verify these details using the <strong>Topology</strong> view in the OpenShift Container Platform web console.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="enabling-authentication">4. Enabling authentication in Red Hat Developer Hub</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Authentication within Red Hat Developer Hub facilitates user sign-in, identification, and access to external resources.
It supports multiple authentication providers.</p>
</div>
<div class="paragraph">
<p>Authentication providers are typically used in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One provider for sign-in and identification.</p>
</li>
<li>
<p>Additional providers for accessing external resources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Red Hat Developer Hub supports the following authentication providers:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Auth0</dt>
<dd>
<p><code>auth0</code></p>
</dd>
<dt class="hdlist1">Atlassian</dt>
<dd>
<p><code>atlassian</code></p>
</dd>
<dt class="hdlist1">Microsoft Azure</dt>
<dd>
<p><code>microsoft</code></p>
</dd>
<dt class="hdlist1">Microsoft Azure Easy Auth</dt>
<dd>
<p><code>azure-easyauth</code></p>
</dd>
<dt class="hdlist1">Bitbucket</dt>
<dd>
<p><code>bitbucket</code></p>
</dd>
<dt class="hdlist1">Bitbucket Server</dt>
<dd>
<p><code>bitbucketServer</code></p>
</dd>
<dt class="hdlist1">Cloudflare Access</dt>
<dd>
<p><code>cfaccess</code></p>
</dd>
<dt class="hdlist1">GitHub</dt>
<dd>
<p><code>github</code></p>
</dd>
<dt class="hdlist1">GitLab</dt>
<dd>
<p><code>gitlab</code></p>
</dd>
<dt class="hdlist1">Google</dt>
<dd>
<p><code>google</code></p>
</dd>
<dt class="hdlist1">Google IAP</dt>
<dd>
<p><code>gcp-iap</code></p>
</dd>
<dt class="hdlist1">OIDC</dt>
<dd>
<p><code>oidc</code></p>
</dd>
<dt class="hdlist1">Okta</dt>
<dd>
<p><code>okta</code></p>
</dd>
<dt class="hdlist1">OAuth 2 Custom Proxy</dt>
<dd>
<p><code>oauth2Proxy</code></p>
</dd>
<dt class="hdlist1">OneLogin</dt>
<dd>
<p><code>onelogin</code></p>
</dd>
<dt class="hdlist1">SAML</dt>
<dd>
<p><code>saml</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For each provider that you want to use, follow the dedicated procedure to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up the shared secret that the authentication provider and Red Hat Developer Hub require to communicate.</p>
</li>
<li>
<p>Configure Red Hat Developer Hub to use the authentication provider.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="proc-adding-azure-as-an-authentication-provider_admin-rhdh">4.1. Enabling the Microsoft Azure authentication provider</h3>
<div class="paragraph">
<p>Red Hat Developer Hub includes a Microsoft Azure authentication provider that can authenticate users by using OAuth.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To allow Developer Hub to authenticate with Microsoft Azure, create an OAuth Application in Microsoft Azure.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Go to <a href="https://portal.azure.com/#view/Microsoft_AAD_RegisteredApps/ApplicationsListBlade"><strong>Azure Portal &gt; App registrations</strong></a>, and create an <strong>App Registration</strong> for Developer Hub.</p>
</li>
<li>
<p>On your <strong>App registration</strong> overview page, add a new <strong>Web platform configuration</strong>, with the configuration:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Redirect URI</strong></dt>
<dd>
<p>Enter the backend authentication URI set in Developer Hub: <code>https://<em>&lt;APP_FQDN&gt;</em>/api/auth/microsoft/handler/frame</code></p>
</dd>
<dt class="hdlist1"><strong>Front-channel logout URL</strong></dt>
<dd>
<p>Leave blank.</p>
</dd>
<dt class="hdlist1"><strong>Implicit grant and hybrid flows</strong></dt>
<dd>
<p>Leave all checkboxes cleared.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>On the <strong>API permissions</strong> tab, click <strong>Add Permission</strong>, then add the following <strong>Delegated permission</strong> for the
<strong>Microsoft Graph API</strong>:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>email</code></dt>
<dt class="hdlist1"><code>offline_access</code></dt>
<dt class="hdlist1"><code>openid</code></dt>
<dt class="hdlist1"><code>profile</code></dt>
<dt class="hdlist1"><code>User.Read</code></dt>
<dt class="hdlist1">(Optional)</dt>
<dd>
<p>Optional custom scopes of the Microsoft Graph API that you define both here and in the Developer Hub configuration (<code>app-config-rhdh.yaml</code>).</p>
</dd>
</dl>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Your company might require you to grant admin consent for these permissions.
Even if your company does not require admin consent, you might do so as it means users do not need to individually consent the first time they access backstage.
To grant admin consent, a directory admin must go to the <a href="https://learn.microsoft.com/en-us/azure/active-directory/manage-apps/user-admin-consent-overview">admin consent</a> page and click <strong>Grant admin consent for COMPANY NAME</strong>.
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Go to the <strong>Certificates &amp; Secrets</strong> page, then the <strong>Client secrets</strong> tab, and create a new client secret.
Save the <strong>Client secret</strong> for the next step.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add your Microsoft Azure credentials in your Developer Hub secrets.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Edit your Developer Hub secrets, such as <code>secrets-rhdh</code>.</p>
</li>
<li>
<p>Add the following key/value pairs:</p>
<div class="ulist">
<ul>
<li>
<p><code>AUTH_AZURE_CLIENT_ID</code>: Enter the <strong>Application ID</strong> that you generated on Microsoft Azure.</p>
</li>
<li>
<p><code>AUTH_AZURE_CLIENT_SECRET</code>: Enter the <strong>Client secret</strong> that you generated on Microsoft Azure.</p>
</li>
<li>
<p><code>AUTH_AZURE_TENANT_ID</code>: Enter your <strong>Tenant ID</strong> on Microsoft Azure.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up the Microsoft Azure authentication provider in your Developer Hub custom configuration.</p>
<div class="paragraph">
<p>Edit your custom Developer Hub config map, such as <code>app-config-rhdh</code>.</p>
</div>
<div class="paragraph">
<p>In the <code>app-config-rhdh.yaml</code> content, add the <code>microsoft</code> provider configuration under the root <code>auth</code> configuration, and enable the <code>microsoft</code> provider for sign-in:</p>
</div>
<div class="listingblock">
<div class="title"><code>app-config-rhdh.yaml</code> fragment</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">auth:
  environment: production
  providers:
    microsoft:
      production:
        clientId: ${AUTH_AZURE_CLIENT_ID}
        clientSecret: ${AUTH_AZURE_CLIENT_SECRET}
        tenantId: ${AUTH_AZURE_TENANT_ID}
        # domainHint: ${AUTH_AZURE_TENANT_ID} # <b class="conum">(1)</b>
        # additionalScopes: # <b class="conum">(2)</b>
          # - Mail.Send
signInPage: microsoft # <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Optional for single-tenant applications. You can reduce login friction for users with accounts in multiple tenants by automatically filtering out accounts from other tenants. If you want to use this parameter for a single-tenant application, uncomment and enter the tenant ID. If your application registration is multi-tenant, leave this parameter blank. For more information, see <a href="https://learn.microsoft.com/en-us/azure/active-directory/manage-apps/home-realm-discovery-policy">Home Realm Discovery</a>.</p>
</li>
<li>
<p>Optional for additional scopes. To add scopes for the application registration, uncomment and enter the list of scopes that you want to add.
The default and mandatory value is <code>['user.read']</code>.</p>
</li>
<li>
<p>To enable the Microsoft Azure provider as default sign-in provider.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Optional for environments with restrictions on outgoing access, such as firewall rules. If your environment has outgoing access restrictions make sure your Backstage backend has access to the following hosts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>login.microsoftonline.com</code>: To get and exchange authorization codes and access tokens.</p>
</li>
<li>
<p><code>graph.microsoft.com</code>: To fetch user profile information (as seen in this source code).
If this host is unreachable, users might see an <em>Authentication failed, failed to fetch user profile</em> error when they attempt to log in.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="proc-adding-gitlab-oauth-as-an-authentication-provider_admin-rhdh">4.2. Enabling the GitLab OAuth authentication provider</h3>
<div class="paragraph">
<p>Red Hat Developer Hub includes a GitLab authentication provider that can authenticate users by using GitLab OAuth.</p>
</div>
<div class="ulist">
<div class="title">Prerequistes</div>
<ul>
<li>
<p>You configured Developer Hub with a custom config map and secret.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To allow Developer Hub to authenticate with Gitlab, create an OAuth Application in Gitlab.</p>
<div class="paragraph">
<p>Go to <a href="https://gitlab.com/-/profile/applications">GitLab User settings &gt; Applications</a>, and click the <strong>Add new application</strong> button.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Name</strong></dt>
<dd>
<p>Enter your application name, such as <code>Developer Hub</code>.</p>
</dd>
<dt class="hdlist1"><strong>Redirect URI</strong></dt>
<dd>
<p>Enter the backend authentication URI set in Developer Hub, such as <code>http://<em>&lt;APP_FQDN&gt;</em>/api/auth/gitlab/handler/frame</code>.
Due to a peculiarity with GitLab OAuth, ensure the URL has no trailing <code>/</code> after 'frame'.</p>
</dd>
<dt class="hdlist1"><strong>Scopes</strong></dt>
<dd>
<p>Select the following scopes from the list and click <strong>Save application</strong>:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>read_user</code></dt>
<dd>
<p>Grants read-only access to the authenticated user&#8217;s profile through the /user API endpoint, which includes username, public email, and full name.
Also grants access to read-only API endpoints under /users.</p>
</dd>
<dt class="hdlist1"><code>read_repository</code></dt>
<dd>
<p>Grants read-only access to the authenticated user&#8217;s profile through the /user API endpoint, which includes username, public email, and full name.
Also grants access to read-only API endpoints under /users.</p>
</dd>
<dt class="hdlist1"><code>write_repository</code></dt>
<dd>
<p>Grants read/write access to repositories on private projects using Git-over-HTTP (not using the API).</p>
</dd>
<dt class="hdlist1"><code>openid</code></dt>
<dd>
<p>Grants permission to authenticate with GitLab using OpenID Connect.
Also gives read-only access to the user&#8217;s profile and group memberships.</p>
</dd>
<dt class="hdlist1"><code>profile</code></dt>
<dd>
<p>Grants read-only access to the user&#8217;s profile data using OpenID Connect.</p>
</dd>
<dt class="hdlist1"><code>email</code></dt>
<dd>
<p>Grants read-only access to the user&#8217;s primary email address using OpenID Connect.</p>
<div class="paragraph">
<p>Save the <strong>Application ID</strong> and <strong>Secret</strong> for the next step.</p>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Add your Gitlab credentials in your Developer Hub secrets.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit your Developer Hub secrets, such as <code>secrets-rhdh</code>.</p>
</li>
<li>
<p>Add the following key/value pairs:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>AUTH_GITLAB_CLIENT_ID</code></dt>
<dd>
<p>Enter the <strong>Application ID</strong> that you generated on GitLab, such as <code>4928c033ab3d592845c044a653bc20583baf84f2e67b954c6fdb32a532ab76c9</code>.</p>
</dd>
<dt class="hdlist1"><code>AUTH_GITLAB_CLIENT_SECRET</code></dt>
<dd>
<p>Enter the <strong>Secret</strong> that you generated on Gitlab, such as <code>gloas-f2c9c350759cc08346fbf94a476ae83c579c76dd629fc5eeef9dc21eedfe0475</code>.</p>
</dd>
</dl>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Set up the Gitlab authentication provider in your Developer Hub custom configuration.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit your custom Developer Hub config map, such as <code>app-config-rhdh</code>.</p>
</li>
<li>
<p>In the <code>app-config-rhdh.yaml</code> content, add the <code>gitlab</code> provider configuration under the root <code>auth</code> configuration, and enable the <code>gitlab</code> provider for sign-in:</p>
<div class="listingblock">
<div class="title"><code>app-config-rhdh.yaml</code> fragment</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">auth:
  environment: production
  providers:
    gitlab:
      production:
        clientId: ${AUTH_GITLAB_CLIENT_ID}
        clientSecret: ${AUTH_GITLAB_CLIENT_SECRET}
        # audience: https://gitlab.company.com # <b class="conum">(1)</b>
        # callbackUrl: https://<em>&lt;APP_FQDN&gt;</em>/api/auth/gitlab/handler/frame # <b class="conum">(2)</b>
signInPage: gitlab # <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Optionally, when using a self-hosted Gitlab: uncomment, and enter your GitLab instance base URL, such as
<code>https://gitlab.company.com</code>.</p>
</li>
<li>
<p>Optionally, when using a custom redirect URI: uncomment, and enter the URL matching the <strong>Redirect URI</strong> registered when creating your GitLab OAuth App, such as <code>http://<em>&lt;APP_FQDN&gt;</em>/api/auth/gitlab/handler/frame</code>.
Due to a peculiarity with GitLab OAuth, ensure the URL has no trailing <code>/</code> after 'frame'.</p>
</li>
<li>
<p>To enable the Gitlab provider as default sign-in provider.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>The <code>backstage-developer-hub</code> deployment starts a pod with the updated configuration.</p>
</li>
<li>
<p>Your Developer Hub sign-in page displays <strong>Sign in using GitLab</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-rhdh-telemetry">5. Telemetry data collection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The telemetry data collection feature is enabled by default. Red Hat Developer Hub sends telemetry data to Red Hat by using the <code>backstage-plugin-analytics-provider-segment</code> plugin.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can disable the telemetry data collection feature based on your needs. For example, in an air-gapped environment, you can disable this feature to avoid needless outbound requests affecting the responsiveness of the RHDH application. For more details, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.2/html-single/administration_guide_for_red_hat_developer_hub/index#disabling-telemetry-data-collection_admin-rhdh">Disabling telemetry data collection in RHDH</a> section.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Red Hat collects and analyzes the following data to improve your experience with Red Hat Developer Hub:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Events of page visits and clicks on links or buttons.</p>
</li>
<li>
<p>System-related information, for example, locale, timezone, user agent including browser and OS details.</p>
</li>
<li>
<p>Page-related information, for example, title, category, extension name, URL, path, referrer, and search parameters.</p>
</li>
<li>
<p>Anonymized IP addresses, recorded as <code>0.0.0.0</code>.</p>
</li>
<li>
<p>Anonymized username hashes, which are unique identifiers used solely to identify the number of unique users of the RHDH application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With RHDH, you can customize the telemetry data collection feature and the telemetry Segment source configuration based on your needs.</p>
</div>
<div class="sect2">
<h3 id="disabling-telemetry-data-collection_admin-rhdh">5.1. Disabling telemetry data collection in RHDH</h3>
<div class="paragraph">
<p>To disable telemetry data collection, you must disable the <code>analytics-provider-segment</code> plugin either using the Helm Chart or the Red Hat Developer Hub Operator configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the <code>analytics-provider-segment</code> plugin is already present in your dynamic plugins configuration, set the value of the <code>plugins.disabled</code> parameter to <code>true</code> to disable telemetry data collection.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Disable the <code>analytics-provider-segment</code> plugin by using one of the following options:</p>
<div class="ulist">
<div class="title">Using Helm Chart</div>
<ul>
<li>
<p>Add the following YAML code in your Helm configuration file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ...
global:
  dynamic:
    plugins:
      - package: './dynamic-plugins/dist/janus-idp-backstage-plugin-analytics-provider-segment'
        disabled: true
# ...</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist loweralpha">
<div class="title">Using the Operator</div>
<ol class="loweralpha" type="a">
<li>
<p>Perform one of the following steps:</p>
<div class="ulist">
<ul>
<li>
<p>If you have created the <code>dynamic-plugins-rhdh</code> ConfigMap file, add the <code>analytics-provider-segment</code> plugin to the list of plugins and set its <code>plugins.disabled</code> parameter to <code>true</code>.</p>
</li>
<li>
<p>If you have not created the ConfigMap file, create it with the following YAML code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: dynamic-plugins-rhdh
data:
  dynamic-plugins.yaml: |
    includes:
      - dynamic-plugins.default.yaml
    plugins:
      - package: './dynamic-plugins/dist/janus-idp-backstage-plugin-analytics-provider-segment'
        disabled: true</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Set the value of the <code>dynamicPluginsConfigMapName</code> parameter to the name of the ConfigMap file in your <code>Backstage</code> custom resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ...
spec:
  application:
    dynamicPluginsConfigMapName: dynamic-plugins-rhdh
# ...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Save the configuration changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="enabling-telemetry-data-collection_admin-rhdh">5.2. Enabling telemetry data collection in RHDH</h3>
<div class="paragraph">
<p>The telemetry data collection feature is enabled by default. However, if you have disabled the feature and want to re-enable it, you must enable the <code>analytics-provider-segment</code> plugin either by using the Helm Chart or the Red Hat Developer Hub Operator configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the <code>analytics-provider-segment</code> plugin is already present in your dynamic plugins configuration, set the value of the <code>plugins.disabled</code> parameter to <code>false</code> to enable telemetry data collection.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the <code>analytics-provider-segment</code> plugin by using one of the following options:</p>
<div class="ulist">
<div class="title">Using Helm Chart</div>
<ul>
<li>
<p>Add the following YAML code in your Helm configuration file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ...
global:
  dynamic:
    plugins:
      - package: './dynamic-plugins/dist/janus-idp-backstage-plugin-analytics-provider-segment'
        disabled: false
# ...</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist loweralpha">
<div class="title">Using the Operator</div>
<ol class="loweralpha" type="a">
<li>
<p>Perform one of the following steps:</p>
<div class="ulist">
<ul>
<li>
<p>If you have created the <code>dynamic-plugins-rhdh</code> ConfigMap file, add the <code>analytics-provider-segment</code> plugin to the list of plugins and set its <code>plugins.disabled</code> parameter to <code>false</code>.</p>
</li>
<li>
<p>If you have not created the ConfigMap file, create it with the following YAML code:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: dynamic-plugins-rhdh
data:
  dynamic-plugins.yaml: |
    includes:
      - dynamic-plugins.default.yaml
    plugins:
      - package: './dynamic-plugins/dist/janus-idp-backstage-plugin-analytics-provider-segment'
        disabled: false</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Set the value of the <code>dynamicPluginsConfigMapName</code> parameter to the name of the ConfigMap file in your <code>Backstage</code> custom resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ...
spec:
  application:
    dynamicPluginsConfigMapName: dynamic-plugins-rhdh
# ...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Save the configuration changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="customizing-telemetry-segment_admin-rhdh">5.3. Customizing telemetry Segment source</h3>
<div class="paragraph">
<p>The <code>analytics-provider-segment</code> plugin sends the collected telemetry data to Red Hat by default. However, you can configure a new Segment source that receives telemetry data based on your needs. For configuration, you need a unique Segment write key that points to the Segment source.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>By configuring a new Segment source, you can collect and analyze the same set of data that is mentioned in the <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.2/html-single/administration_guide_for_red_hat_developer_hub/index#assembly-rhdh-telemetry">Telemetry data collection</a> section. You might also require to create your own telemetry data collection notice for your application users.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure integration with your Segment source by using one of the following options:</p>
<div class="ulist">
<div class="title">Using Helm Chart</div>
<ul>
<li>
<p>Add the following YAML code in your Helm configuration file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ...
upstream:
  backstage:
    extraEnvVars:
      - name: SEGMENT_WRITE_KEY
        value: &lt;segment_key&gt; # <b class="conum">(1)</b>
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>&lt;segment_key&gt;</code> denotes a unique identifier for your Segment source.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Using the Operator</div>
<ul>
<li>
<p>Add the following YAML code in your <code>Backstage</code> custom resource (CR):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ...
extraEnvs:
  envs:
    - name: SEGMENT_WRITE_KEY
      value: &lt;segment_key&gt; # <b class="conum">(1)</b>
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>&lt;segment_key&gt;</code> denotes a unique identifier for your Segment source.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Save the configuration changes.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-rhdh-observability">6. Enabling observability for Red Hat Developer Hub on OpenShift Container Platform</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="paragraph">
<p>In OpenShift Container Platform, metrics are exposed through an HTTP service endpoint under the <code>/metrics</code> canonical name. You can create a <code>ServiceMonitor</code> custom resource (CR) to scrape metrics from a service endpoint in a user-defined project.</p>
</div>
<div class="sect2">
<h3 id="proc-admin-enabling-metrics-ocp-helm_assembly-rhdh-observability">6.1. Enabling metrics monitoring in a Helm chart installation on an OpenShift Container Platform cluster</h3>
<div class="paragraph">
<p>You can enable and view metrics for a Red Hat Developer Hub Helm deployment from the <strong>Developer</strong> perspective of the OpenShift Container Platform web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your OpenShift Container Platform cluster has <a href="https://docs.openshift.com/container-platform/latest/observability/monitoring/enabling-monitoring-for-user-defined-projects.html">monitoring for user-defined projects</a> enabled.</p>
</li>
<li>
<p>You have installed Red Hat Developer Hub on OpenShift Container Platform using the Helm chart.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the <strong>Developer</strong> perspective in the OpenShift Container Platform web console, select the <strong>Topology</strong> view.</p>
</li>
<li>
<p>Click the overflow menu of the Red Hat Developer Hub Helm chart, and select <strong>Upgrade</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="images/rhdh/helm-upgrade.png" alt="helm upgrade">
</div>
</div>
</li>
<li>
<p>On the <strong>Upgrade Helm Release</strong> page, select the <strong>YAML view</strong> option in <strong>Configure via</strong>, then configure the <code>metrics</code> section in the YAML, as shown in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">upstream:
# ...
  metrics:
    serviceMonitor:
      enabled: true
      path: /metrics
# ...</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/rhdh/upgrade-helm-metrics.png" alt="upgrade helm metrics">
</div>
</div>
</li>
<li>
<p>Click <strong>Upgrade</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>From the <strong>Developer</strong> perspective in the OpenShift Container Platform web console, select the <strong>Observe</strong> view.</p>
</li>
<li>
<p>Click the <strong>Metrics</strong> tab to view metrics for Red Hat Developer Hub pods.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-admin-enabling-metrics-ocp-operator_assembly-rhdh-observability">6.2. Enabling metrics monitoring in a Red Hat Developer Hub Operator installation on an OpenShift Container Platform cluster</h3>
<div class="paragraph">
<p>You can enable and view metrics for an Operator-installed Red Hat Developer Hub instance from the <strong>Developer</strong> perspective of the OpenShift Container Platform web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Your OpenShift Container Platform cluster has <a href="https://docs.openshift.com/container-platform/latest/observability/monitoring/enabling-monitoring-for-user-defined-projects.html">monitoring for user-defined projects</a> enabled.</p>
</li>
<li>
<p>You have installed Red Hat Developer Hub on OpenShift Container Platform using the Red Hat Developer Hub Operator.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Currently, the Red Hat Developer Hub Operator does not support creating a <code>ServiceMonitor</code> custom resource (CR) by default. You must complete the following steps to create a <code>ServiceMonitor</code> CR to scrape metrics from the endpoint.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the <code>ServiceMonitor</code> CR as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: &lt;custom_resource_name&gt; # <b class="conum">(1)</b>
  namespace: &lt;project_name&gt; # <b class="conum">(2)</b>
  labels:
    app.kubernetes.io/instance: &lt;custom_resource_name&gt;
    app.kubernetes.io/name: backstage
spec:
  namespaceSelector:
    matchNames:
      - &lt;project_name&gt;
  selector:
    matchLabels:
      rhdh.redhat.com/app: backstage-&lt;custom_resource_name&gt;
  endpoints:
  - port: backend
    path: '/metrics'</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Replace <code>&lt;custom_resource_name&gt;</code> with the name of your Red Hat Developer Hub CR.</p>
</li>
<li>
<p>Replace <code>&lt;project_name&gt;</code> with the name of the OpenShift Container Platform project where your Red Hat Developer Hub instance is running.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the <code>ServiceMonitor</code> CR by running the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>From the <strong>Developer</strong> perspective in the OpenShift Container Platform web console, select the <strong>Observe</strong> view.</p>
</li>
<li>
<p>Click the <strong>Metrics</strong> tab to view metrics for Red Hat Developer Hub pods.</p>
</li>
</ol>
</div>
</div>
<div class="sect2 _additional-resources">
<h3 id="additional-resources_assembly-rhdh-observability">6.3. Additional resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/observability/monitoring/managing-metrics.html">OpenShift Container Platform - Managing metrics</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-running-rhdh-behind-a-proxy">7. Running the RHDH application behind a corporate proxy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can run the RHDH application behind a corporate proxy by setting any of the following environment variables before starting the application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>HTTP_PROXY</code>: Denotes the proxy to use for HTTP requests.</p>
</li>
<li>
<p><code>HTTPS_PROXY</code>: Denotes the proxy to use for HTTPS requests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, you can set the <code>NO_PROXY</code> environment variable to exclude certain domains from proxying. The variable value is a comma-separated list of hostnames that do not require a proxy to get reached, even if one is specified.</p>
</div>
<div class="sect2">
<h3 id="proc-configuring-proxy-in-helm-deployment_assembly-rhdh-observability">7.1. Configuring proxy information in Helm deployment</h3>
<div class="paragraph">
<p>For Helm-based deployment, either a developer or a cluster administrator with permissions to create resources in the cluster can configure the proxy variables in a <code>values.yaml</code> Helm configuration file.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the Red Hat Developer Hub application.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Set the proxy information in your Helm configuration file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">upstream:
  backstage:
    extraEnvVars:
      - name: HTTP_PROXY
        value: '&lt;http_proxy_url&gt;'
      - name: HTTPS_PROXY
        value: '&lt;https_proxy_url&gt;'
      - name: NO_PROXY
        value: '&lt;no_proxy_settings&gt;'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where,</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>&lt;http_proxy_url&gt;</code></dt>
<dd>
<p>Denotes a variable that you must replace with the HTTP proxy URL.</p>
</dd>
<dt class="hdlist1"><code>&lt;https_proxy_url&gt;</code></dt>
<dd>
<p>Denotes a variable that you must replace with the HTTPS proxy URL.</p>
</dd>
<dt class="hdlist1"><code>&lt;no_proxy_settings&gt;</code></dt>
<dd>
<p>Denotes a variable that you must replace with comma-separated URLs, which you want to exclude from proxying, for example, <code>foo.com,baz.com</code>.</p>
<div class="listingblock">
<div class="title">Example: Setting proxy variables using Helm Chart</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">upstream:
  backstage:
    extraEnvVars:
      - name: HTTP_PROXY
        value: 'http://10.10.10.105:3128'
      - name: HTTPS_PROXY
        value: 'http://10.10.10.106:3128'
      - name: NO_PROXY
        value: 'localhost,example.org'</code></pre>
</div>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Save the configuration changes.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-configuring-proxy-in-operator-deployment_assembly-rhdh-observability">7.2. Configuring proxy information in Operator deployment</h3>
<div class="paragraph">
<p>For Operator-based deployment, the approach you use for proxy configuration is based on your role:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As a cluster administrator with access to the Operator namespace, you can configure the proxy variables in the Operator&#8217;s default ConfigMap file. This configuration applies the proxy settings to all the users of the Operator.</p>
</li>
<li>
<p>As a developer, you can configure the proxy variables in a custom resource (CR) file. This configuration applies the proxy settings to the RHDH application created from that CR.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the Red Hat Developer Hub application.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Perform one of the following steps based on your role:</p>
<div class="ulist">
<ul>
<li>
<p>As an administrator, set the proxy information in the Operator&#8217;s default ConfigMap file:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Search for a ConfigMap file named <code>backstage-default-config</code> in the default namespace <code>rhdh-operator</code> and open it.</p>
</li>
<li>
<p>Find the <code>deployment.yaml</code> key.</p>
</li>
<li>
<p>Set the value of the <code>HTTP_PROXY</code>, <code>HTTPS_PROXY</code>, and <code>NO_PROXY</code> environment variables in the <code>Deployment</code> spec as shown in the following example:</p>
<div class="listingblock">
<div class="title">Example: Setting proxy variables in a ConfigMap file</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># Other fields omitted
  deployment.yaml: |-
    apiVersion: apps/v1
    kind: Deployment
    spec:
      template:
        spec:
          # Other fields omitted
          initContainers:
            - name: install-dynamic-plugins
              # command omitted
              env:
                - name: NPM_CONFIG_USERCONFIG
                  value: /opt/app-root/src/.npmrc.dynamic-plugins
                - name: HTTP_PROXY
                  value: 'http://10.10.10.105:3128'
                - name: HTTPS_PROXY
                  value: 'http://10.10.10.106:3128'
                - name: NO_PROXY
                  value: 'localhost,example.org'
              # Other fields omitted
          containers:
            - name: backstage-backend
              # Other fields omitted
              env:
                - name: APP_CONFIG_backend_listen_port
                  value: "7007"
                - name: HTTP_PROXY
                  value: 'http://10.10.10.105:3128'
                - name: HTTPS_PROXY
                  value: 'http://10.10.10.106:3128'
                - name: NO_PROXY
                  value: 'localhost,example.org'</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>As a developer, set the proxy information in your custom resource (CR) file as shown in the following example:</p>
<div class="listingblock">
<div class="title">Example: Setting proxy variables in a CR file</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spec:
  # Other fields omitted
  application:
    extraEnvs:
      envs:
        - name: HTTP_PROXY
          value: 'http://10.10.10.105:3128'
        - name: HTTPS_PROXY
          value: 'http://10.10.10.106:3128'
        - name: NO_PROXY
          value: 'localhost,example.org'</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Save the configuration changes.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-rhdh-integration-aws_assembly-rhdh-observability">8. Red Hat Developer Hub integration with Amazon Web Services (AWS)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can integrate your Red Hat Developer Hub application with Amazon Web Services (AWS), which can help you streamline your workflows within the AWS ecosystem. Integrating the Developer Hub resources with AWS provides access to a comprehensive suite of tools, services, and solutions.</p>
</div>
<div class="paragraph">
<p>The integration with AWS requires the deployment of Developer Hub in Elastic Kubernetes Service (EKS) using one of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Helm chart</p>
</li>
<li>
<p>The Red Hat Developer Hub Operator</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="proc-rhdh-deploy-eks-using-helm_assembly-rhdh-observability">8.1. Deploying Red Hat Developer Hub in Elastic Kubernetes Service (EKS) using Helm Chart</h3>
<div class="paragraph">
<p>When you deploy Developer Hub in Elastic Kubernetes Service (EKS) using Helm Chart, it orchestrates a robust development environment within the AWS ecosystem.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have an EKS cluster with AWS Application Load Balancer (ALB) add-on installed. For more information, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html">Application load balancing on Amazon Developer Hub</a> and <a href="https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html">Installing the AWS Load Balancer Controller add-on</a>.</p>
</li>
<li>
<p>You have configured a domain name for your Developer Hub instance. The domain name can be a hosted zone entry on Route 53 or managed outside of AWS. For more information, see <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/dns-configuring.html">Configuring Amazon Route 53 as your DNS service</a> documentation.</p>
</li>
<li>
<p>You have an entry in the AWS Certificate Manager (ACM) for your preferred domain name. Make sure to keep a record of your Certificate ARN.</p>
</li>
<li>
<p>You have subscribed to <code>registry.redhat.io</code>. For more information, see <a href="https://access.redhat.com/RegistryAuthentication">Red Hat Container Registry Authentication</a>.</p>
</li>
<li>
<p>You have set the context to the EKS cluster in your current <code>kubeconfig</code>. For more information, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/create-kubeconfig.html">Creating or updating a kubeconfig file for an Amazon EKS cluster</a>.</p>
</li>
<li>
<p>You have installed <code>kubectl</code>. For more information, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html">Installing or updating kubectl</a>.</p>
</li>
<li>
<p>You have installed Helm 3 or the latest. For more information, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/helm.html">Using Helm with Amazon EKS</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Go to your terminal and run the following command to add the Helm chart repository containing the Developer Hub chart to your local Helm registry:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>helm repo add openshift-helm-charts https://charts.openshift.io/</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create a pull secret using the following command:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl create secret docker-registry rhdh-pull-secret \
    --docker-server=registry.redhat.io \
    --docker-username=&lt;user_name&gt; \ <b class="conum">(1)</b>
    --docker-password=&lt;password&gt; \ <b class="conum">(2)</b>
    --docker-email=&lt;email&gt; <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Enter your username in the command.</p>
</li>
<li>
<p>Enter your password in the command.</p>
</li>
<li>
<p>Enter your email address in the command.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The created pull secret is used to pull the Developer Hub images from the Red Hat Ecosystem.</p>
</div>
</div>
</div>
</li>
<li>
<p>Create a file named <code>values.yaml</code> using the following template:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">global:
  # TODO: Set your application domain name.
  host: &lt;your Developer Hub domain name&gt;


route:
  enabled: false


upstream:
  service:
    # NodePort is required for the ALB to route to the Service
    type: NodePort


  ingress:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: alb


      alb.ingress.kubernetes.io/scheme: internet-facing


      # TODO: Using an ALB HTTPS Listener requires a certificate for your own domain. Fill in the ARN of your certificate, e.g.:
      alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:xxx:xxxx:certificate/xxxxxx


      alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS":443}]'


      alb.ingress.kubernetes.io/ssl-redirect: '443'


      # TODO: Set your application domain name.
      external-dns.alpha.kubernetes.io/hostname: &lt;your rhdh domain name&gt;


  backstage:
    image:
      pullSecrets:
      - rhdh-pull-secret
    podSecurityContext:
      # you can assign any random value as fsGroup
      fsGroup: 2000
  postgresql:
    image:
      pullSecrets:
      - rhdh-pull-secret
    primary:
      podSecurityContext:
        enabled: true
        # you can assign any random value as fsGroup
        fsGroup: 3000
  volumePermissions:
    enabled: true</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Run the following command in your terminal to deploy Developer Hub using the latest version of Helm Chart and using the values.yaml file created in the previous step:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>helm install rhdh \
  openshift-helm-charts/redhat-developer-hub \
  [--version 1.2.0] \
  --values /path/to/values.yaml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For the latest chart version, see <a href="https://github.com/openshift-helm-charts/charts/tree/main/charts/redhat/redhat/redhat-developer-hub" class="bare">https://github.com/openshift-helm-charts/charts/tree/main/charts/redhat/redhat/redhat-developer-hub</a>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Wait until the DNS name is responsive, indicating that your Developer Hub instance is ready for use.</p>
</div>
</div>
<div class="sect2">
<h3 id="proc-rhdh-deploy-eks-using-operator_assembly-rhdh-observability">8.2. Deploying Red Hat Developer Hub on Elastic Kubernetes Service (EKS) using the Operator</h3>
<div class="paragraph">
<p>You can deploy the Developer Hub on EKS using the Red Hat Developer Hub Operator with or without <a href="https://olm.operatorframework.io">Operator Lifecycle Manager (OLM) framework</a>. Following that, you can proceed to install your Developer Hub instance in EKS.</p>
</div>
<div class="sect3">
<h4 id="_installing-the-red-hat-developer-hub-operator-with-the-olm-framework">8.2.1. Installing the Red Hat Developer Hub Operator with the OLM framework</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have set the context to the EKS cluster in your current <code>kubeconfig</code>. For more information, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/create-kubeconfig.html">Creating or updating a kubeconfig file for an Amazon EKS cluster</a>.</p>
</li>
<li>
<p>You have installed <code>kubectl</code>. For more information, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html">Installing or updating kubectl</a>.</p>
</li>
<li>
<p>You have subscribed to <code>registry.redhat.io</code>. For more information, see <a href="https://access.redhat.com/RegistryAuthentication">Red Hat Container Registry Authentication</a>.</p>
</li>
<li>
<p>You have installed the Operator Lifecycle Manager (OLM). For more information about installation and troubleshooting, see <a href="https://operatorhub.io/how-to-install-an-operator#How-do-I-get-Operator-Lifecycle-Manager?">How do I get Operator Lifecycle Manager?</a></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the following command in your terminal to create the <code>rhdh-operator</code> namespace where the Operator is installed:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl create namespace rhdh-operator</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create a pull secret using the following command:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl -n rhdh-operator create secret docker-registry rhdh-pull-secret \
    --docker-server=registry.redhat.io \
    --docker-username=&lt;user_name&gt; \ <b class="conum">(1)</b>
    --docker-password=&lt;password&gt; \ <b class="conum">(2)</b>
    --docker-email=&lt;email&gt; <b class="conum">(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Enter your username in the command.</p>
</li>
<li>
<p>Enter your password in the command.</p>
</li>
<li>
<p>Enter your email address in the command.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The created pull secret is used to pull the Developer Hub images from the Red Hat Ecosystem.</p>
</div>
</div>
</div>
</li>
<li>
<p>Create a <code>CatalogSource</code> resource that contains the Operators from the Red Hat Ecosystem:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>cat &lt;&lt;EOF | kubectl -n rhdh-operator apply -f -
apiVersion: operators.coreos.com/v1alpha1
kind: CatalogSource
metadata:
  name: redhat-catalog
spec:
  sourceType: grpc
  image: registry.redhat.io/redhat/redhat-operator-index:v4.15
  secrets:
  - "rhdh-pull-secret"
  displayName: Red Hat Operators
EOF</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create an <code>OperatorGroup</code> resource as follows:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>cat &lt;&lt;EOF | kubectl apply -n rhdh-operator -f -
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: rhdh-operator-group
EOF</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create a <code>Subscription</code> resource using the following code:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>cat &lt;&lt;EOF | kubectl apply -n rhdh-operator -f -
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: rhdh
  namespace: rhdh-operator
spec:
  channel: fast
  installPlanApproval: Automatic
  name: rhdh
  source: redhat-catalog
  sourceNamespace: rhdh-operator
  startingCSV: rhdh-operator.v1.2.0
EOF</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Run the following command to verify that the created Operator is running:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl -n rhdh-operator get pods -w</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the operator pod shows <code>ImagePullBackOff</code> status, then you might need permissions to pull the image directly within the Operator deployment&#8217;s manifest.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You can include the required secret name in the <code>deployment.spec.template.spec.imagePullSecrets</code> list and verify the deployment name using <code>kubectl get deployment -n rhdh-operator</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl -n rhdh-operator patch deployment \
    rhdh.fast --patch '{"spec":{"template":{"spec":{"imagePullSecrets":[{"name":"rhdh-pull-secret"}]}}}}' \
    --type=merge</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Update the default configuration of the operator to ensure that Developer Hub resources can start correctly in EKS using the following steps:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Edit the <code>backstage-default-config</code> ConfigMap in the <code>rhdh-operator</code> namespace using the following command:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl -n rhdh-operator edit configmap backstage-default-config</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Locate the <code>db-statefulset.yaml</code> string and add the <code>fsGroup</code> to its <code>spec.template.spec.securityContext</code>, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  db-statefulset.yaml: |
    apiVersion: apps/v1
    kind: StatefulSet
--- TRUNCATED ---
    spec:
    --- TRUNCATED ---
      restartPolicy: Always
      securityContext:
      # You can assign any random value as fsGroup
        fsGroup: 2000
      serviceAccount: default
      serviceAccountName: default
--- TRUNCATED ---</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Locate the <code>deployment.yaml</code> string and add the <code>fsGroup</code> to its specification, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  deployment.yaml: |
    apiVersion: apps/v1
    kind: Deployment
--- TRUNCATED ---
    spec:
      securityContext:
        # You can assign any random value as fsGroup
        fsGroup: 3000
      automountServiceAccountToken: false
--- TRUNCATED ---</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Locate the <code>service.yaml</code> string and change the <code>type</code> to <code>NodePort</code> as follows:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  service.yaml: |
    apiVersion: v1
    kind: Service
    spec:
     # NodePort is required for the ALB to route to the Service
      type: NodePort
--- TRUNCATED ---</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Save and exit.</p>
<div class="paragraph">
<p>Wait for a few minutes until the changes are automatically applied to the operator pods.</p>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_installing-the-red-hat-developer-hub-operator-without-the-olm-framework">8.2.2. Installing the Red Hat Developer Hub Operator without the OLM framework</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed the following commands:</p>
<div class="ulist">
<ul>
<li>
<p><code>git</code></p>
</li>
<li>
<p><code>make</code></p>
</li>
<li>
<p><code>sed</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Clone the Operator repository to your local machine using the following command:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>git clone --depth=1 https://github.com/janus-idp/operator.git rhdh-operator &amp;&amp; cd rhdh-operator</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Run the following command and generate the deployment manifest:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>make deployment-manifest</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous command generates a file named <code>rhdh-operator-&lt;VERSION&gt;.yaml</code>, which is updated manually.</p>
</div>
</div>
</div>
</li>
<li>
<p>Run the following command to apply replacements in the generated deployment manifest:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sed -i "s/backstage-operator/rhdh-operator/g" rhdh-operator-*.yaml
sed -i "s/backstage-system/rhdh-operator/g" rhdh-operator-*.yaml
sed -i "s/backstage-controller-manager/rhdh-controller-manager/g" rhdh-operator-*.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Open the generated deployment manifest file in an editor and perform the following steps:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Locate the <code>db-statefulset.yaml</code> string and add the <code>fsGroup</code> to its <code>spec.template.spec.securityContext</code>, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>   db-statefulset.yaml: |
    apiVersion: apps/v1
    kind: StatefulSet
--- TRUNCATED ---
    spec:
    --- TRUNCATED ---
      restartPolicy: Always
      securityContext:
        # You can assign any random value as fsGroup
        fsGroup: 2000
      serviceAccount: default
      serviceAccountName: default
--- TRUNCATED ---</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Locate the <code>deployment.yaml</code> string and add the <code>fsGroup</code> to its specification, as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  deployment.yaml: |
    apiVersion: apps/v1
    kind: Deployment
--- TRUNCATED ---
    spec:
      securityContext:
        # You can assign any random value as fsGroup
        fsGroup: 3000
      automountServiceAccountToken: false
--- TRUNCATED ---</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Locate the <code>service.yaml</code> string and change the <code>type</code> to <code>NodePort</code> as follows:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>  service.yaml: |
    apiVersion: v1
    kind: Service
    spec:
      # NodePort is required for the ALB to route to the Service
      type: NodePort
--- TRUNCATED ---</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Replace the default images with the images that are pulled from the Red Hat Ecosystem:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>sed -i "s#gcr.io/kubebuilder/kube-rbac-proxy:.*#registry.redhat.io/openshift4/ose-kube-rbac-proxy:v4.15#g" rhdh-operator-*.yaml

sed -i "s#quay.io/janus-idp/operator:.*#registry.redhat.io/rhdh/rhdh-rhel9-operator:1.1#g" rhdh-operator-*.yaml

sed -i "s#quay.io/janus-idp/backstage-showcase:.*#registry.redhat.io/rhdh/rhdh-hub-rhel9:1.1#g" rhdh-operator-*.yaml

sed -i "s#quay.io/fedora/postgresql-15:.*#registry.redhat.io/rhel9/postgresql-15:latest#g" rhdh-operator-*.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Add the image pull secret to the manifest in the Deployment resource as follows:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">--- TRUNCATED ---

apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: manager
    app.kubernetes.io/created-by: rhdh-operator
    app.kubernetes.io/instance: controller-manager
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: deployment
    app.kubernetes.io/part-of: rhdh-operator
    control-plane: controller-manager
  name: rhdh-controller-manager
  namespace: rhdh-operator
spec:
  replicas: 1
  selector:
    matchLabels:
      control-plane: controller-manager
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/default-container: manager
      labels:
        control-plane: controller-manager
    spec:
      imagePullSecrets:
        - name: rhdh-pull-secret
--- TRUNCATED ---</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Apply the manifest to deploy the operator using the following command:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl apply -f rhdh-operator-VERSION.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Run the following command to verify that the Operator is running:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl -n rhdh-operator get pods -w</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_installing-the-developer-hub-instance-in-eks">8.2.3. Installing the Developer Hub instance in EKS</h4>
<div class="paragraph">
<p>After the Red Hat Developer Hub Operator is installed and running, you can create a Developer Hub instance in EKS.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have an EKS cluster with AWS Application Load Balancer (ALB) add-on installed. For more information, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/alb-ingress.html">Application load balancing on Amazon Elastic Kubernetes Service</a> and <a href="https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html">Installing the AWS Load Balancer Controller add-on</a>.</p>
</li>
<li>
<p>You have configured a domain name for your Developer Hub instance. The domain name can be a hosted zone entry on Route 53 or managed outside of AWS. For more information, see <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/dns-configuring.html">Configuring Amazon Route 53 as your DNS service</a> documentation.</p>
</li>
<li>
<p>You have an entry in the AWS Certificate Manager (ACM) for your preferred domain name. Make sure to keep a record of your Certificate ARN.</p>
</li>
<li>
<p>You have subscribed to <code>registry.redhat.io</code>. For more information, see <a href="https://access.redhat.com/RegistryAuthentication">Red Hat Container Registry Authentication</a>.</p>
</li>
<li>
<p>You have set the context to the EKS cluster in your current <code>kubeconfig</code>. For more information, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/create-kubeconfig.html">Creating or updating a kubeconfig file for an Amazon {eks} cluster</a>.</p>
</li>
<li>
<p>You have installed <code>kubectl</code>. For more information, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html">Installing or updating kubectl</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a ConfigMap named <code>app-config-rhdh</code> containing the Developer Hub configuration using the following template:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-rhdh
data:
  "app-config-rhdh.yaml": |
    app:
      title: Red Hat Developer Hub
      baseUrl: https://&lt;rhdh_dns_name&gt;
    backend:
      auth:
        keys:
          - secret: "${BACKEND_SECRET}"
      baseUrl: https://&lt;rhdh_dns_name&gt;
      cors:
        origin: https://&lt;rhdh_dns_name&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create a Secret named <code>secrets-rhdh</code> and add a key named <code>BACKEND_SECRET</code> with a <code>Base64-encoded</code> string as value:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: secrets-rhdh
stringData:
  # TODO: See https://backstage.io/docs/auth/service-to-service-auth/#setup
  BACKEND_SECRET: "xxx"</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that you use a unique value of <code>BACKEND_SECRET</code> for each Developer Hub instance.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use the following command to generate a key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>node-p'require("crypto").randomBytes(24).toString("base64")'</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>To enable pulling the PostgreSQL image from the Red Hat Ecosystem Catalog, add the image pull secret in the default service account within the namespace where the Developer Hub instance is being deployed:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl patch serviceaccount default \
    -p '{"imagePullSecrets": [{"name": "rhdh-pull-secret"}]}' \
    -n &lt;your_namespace&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create a Custom Resource file using the following template:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: rhdh.redhat.com/v1alpha1
kind: Backstage
metadata:
 # TODO: this the name of your Developer Hub instance
  name: my-rhdh
spec:
  application:
    imagePullSecrets:
    - "rhdh-pull-secret"
    route:
      enabled: false
    appConfig:
      configMaps:
        - name: "app-config-rhdh"
    extraEnvs:
      secrets:
        - name: "secrets-rhdh"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create an Ingress resource using the following template, ensuring to customize the names as needed:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  # TODO: this the name of your Developer Hub Ingress
  name: my-rhdh
  annotations:
    alb.ingress.kubernetes.io/scheme: internet-facing

    alb.ingress.kubernetes.io/target-type: ip

    # TODO: Using an ALB HTTPS Listener requires a certificate for your own domain. Fill in the ARN of your certificate, e.g.:
    alb.ingress.kubernetes.io/certificate-arn: arn:aws:acm:us-xxx:xxxx:certificate/xxxxxx

     alb.ingress.kubernetes.io/listen-ports: '[{"HTTP": 80}, {"HTTPS":443}]'

    alb.ingress.kubernetes.io/ssl-redirect: '443'

    # TODO: Set your application domain name.
    external-dns.alpha.kubernetes.io/hostname: &lt;rhdh_dns_name&gt;

spec:
  ingressClassName: alb
  rules:
    # TODO: Set your application domain name.
    - host: &lt;rhdh_dns_name&gt;
      http:
        paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              # TODO: my-rhdh is the name of your Backstage Custom Resource.
              # Adjust if you changed it!
              name: backstage-my-rhdh
              port:
                name: http-backend</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous template, replace ` &lt;rhdh_dns_name&gt;` with your Developer Hub domain name and update the value of <code>alb.ingress.kubernetes.io/certificate-arn</code> with your certificate ARN.</p>
</div>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Wait until the DNS name is responsive, indicating that your Developer Hub instance is ready for use.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-rhdh-monitoring-logging-aws_assembly-rhdh-observability">8.3. Monitoring and logging with Amazon Web Services (AWS) in Red Hat Developer Hub</h3>
<div class="paragraph">
<p>In the Red Hat Developer Hub, monitoring and logging are facilitated through Amazon Web Services (AWS) integration. With features like Amazon CloudWatch for real-time monitoring and Amazon Prometheus for comprehensive logging, you can ensure the reliability, scalability, and compliance of your Developer Hub application hosted on AWS infrastructure.</p>
</div>
<div class="paragraph">
<p>This integration enables you to oversee, diagnose, and refine your applications in the Red Hat ecosystem, leading to an improved development and operational journey.</p>
</div>
<div class="sect3">
<h4 id="_monitoring-with-amazon-prometheus">8.3.1. Monitoring with Amazon Prometheus</h4>
<div class="paragraph">
<p>Red Hat Developer Hub provides Prometheus metrics related to the running application. For more information about enabling or deploying Prometheus for EKS clusters, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/prometheus.html">Prometheus metrics</a> in the Amazon documentation.</p>
</div>
<div class="paragraph">
<p>To monitor Developer Hub using <a href="https://aws.amazon.com/prometheus/">Amazon Prometheus</a>, you need to create an Amazon managed service for the Prometheus workspace and configure the ingestion of the Developer Hub Prometheus metrics. For more information, see <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-onboard-create-workspace.html">Create a workspace</a> and <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-onboard-ingest-metrics.html">Ingest Prometheus metrics to the workspace</a> sections in the Amazon documentation.</p>
</div>
<div class="paragraph">
<p>After ingesting Prometheus metrics into the created workspace, you can configure the metrics scraping to extract data from pods based on specific pod annotations.</p>
</div>
<div class="sect4">
<h5 id="_configuring-annotations-for-monitoring">Configuring annotations for monitoring</h5>
<div class="paragraph">
<p>You can configure the annotations for monitoring in both Helm deployment and Operator-backed deployment.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Helm deployment</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To annotate the backstage pod for monitoring, update your <code>values.yaml</code> file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">upstream:
  backstage:
    # --- TRUNCATED ---
    podAnnotations:
      prometheus.io/scrape: 'true'
      prometheus.io/path: '/metrics'
      prometheus.io/port: '7007'
      prometheus.io/scheme: 'http'</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Operator-backed deployment</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>As an administrator of the operator, edit the default configuration to add Prometheus annotations as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Update OPERATOR_NS accordingly
OPERATOR_NS=rhdh-operator
kubectl edit configmap backstage-default-config -n "${OPERATOR_NS}"</code></pre>
</div>
</div>
</li>
<li>
<p>Find the <code>deployment.yaml</code> key in the ConfigMap and add the annotations to the <code>spec.template.metadata.annotations</code> field as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">deployment.yaml: |-
  apiVersion: apps/v1
  kind: Deployment
  # --- truncated ---
  spec:
    template:
      # --- truncated ---
      metadata:
        labels:
         rhdh.redhat.com/app:  # placeholder for 'backstage-&lt;cr-name&gt;'
        # --- truncated ---
        annotations:
          prometheus.io/scrape: 'true'
          prometheus.io/path: '/metrics'
          prometheus.io/port: '7007'
          prometheus.io/scheme: 'http'
  # --- truncated ---</code></pre>
</div>
</div>
</li>
<li>
<p>Save your changes.</p>
</li>
</ol>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>To verify if the scraping works:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use <code>kubectl</code> to port-forward the Prometheus console to your local machine as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl --namespace=prometheus port-forward deploy/prometheus-server 9090</code></pre>
</div>
</div>
</li>
<li>
<p>Open your web browser and navigate to <code>http://localhost:9090</code> to access the Prometheus console.</p>
</li>
<li>
<p>Monitor relevant metrics, such as <code>process_cpu_user_seconds_total</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_logging-with-amazon-cloudwatch-logs">8.3.2. Logging with Amazon CloudWatch logs</h4>
<div class="paragraph">
<p>Logging within the Red Hat Developer Hub relies on the <a href="https://github.com/winstonjs/winston">winston library</a>. By default, logs at the debug level are not recorded. To activate debug logs, you must set the environment variable <code>LOG_LEVEL</code> to debug in your Red Hat Developer Hub instance.</p>
</div>
<div class="sect4">
<h5 id="_configuring-the-application-log-level">Configuring the application log level</h5>
<div class="paragraph">
<p>You can configure the application log level in both Helm deployment and Operator-backed deployment.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Helm deployment</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>To update the logging level, add the environment variable <code>LOG_LEVEL</code> to your Helm chart&#8217;s <code>values.yaml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">upstream:
  backstage:
    # --- Truncated ---
    extraEnvVars:
      - name: LOG_LEVEL
        value: debug</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Operator-backed deployment</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You can modify the logging level by including the environment variable <code>LOG_LEVEL</code> in your custom resource as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spec:
  # Other fields omitted
  application:
    extraEnvs:
      envs:
        - name: LOG_LEVEL
          value: debug</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_retrieving-logs-from-amazon-cloudwatch">Retrieving logs from Amazon CloudWatch</h5>
<div class="paragraph">
<p>The CloudWatch Container Insights are used to capture logs and metrics for Amazon EKS. For more information, see <a href="https://docs.aws.amazon.com/prescriptive-guidance/latest/implementing-logging-monitoring-cloudwatch/kubernetes-eks-logging.html">Logging for Amazon EKS</a> documentation.</p>
</div>
<div class="paragraph">
<p>To capture the logs and metrics, <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/Container-Insights-setup-EKS-addon.html">install the Amazon CloudWatch Observability EKS add-on</a> in your cluster. Following the setup of Container Insights, you can access container logs using Logs Insights or Live Tail views.</p>
</div>
<div class="paragraph">
<p>CloudWatch names the log group where all container logs are consolidated in the following manner:</p>
</div>
<div class="paragraph">
<p><code>/aws/containerinsights/&lt;ClusterName&gt;/application</code></p>
</div>
<div class="paragraph">
<p>Following is an example query to retrieve logs from the Developer Hub instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">fields @timestamp, @message, kubernetes.container_name
| filter kubernetes.container_name in ["install-dynamic-plugins", "backstage-backend"]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-using-aws-cognito-auth-provider_assembly-rhdh-observability">8.4. Using Amazon Cognito as an authentication provider in Red Hat Developer Hub</h3>
<div class="paragraph">
<p>In this section, Amazon Cognito is an AWS service for adding an authentication layer to Developer Hub. You can sign in directly to the Developer Hub using a user pool or fedarate through a third-party identity provider.</p>
</div>
<div class="paragraph">
<p>Although Amazon Cognito is not part of the core authentication providers for the Developer Hub, it can be integrated using the generic OpenID Connect (OIDC) provider.</p>
</div>
<div class="paragraph">
<p>You can configure your Developer Hub in both Helm Chart and Operator-backed deployments.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have a User Pool or you have created a new one. For more information about user pools, see <a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-identity-pools.html?icmpid=docs_cognito_console_help_panel">Amazon Cognito user pools</a> documentation.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that you have noted the AWS region where the user pool is located and the user pool ID.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You have created an App Client within your user pool for integrating the hosted UI. For more information, see <a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-integration.html#cognito-user-pools-create-an-app-integration">Setting up the hosted UI with the Amazon Cognito console</a>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>When setting up the hosted UI using the Amazon Cognito console, ensure to make the following adjustments:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Allowed callback URL(s)</strong> section, include the URL <code>https://&lt;rhdh_url&gt;/api/auth/oidc/handler/frame</code>. Ensure to replace <code>&lt;rhdh_url&gt;</code> with your Developer Hub application&#8217;s URL, such as, <code>my.rhdh.example.com</code>.</p>
</li>
<li>
<p>Similarly, in the <strong>Allowed sign-out URL(s)</strong> section, add <code>https://&lt;rhdh_url&gt;</code>. Replace <code>&lt;rhdh_url&gt;</code> with your Developer Hub application&#8217;s URL, such as <code>my.rhdh.example.com</code>.</p>
</li>
<li>
<p>Under <strong>OAuth 2.0 grant types</strong>, select <strong>Authorization code grant</strong> to return an authorization code.</p>
</li>
<li>
<p>Under <strong>OpenID Connect scopes</strong>, ensure to select at least the following scopes:</p>
<div class="ulist">
<ul>
<li>
<p>OpenID</p>
</li>
<li>
<p>Profile</p>
</li>
<li>
<p>Email</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Helm deployment</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit or create your custom <code>app-config-rhdh</code> ConfigMap as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-rhdh
data:
  "app-config-rhdh.yaml": |
    # --- Truncated ---
    app:
      title: Red Hat Developer Hub

    signInPage: oidc
    auth:
      environment: production
      session:
        secret: ${AUTH_SESSION_SECRET}
      providers:
        oidc:
          production:
            clientId: ${AWS_COGNITO_APP_CLIENT_ID}
            clientSecret: ${AWS_COGNITO_APP_CLIENT_SECRET}
            metadataUrl: ${AWS_COGNITO_APP_METADATA_URL}
            callbackUrl: ${AWS_COGNITO_APP_CALLBACK_URL}
            scope: 'openid profile email'
            prompt: auto</code></pre>
</div>
</div>
</li>
<li>
<p>Edit or create your custom <code>secrets-rhdh</code> Secret using the following template:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: secrets-rhdh
stringData:
  AUTH_SESSION_SECRET: "my super auth session secret - change me!!!"
  AWS_COGNITO_APP_CLIENT_ID: "my-aws-cognito-app-client-id"
  AWS_COGNITO_APP_CLIENT_SECRET: "my-aws-cognito-app-client-secret"
  AWS_COGNITO_APP_METADATA_URL: "https://cognito-idp.[region].amazonaws.com/[userPoolId]/.well-known/openid-configuration"
  AWS_COGNITO_APP_CALLBACK_URL: "https://[rhdh_dns]/api/auth/oidc/handler/frame"</code></pre>
</div>
</div>
</li>
<li>
<p>Add references of both the ConfigMap and Secret resources in your <code>values.yaml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">upstream:
  backstage:
    image:
      pullSecrets:
      - rhdh-pull-secret
    podSecurityContext:
      fsGroup: 2000
    extraAppConfig:
      - filename: app-config-rhdh.yaml
        configMapRef: app-config-rhdh
    extraEnvVarsSecrets:
      - secrets-rhdh</code></pre>
</div>
</div>
</li>
<li>
<p>Upgrade the Helm deployment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>helm upgrade rhdh \
  openshift-helm-charts/redhat-developer-hub \
  [--version 1.2.0] \
  --values /path/to/values.yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Operator-backed deployment</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the following code to your <code>app-config-rhdh</code> ConfigMap:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-rhdh
data:
  "app-config-rhdh.yaml": |
    # --- Truncated ---

    signInPage: oidc
    auth:
      # Production to disable guest user login
      environment: production
      # Providing an auth.session.secret is needed because the oidc provider requires session support.
      session:
        secret: ${AUTH_SESSION_SECRET}
      providers:
        oidc:
          production:
            # See https://github.com/backstage/backstage/blob/master/plugins/auth-backend-module-oidc-provider/config.d.ts
            clientId: ${AWS_COGNITO_APP_CLIENT_ID}
            clientSecret: ${AWS_COGNITO_APP_CLIENT_SECRET}
            metadataUrl: ${AWS_COGNITO_APP_METADATA_URL}
            callbackUrl: ${AWS_COGNITO_APP_CALLBACK_URL}
            # Minimal set of scopes needed. Feel free to add more if needed.
            scope: 'openid profile email'

            # Note that by default, this provider will use the 'none' prompt which assumes that your are already logged on in the IDP.
            # You should set prompt to:
            # - auto: will let the IDP decide if you need to log on or if you can skip login when you have an active SSO session
            # - login: will force the IDP to always present a login form to the user
            prompt: auto</code></pre>
</div>
</div>
</li>
<li>
<p>Add the following code to your <code>secrets-rhdh</code> Secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: secrets-rhdh
stringData:
  # --- Truncated ---

  # TODO: Change auth session secret.
  AUTH_SESSION_SECRET: "my super auth session secret - change me!!!"

  # TODO: user pool app client ID
  AWS_COGNITO_APP_CLIENT_ID: "my-aws-cognito-app-client-id"

  # TODO: user pool app client Secret
  AWS_COGNITO_APP_CLIENT_SECRET: "my-aws-cognito-app-client-secret"

  # TODO: Replace region and user pool ID
  AWS_COGNITO_APP_METADATA_URL: "https://cognito-idp.[region].amazonaws.com/[userPoolId]/.well-known/openid-configuration"

  # TODO: Replace &lt;rhdh_dns&gt;
  AWS_COGNITO_APP_CALLBACK_URL: "https://[rhdh_dns]/api/auth/oidc/handler/frame"</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure your Custom Resource contains references to both the <code>app-config-rhdh</code> ConfigMap and <code>secrets-rhdh</code> Secret:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: rhdh.redhat.com/v1alpha1
kind: Backstage
metadata:
 # TODO: this the name of your Developer Hub instance
  name: my-rhdh
spec:
  application:
    imagePullSecrets:
    - "rhdh-pull-secret"
    route:
      enabled: false
    appConfig:
      configMaps:
        - name: "app-config-rhdh"
    extraEnvs:
      secrets:
        - name: "secrets-rhdh"</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: If you have an existing Developer Hub instance backed by the Custom Resource and you have not edited it, you can manually delete the Developer Hub deployment to recreate it using the operator. Run the following command to delete the Developer Hub deployment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl delete deployment -l app.kubernetes.io/instance=&lt;CR_NAME&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Navigate to your Developer Hub web URL and sign in using OIDC authentication, which prompts you to authenticate through the configured AWS Cognito user pool.</p>
</li>
<li>
<p>Once logged in, access <strong>Settings</strong> and verify user details.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-rhdh-integration-aks_assembly-rhdh-observability">9. Red Hat Developer Hub integration with Microsoft Azure Kubernetes Service (AKS)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can integrate Developer Hub with Microsoft Azure Kubernetes Service (AKS), which provides a significant advancement in development, offering a streamlined environment for building, deploying, and managing your applications.</p>
</div>
<div class="paragraph">
<p>This integration requires the deployment of Developer Hub on AKS using one of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Helm chart</p>
</li>
<li>
<p>The Red Hat Developer Hub Operator</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="proc-rhdh-deploy-aks_assembly-rhdh-observability">9.1. Deploying Red Hat Developer Hub on Azure Kubernetes Service (AKS)</h3>
<div class="paragraph">
<p>You can deploy your Developer Hub application on Azure Kubernetes Services (AKS) to access a comprehensive solution for building, testing, and deploying applications.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have an Azure account with active subscription.</p>
</li>
<li>
<p>You have installed Azure CLI in your machine and configured the Resource Group and Cluster. For more information, see <a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli">How to install the Azure CLI</a>.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>You can perform the following steps to configure the Resource Group and Cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To access Azure, ensuring you&#8217;re logged in to our designated tenant use the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>az login [--tenant=&lt;optional-directory-name&gt;]</code></pre>
</div>
</div>
</li>
<li>
<p>To create a Resource Group, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>az group create --name &lt;your_ResourceGroup&gt; --location &lt;location&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>you can retrieve available regions using <code>az account list-locations -o table</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create an AKS cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>az aks create \
--resource-group &lt;your_ResourceGroup&gt; \
--name &lt;your_ClusterName&gt; \
--enable-managed-identity \
--generate-ssh-keys</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can refer to <code>--help</code> for additional options.</p>
</div>
</li>
<li>
<p>Connect to your cluster:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>az aks get-credentials --resource-group &lt;your_ResourceGroup&gt; --name &lt;your_ClusterName&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous command configures the Kubernetes client and sets the current context in the <code>kubeconfig</code> to point to your AKS cluster.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>You have installed <code>kubectl</code>. For more information, see <a href="https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html">Installing or updating kubectl</a>.</p>
</li>
<li>
<p>You have installed Helm 3 or the latest.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Comparison of AKS specifics with the base Developer Hub deployment</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>Permissions issue</strong>: Developer Hub containers might encounter permission-related errors, such as <code>Permission denied</code> when attempting certain operations. This error can be addresssed by adjusting the <code>fsGroup</code> in the <code>PodSpec.securityContext</code>.</p>
</li>
<li>
<p><strong>Ingress configuration</strong>: In AKS, configuring ingress is essential for accessing the installed Developer Hub instance. Accessing the Developer Hub instance requires enabling the Routing add-on, an NGINX-based Ingress Controller, using the following commands:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>az aks approuting enable --resource-group &lt;your_ResourceGroup&gt; --name &lt;your_ClusterName&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>You might need to install the Azure CLI extension <code>aks-preview</code>. If the extension is not installed automatically, you might need to install it manually using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>az extension add --upgrade -n aks-preview --allow-preview true</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>After you install the Ingress Controller, the 'app-routing-system' namespace with the Ingress Controller will be deployed in your cluster. Note the address of your Developer Hub application from the installed Ingress Controller (for example, 108.141.70.228) for later access to the Developer Hub application, later referenced as <code>&lt;app_address&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl get svc nginx --namespace app-routing-system -o jsonpath='{.status.loadBalancer.ingress[0].ip}'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Namespace management</strong>: You can create a dedicated namespace for Developer Hub deployment in AKS using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create namespace &lt;your_namespace&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="proc-rhdh-deploy-aks-using-helm_assembly-rhdh-observability">9.1.1. Deploying the Red Hat Developer Hub on Azure Kubernetes Service (AKS) using the Helm chart</h4>
<div class="paragraph">
<p>You can deploy your Developer Hub on AKS using Helm.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open terminal and run the following command to add the Helm chart repository:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>helm repo add openshift-helm-charts https://charts.openshift.io/</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>To create <code>ImagePull Secret</code>, run the following command:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl -n &lt;your_namespace&gt; create secret docker-registry rhdh-pull-secret \
    --docker-server=registry.redhat.io \
    --docker-username=&lt;redhat_user_name&gt; \
    --docker-password=&lt;redhat_password&gt; \
    --docker-email=&lt;email&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create a file named <code>values.yaml</code> using the following template:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">global:
  host: &lt;app_address&gt;
route:
  enabled: false
upstream:
  ingress:
    enabled: true
    className: webapprouting.kubernetes.azure.com
    host:
  backstage:
    image:
      pullSecrets:
        - rhdh-pull-secret
    podSecurityContext:
      fsGroup: 3000
  postgresql:
    image:
      pullSecrets:
        - rhdh-pull-secret
    primary:
      podSecurityContext:
        enabled: true
        fsGroup: 3000
  volumePermissions:
    enabled: true</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>To install Helm Chart, run the following command:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>helm -n &lt;your_namespace&gt; install -f values.yaml &lt;your_deploy_name&gt; openshift-helm-charts/redhat-developer-hub --version 1.1.1</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Verify the deployment status:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl get deploy &lt;your_deploy_name&gt;-developer-hub -n &lt;your_namespace&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Access the deployed Developer Hub using the URL: <code><a href="https://&lt;app_address&gt" class="bare">https://&lt;app_address&gt</a>;</code>, where &lt;app_address&gt; is the Ingress address obtained earlier (for example, <code><a href="https://108.141.70.228" class="bare">https://108.141.70.228</a></code>).</p>
</li>
<li>
<p>To upgrade or delete the deployment, run the following command:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Upgrade command</div>
<div class="content">
<pre class="highlight"><code>helm -n &lt;your_namespace&gt; upgrade -f values.yaml &lt;your_deploy_name&gt; openshift-helm-charts/redhat-developer-hub --version 1.1.1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Delete command</div>
<div class="content">
<pre class="highlight"><code>helm -n &lt;your_namespace&gt; delete &lt;your_deploy_name&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-rhdh-deploy-aks-using-operator_assembly-rhdh-observability">9.1.2. Deploying the Red Hat Developer Hub on Azure Kubernetes Service (AKS) using the Operator</h4>
<div class="paragraph">
<p>You can deploy your Developer Hub on AKS using the Red Hat Developer Hub Operator.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Obtain the Red Hat Developer Hub Operator manifest file, named <code>rhdh-operator-&lt;VERSION&gt;.yaml</code>, and modify the default configuration of <code>db-statefulset.yaml</code> and <code>deployment.yaml</code> by adding the following fragment:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">securityContext:
  fsGroup: 300</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following is the specified locations in the manifests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>db-statefulset.yaml: | spec.template.spec
deployment.yaml: | spec.template.spec</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Apply the modified Operator manifest to your Kubernetes cluster:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl apply -f rhdh-operator-&lt;VERSION&gt;.yaml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Execution of the previous command is cluster-scoped and requires appropriate cluster privileges.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Create an <code>ImagePull Secret</code> named <code>rhdh-pull-secret</code> using your Red Hat credentials to access images from the protected <code>registry.redhat.io</code> as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl -n &lt;your_namespace&gt; create secret docker-registry rhdh-pull-secret \
    --docker-server=registry.redhat.io \
    --docker-username=&lt;redhat_user_name&gt; \
    --docker-password=&lt;redhat_password&gt; \
    --docker-email=&lt;email&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create an Ingress manifest file, named <code>rhdh-ingress.yaml</code>, specifying your Developer Hub service name as follows:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: rhdh-ingress
  namespace: &lt;your_namespace&gt;
spec:
  ingressClassName: webapprouting.kubernetes.azure.com
  rules:
    - http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: backstage-&lt;your-CR-name&gt;
                port:
                  name: http-backend</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>To deploy the created Ingress, run the following command:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl -n &lt;your_namespace&gt; apply -f rhdh-ingress.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create a ConfigMap named <code>app-config-rhdh</code> containing the Developer Hub configuration using the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config-rhdh
data:
  "app-config-rhdh.yaml": |
    app:
      title: Red Hat Developer Hub
      baseUrl: https://&lt;app_address&gt;
    backend:
      auth:
        keys:
          - secret: "${BACKEND_SECRET}"
      baseUrl: https://&lt;app_address&gt;
      cors:
        origin: https://&lt;app_address&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create a Secret named <code>secrets-rhdh</code> and add a key named <code>BACKEND_SECRET</code> with a <code>Base64-encoded</code> string value as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: secrets-rhdh
stringData:
  BACKEND_SECRET: "xxx"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create a Custom Resource (CR) manifest file named <code>rhdh.yaml</code> and include the previously created <code>rhdh-pull-secret</code> as follows:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: rhdh.redhat.com/v1alpha1
kind: Backstage
metadata:
  name: &lt;your-rhdh-cr&gt;
spec:
  application:
    imagePullSecrets:
      - rhdh-pull-secret
    appConfig:
      configMaps:
        - name: "app-config-rhdh"
    extraEnvs:
      secrets:
        - name: "secrets-rhdh"</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Apply the CR manifest to your namespace:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl -n &lt;your_namespace&gt; apply -f rhdh.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Access the deployed Developer Hub using the URL: <code><a href="https://&lt;app_address&gt" class="bare">https://&lt;app_address&gt</a>;</code>, where &lt;app_address&gt; is the Ingress address obtained earlier (for example, <code><a href="https://108.141.70.228" class="bare">https://108.141.70.228</a></code>).</p>
</li>
<li>
<p>Optional: To delete the CR, run the following command:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kubectl -n &lt;your_namespace&gt; delete -f rhdh.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-rhdh-monitoring-logging-aks_assembly-rhdh-observability">9.2. Monitoring and logging with Azure Kubernetes Services (AKS) in Red Hat Developer Hub</h3>
<div class="paragraph">
<p>Monitoring and logging are integral aspects of managing and maintaining Azure Kubernetes Services (AKS) in Red Hat Developer Hub. With features like Managed Prometheus Monitoring and Azure Monitor integration, administrators can efficiently monitor resource utilization, diagnose issues, and ensure the reliability of their containerized workloads.</p>
</div>
<div class="paragraph">
<p>To enable Managed Prometheus Monitoring, use the <code>-enable-azure-monitor-metrics</code> option within either the <code>az aks create</code> or <code>az aks update</code> command, depending on whether you&#8217;re creating a new cluster or updating an existing one, such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">az aks create/update --resource-group &lt;your-ResourceGroup&gt; --name &lt;your-Cluster&gt; --enable-azure-monitor-metrics</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous command installs the metrics add-on, which gathers <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/prometheus-metrics-overview">Prometheus metrics</a>. Using the previous command, you can enable monitoring of Azure resources through both native Azure Monitor metrics and Prometheus metrics. You can also view the results in the portal under <strong>Monitoring &#8594; Insights</strong>. For more information, see <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/monitor-azure-resource">Monitor Azure resources with Azure Monitor</a>.</p>
</div>
<div class="paragraph">
<p>Furthermore, metrics from both the Managed Prometheus service and Azure Monitor can be accessed through Azure Managed Grafana service. For more information, see <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/azure-monitor-workspace-manage?tabs=azure-portal#link-a-grafana-workspace">Link a Grafana workspace</a> section.</p>
</div>
<div class="paragraph">
<p>By default, Prometheus uses the minimum ingesting profile, which optimizes ingestion volume and sets default configurations for scrape frequency, targets, and metrics collected. The default settings can be customized through custom configuration. Azure offers various methods, including using different ConfigMaps, to provide scrape configuration and other metric add-on settings. For more information about default configuration, see <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/containers/prometheus-metrics-scrape-default">Default Prometheus metrics configuration in Azure Monitor</a> and <a href="https://learn.microsoft.com/en-us/azure/azure-monitor/containers/prometheus-metrics-scrape-configuration?tabs=CRDConfig%2CCRDScrapeConfig">Customize scraping of Prometheus metrics in Azure Monitor managed service for Prometheus</a> documentation.</p>
</div>
<div class="sect3">
<h4 id="_viewing-logs-with-azure-kubernetes-services-aks">9.2.1. Viewing logs with Azure Kubernetes Services (AKS)</h4>
<div class="paragraph">
<p>You can access live data logs generated by Kubernetes objects and collect log data in Container Insights within AKS.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have deployed Developer Hub on AKS. For more information, see <a href="#proc-rhdh-deploy-aks_admin-rhdh">[proc-rhdh-deploy-aks_admin-rhdh]</a>.</p>
</li>
</ul>
</div>
<div class="dlist">
<div class="title">Procedure</div>
<dl>
<dt class="hdlist1">View live logs from your Developer Hub instance</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the Azure Portal.</p>
</li>
<li>
<p>Search for the resource group <code>&lt;your-ResourceGroup&gt;</code> and locate your AKS cluster <code>&lt;your-Cluster&gt;</code>.</p>
</li>
<li>
<p>Select <strong>Kubernetes resources &#8594; Workloads</strong> from the menu.</p>
</li>
<li>
<p>Select the <code>&lt;your-rhdh-cr&gt;-developer-hub</code> (in case of Helm Chart installation) or <code>&lt;your-rhdh-cr&gt;-backstage</code> (in case of Operator-backed installation) deployment.</p>
</li>
<li>
<p>Click <strong>Live Logs</strong> in the left menu.</p>
</li>
<li>
<p>Select the pod.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
There must be only single pod.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Live log data is collected and displayed.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">View real-time log data from the Container Engine</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the Azure Portal.</p>
</li>
<li>
<p>Search for the resource group <code>&lt;your-ResourceGroup&gt;</code> and locate your AKS cluster <code>&lt;your-Cluster&gt;</code>.</p>
</li>
<li>
<p>Select <strong>Monitoring</strong> &#8594; <strong>Insights</strong> from the menu.</p>
</li>
<li>
<p>Go to the <strong>Containers</strong> tab.</p>
</li>
<li>
<p>Find the backend-backstage container and click it to view real-time log data as it&#8217;s generated by the Container Engine.</p>
</li>
</ol>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-using-azure-auth-provider_assembly-rhdh-observability">9.3. Using Microsoft Azure as an authentication provider in Red Hat Developer Hub</h3>
<div class="paragraph">
<p>The <code>core-plugin-api</code> package in Developer Hub comes integrated with Microsoft Azure authentication provider, authenticating signing in using Azure OAuth.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have deployed Developer Hub on AKS. For more information, see <a href="#proc-rhdh-deploy-aks_admin-rhdh">[proc-rhdh-deploy-aks_admin-rhdh]</a>.</p>
</li>
<li>
<p>You have created registered your application in Azure portal. For more information, see <a href="https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-register-app">Register an application with the Microsoft identity platform</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_using-microsoft-azure-as-an-authentication-provider-in-helm-deployment">9.3.1. Using Microsoft Azure as an authentication provider in Helm deployment</h4>
<div class="paragraph">
<p>You can use Microsoft Azure as an authentication provider in Red Hat Developer Hub, when installed using the Helm Chart. For more information, see <a href="#proc-rhdh-deploy-aks-using-helm_admin-rhdh">[proc-rhdh-deploy-aks-using-helm_admin-rhdh]</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>After the application is registered, note down the following:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>clientId</code>: Application (client) ID, found under App <strong>Registration &#8594; Overview</strong>.</p>
</li>
<li>
<p><code>clientSecret</code>: Secret, found under *App Registration &#8594; Certificates &amp; secrets (create new if needed).</p>
</li>
<li>
<p><code>tenantId</code>: Directory (tenant) ID, found under <strong>App Registration &#8594; Overview</strong>.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Ensure the following fragment is included in your Developer Hub ConfigMap:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">auth:
  environment: production
  providers:
    microsoft:
      production:
        clientId: ${AZURE_CLIENT_ID}
        clientSecret: ${AZURE_CLIENT_SECRET}
        tenantId: ${AZURE_TENANT_ID}
        domainHint: ${AZURE_TENANT_ID}
        additionalScopes:
          - Mail.Send</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can either create a new file or add it to an existing one.</p>
</div>
</div>
</div>
</li>
<li>
<p>Apply the ConfigMap to your Kubernetes cluster:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl -n &lt;your_namespace&gt; apply -f &lt;app-config&gt;.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create or reuse an existing Secret containing Azure credentials and add the following fragment:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">stringData:
  AZURE_CLIENT_ID: &lt;value-of-clientId&gt;
  AZURE_CLIENT_SECRET: &lt;value-of-clientSecret&gt;
  AZURE_TENANT_ID: &lt;value-of-tenantId&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Apply the secret to your Kubernetes cluster:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl -n &lt;your_namespace&gt; apply -f &lt;azure-secrets&gt;.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Ensure your <code>values.yaml</code> file references the previously created ConfigMap and Secret:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">upstream:
  backstage:
  ...
    extraAppConfig:
      - filename: ...
        configMapRef: &lt;app-config-containing-azure&gt;
    extraEnvVarsSecrets:
      - &lt;secret-containing-azure&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Optional: If the Helm Chart is already installed, upgrade it:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>helm -n &lt;your_namespace&gt; upgrade -f &lt;your-values.yaml&gt; &lt;your_deploy_name&gt; redhat-developer/backstage --version 1.2.0</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Optional: If your <code>rhdh.yaml</code> file is not changed, for example, you only updated the ConfigMap and Secret referenced from it, refresh your Developer Hub deployment by removing the corresponding pods:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl -n &lt;your_namespace&gt; delete pods -l backstage.io/app=backstage-&lt;your-rhdh-cr&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_using-microsoft-azure-as-an-authentication-provider-in-operator-backed-deployment">9.3.2. Using Microsoft Azure as an authentication provider in Operator-backed deployment</h4>
<div class="paragraph">
<p>You can use Microsoft Azure as an authentication provider in Red Hat Developer Hub, when installed using the Operator. For more information, see <a href="#proc-install-rhdh-ocp-operator_admin-rhdh">Deploying Red Hat Developer Hub on OpenShift Container Platform using the Operator</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>After the application is registered, note down the following:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><code>clientId</code>: Application (client) ID, found under App <strong>Registration &#8594; Overview</strong>.</p>
</li>
<li>
<p><code>clientSecret</code>: Secret, found under *App Registration &#8594; Certificates &amp; secrets (create new if needed).</p>
</li>
<li>
<p><code>tenantId</code>: Directory (tenant) ID, found under <strong>App Registration &#8594; Overview</strong>.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Ensure the following fragment is included in your Developer Hub ConfigMap:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">auth:
  environment: production
  providers:
    microsoft:
      production:
        clientId: ${AZURE_CLIENT_ID}
        clientSecret: ${AZURE_CLIENT_SECRET}
        tenantId: ${AZURE_TENANT_ID}
        domainHint: ${AZURE_TENANT_ID}
        additionalScopes:
          - Mail.Send</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can either create a new file or add it to an existing one.</p>
</div>
</div>
</div>
</li>
<li>
<p>Apply the ConfigMap to your Kubernetes cluster:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl -n &lt;your_namespace&gt; apply -f &lt;app-config&gt;.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Create or reuse an existing Secret containing Azure credentials and add the following fragment:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">stringData:
  AZURE_CLIENT_ID: &lt;value-of-clientId&gt;
  AZURE_CLIENT_SECRET: &lt;value-of-clientSecret&gt;
  AZURE_TENANT_ID: &lt;value-of-tenantId&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Apply the secret to your Kubernetes cluster:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl -n &lt;your_namespace&gt; apply -f &lt;azure-secrets&gt;.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Ensure your Custom Resource manifest contains references to the previously created ConfigMap and Secret:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: rhdh.redhat.com/v1alpha1
kind: Backstage
metadata:
  name: &lt;your-rhdh-cr&gt;
spec:
  application:
    imagePullSecrets:
    - rhdh-pull-secret
    route:
      enabled: false
    appConfig:
      configMaps:
        - name: &lt;app-config-containing-azure&gt;
    extraEnvs:
      secrets:
        - name: &lt;secret-containing-azure&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Apply your Custom Resource manifest:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl -n &lt;your_namespace&gt; apply -f rhdh.yaml</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Optional: If your <code>rhdh.yaml</code> file is not changed, for example, you only updated the ConfigMap and Secret referenced from it, refresh your Developer Hub deployment by removing the corresponding pods:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl -n &lt;your_namespace&gt; delete pods -l backstage.io/app=backstage-&lt;your-rhdh-cr&gt;</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="con-rbac-overview_assembly-rhdh-observability">10. Role-Based Access Control (RBAC) in Red Hat Developer Hub</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Role-Based Access Control is a security paradigm that restricts access to authorized users. This feature includes defining roles with specific permissions and then assigning those roles to the users.</p>
</div>
<div class="paragraph">
<p>The Red Hat Developer Hub uses RBAC to improve the permission system within the platform. The RBAC feature in Developer Hub introduces an administrator role and leverages the organizational structure including teams, groups, and users by facilitating efficient access control.</p>
</div>
<div class="sect2">
<h3 id="ref-rbac-permission-policies_assembly-rhdh-observability">10.1. Permission policies in Red Hat Developer Hub</h3>
<div class="paragraph">
<p>Permission policies in Red Hat Developer Hub are a set of rules to govern access to resources or functionalities. These policies state the authorization level that is granted to users based on their roles. The permission policies are implemented to maintain security and confidentiality within a given environment.</p>
</div>
<div class="paragraph">
<p>The following permission policies are supported in the Developer Hub:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Catalog permissions</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 25%;">
<col style="width: 15%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Resource type</th>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>catalog.entity.read</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>catalog-entity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to read from the catalog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>catalog.entity.create</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to create catalog entities, including registering an existing component in the catalog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>catalog.entity.refresh</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>catalog-entity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to refresh a single or multiple entities from the catalog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>catalog.entity.delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>catalog-entity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to delete a single or multiple entities from the catalog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>catalog.location.read</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to read a single or multiple locations from the catalog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>catalog.location.create</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to create locations within the catalog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>catalog.location.delete</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to delete locations from the catalog</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Scaffolder permissions</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 25%;">
<col style="width: 15%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Resource type</th>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scaffolder.action.execute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scaffolder-action</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows the execution of an action from a template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scaffolder.template.parameter.read</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scaffolder-template</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to read a single or multiple one parameters from a template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scaffolder.template.step.read</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scaffolder-template</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to read a single or multiple steps from a template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scaffolder.task.create</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows the user or role to trigger software templates which create new scaffolder tasks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scaffolder.task.cancel</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows the user or role to cancel currently running scaffolder tasks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scaffolder.task.read</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to read all scaffolder tasks and their associated events and logs</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">RBAC permissions</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 25%;">
<col style="width: 15%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Resource type</th>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>policy.entity.read</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>policy-entity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to read permission policies and roles</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>policy.entity.create</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>policy-entity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to create a single or multiple permission policies and roles</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>policy.entity.update</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>policy-entity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">update</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to update a single or multiple permission policies and roles</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>policy.entity.delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>policy-entity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to delete a single or multiple permission policies and roles</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Kubernetes permissions</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 25%;">
<col style="width: 15%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Resource type</th>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubernetes.proxy</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to access the proxy endpoint</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">OCM permissions</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 25%;">
<col style="width: 15%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Resource type</th>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ocm.entity.read</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to read from the OCM plugin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ocm.cluster.read</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to read the cluster information in the OCM plugin</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Topology permissions</dt>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 25%;">
<col style="width: 15%;">
<col style="width: 45%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Resource type</th>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>topology.view.read</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to view the topology plugin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kubernetes.proxy</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows user or role to access the proxy endpoint, allowing them to read pod logs and events within RHDH</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="con-rbac-config-permission-policies_assembly-rhdh-observability">10.1.1. Permission policies configuration</h4>
<div class="paragraph">
<p>There are two approaches to configure the permission policies in Red Hat Developer Hub, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration of permission policies administrators</p>
</li>
<li>
<p>Configuration of permission policies defined in an external file</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="con-rbac-config-permission-policies-admin_assembly-rhdh-observability">Configuration of permission policies administrators</h5>
<div class="paragraph">
<p>The permission policies for users and groups in the Developer Hub are managed by permission policy administrators. Only permission policy administrators can access the Role-Based Access Control REST API.</p>
</div>
<div class="paragraph">
<p>The purpose of configuring policy administrators is to enable a specific, restricted number of authenticated users to access the RBAC REST API. The permission policies are defined in a <code>policy.csv</code> file, which is referenced in the <code>app-config-rhdh</code> ConfigMap. OpenShift platform administrators or cluster administrators can perform this task with access to the namespace where Red Hat Developer Hub is deployed.</p>
</div>
<div class="paragraph">
<p>You can set the credentials of a permission policy administrator in the <code>app-config.yaml</code> file as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">permission:
  enabled: true
  rbac:
    admin:
      users:
        - name: user:default/joeuser</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="con-rbac-config-permission-policies-external-file_assembly-rhdh-observability">Configuration of permission policies defined in an external file</h5>
<div class="paragraph">
<p>You can follow this approach of configuring the permission policies before starting the Red Hat Developer Hub. If permission policies are defined in an external file, then you can import the same file in the Developer Hub. The permission policies need to be defined in Casbin rules format. For information about the Casbin rules format, see <a href="https://casbin.org/docs/category/the-basics">Basics of Casbin rules</a>.</p>
</div>
<div class="paragraph">
<p>The following is an example of permission policies configuration:</p>
</div>
<div class="paragraph">
<p><code>p, role:default/guests, catalog-entity, read, deny</code></p>
</div>
<div class="paragraph">
<p><code>p, role:default/guests, catalog.entity.create, create, deny</code></p>
</div>
<div class="paragraph">
<p><code>g, user:default/&lt;USER_TO_ROLE&gt;, role:default/guests</code></p>
</div>
<div class="paragraph">
<p>If a defined permission does not contain an action associated with it, then add <code>use</code> as a policy. See the following example:</p>
</div>
<div class="paragraph">
<p><code>p, role:default/guests, kubernetes.proxy, use, deny</code></p>
</div>
<div class="paragraph">
<p>You can define the <code>policy.csv</code> file path in the <code>app-config.yaml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">permission:
  enabled: true
  rbac:
    policies-csv-file: /some/path/rbac-policy.csv</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_mounting-policy-csv-file-to-the-developer-hub-helm-chart">Mounting <code>policy.csv</code> file to the Developer Hub Helm Chart</h6>
<div class="paragraph">
<p>When the Red Hat Developer Hub is deployed with the Helm Chart, then you must define the <code>policy.csv</code> file by mounting it to the Developer Hub Helm Chart.</p>
</div>
<div class="paragraph">
<p>You can add your <code>policy.csv</code> file to the Developer Hub Helm Chart by creating a <code>configMap</code> and mounting it.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You are logged in to your OpenShift Container Platform account using the OpenShift Container Platform web console.</p>
</li>
<li>
<p>Red Hat Developer Hub is installed and deployed using Helm Chart.</p>
<div class="paragraph">
<p>For more information about installing the Red Hat Developer Hub on OpenShift Container Platform using Helm Chart, see <a href="#proc-install-rhdh-ocp-helm_admin-rhdh">Deploying Red Hat Developer Hub on OpenShift Container Platform using Helm Chart</a>.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In OpenShift Container Platform, create a ConfigMap to hold the policies as shown in the following example:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example <code>ConfigMap</code></div>
<div class="content">
<pre class="highlight"><code>kind: ConfigMap
apiVersion: v1
metadata:
  name: rbac-policy
  namespace: rhdh
data:
  rbac-policy.csv: |
    p, role:default/guests, catalog-entity, read, allow
    p, role:default/guests, catalog.entity.create, create, allow

    g, user:default/&lt;YOUR_USER&gt;, role:default/guests</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>In the Developer Hub Helm Chart, go to <strong>Root Schema &#8594; Backstage chart schema &#8594; Backstage parameters &#8594; Backstage container additional volume mounts</strong>.</p>
</li>
<li>
<p>Select <strong>Add Backstage container additional volume mounts</strong> and add the following values:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>mountPath</strong>: <code>opt/app-root/src/rbac</code></p>
</li>
<li>
<p><strong>Name</strong>: <code>rbac-policy</code></p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Add the RBAC policy to the <strong>Backstage container additional volumes</strong> in the Developer Hub Helm Chart:</p>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: <code>rbac-policy</code></p>
</li>
<li>
<p><strong>configMap</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>defaultMode</strong>: <code>420</code></p>
</li>
<li>
<p><strong>name</strong>: <code>rbac-policy</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Update the policy path in the <code>app-config.yaml</code> file as follows:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">Example <code>app-config.yaml</code> file</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">permission:
  enabled: true
  rbac:
    policies-csv-file: ./rbac/rbac-policy.csv</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-rbac-conditional-policies-rhdh_assembly-rhdh-observability">10.2. Conditional policies in Red Hat Developer Hub</h3>
<div class="paragraph">
<p>The permission framework in Red Hat Developer Hub provides conditions, supported by the RBAC backend plugin (<code>backstage-plugin-rbac-backend</code>). The conditions work as content filters for the Developer Hub resources that are provided by the RBAC backend plugin.</p>
</div>
<div class="paragraph">
<p>The RBAC backend API stores conditions assigned to roles in the database. When you request to access the frontend resources, the RBAC backend API searches for the corresponding conditions and delegates them to the appropriate plugin using its plugin ID. If you are assigned to multiple roles with different conditions, then the RBAC backend merges the conditions using the <code>anyOf</code> criteria.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Conditional criteria</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>A condition in Developer Hub is a simple condition with a rule and parameters. However, a condition can also contain a parameter or an array of parameters combined by conditional criteria. The supported conditional criteria includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>allOf</code>: Ensures that all conditions within the array must be true for the combined condition to be satisfied.</p>
</li>
<li>
<p><code>anyOf</code>: Ensures that at least one of the conditions within the array must be true for the combined condition to be satisfied.</p>
</li>
<li>
<p><code>not</code>: Ensures that the condition within it must not be true for the combined condition to be satisfied.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Conditional object</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The plugin specifies the parameters supported for conditions. You can access the conditional object schema from the RBAC API endpoint to understand how to construct a conditional JSON object, which is then used by the RBAC backend plugin API.</p>
</div>
<div class="paragraph">
<p>A conditional object contains the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Conditional object parameters</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 45%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>result</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always has the value <code>CONDITIONAL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>roleEntityRef</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String entity reference to the RBAC role, such as <code>role:default/dev</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pluginId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponding plugin ID, such as <code>catalog</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>permissionMapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array permission actions, such as <code>['read', 'update', 'delete']</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resourceType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource type provided by the plugin, such as <code>catalog-entity</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conditions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Condition JSON with parameters or array parameters joined by criteria</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="ref-rbac-conditional-policy-definition_assembly-rhdh-observability">10.2.1. Conditional policies definition</h4>
<div class="paragraph">
<p>You can access API endpoints for conditional policies in Red Hat Developer Hub. For example, to retrieve the available conditional rules, which can help you define these policies, you can access the <code>GET [api/plugins/condition-rules]</code> endpoint.</p>
</div>
<div class="paragraph">
<p>The <code>api/plugins/condition-rules</code> returns the condition parameters schemas, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
   {
      "pluginId": "catalog",
      "rules": [
         {
            "name": "HAS_ANNOTATION",
            "description": "Allow entities with the specified annotation",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "annotation": {
                     "type": "string",
                     "description": "Name of the annotation to match on"
                  },
                  "value": {
                     "type": "string",
                     "description": "Value of the annotation to match on"
                  }
               },
               "required": [
                  "annotation"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         },
         {
            "name": "HAS_LABEL",
            "description": "Allow entities with the specified label",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "label": {
                     "type": "string",
                     "description": "Name of the label to match on"
                  }
               },
               "required": [
                  "label"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         },
         {
            "name": "HAS_METADATA",
            "description": "Allow entities with the specified metadata subfield",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "key": {
                     "type": "string",
                     "description": "Property within the entities metadata to match on"
                  },
                  "value": {
                     "type": "string",
                     "description": "Value of the given property to match on"
                  }
               },
               "required": [
                  "key"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         },
         {
            "name": "HAS_SPEC",
            "description": "Allow entities with the specified spec subfield",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "key": {
                     "type": "string",
                     "description": "Property within the entities spec to match on"
                  },
                  "value": {
                     "type": "string",
                     "description": "Value of the given property to match on"
                  }
               },
               "required": [
                  "key"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         },
         {
            "name": "IS_ENTITY_KIND",
            "description": "Allow entities matching a specified kind",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "kinds": {
                     "type": "array",
                     "items": {
                        "type": "string"
                     },
                     "description": "List of kinds to match at least one of"
                  }
               },
               "required": [
                  "kinds"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         },
         {
            "name": "IS_ENTITY_OWNER",
            "description": "Allow entities owned by a specified claim",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "claims": {
                     "type": "array",
                     "items": {
                        "type": "string"
                     },
                     "description": "List of claims to match at least one on within ownedBy"
                  }
               },
               "required": [
                  "claims"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         }
      ]
   }
   ... &lt;another plugin condition parameter schemas&gt;
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The RBAC backend API constructs a condition JSON object based on the previous condition schema.</p>
</div>
<div class="sect4">
<h5 id="_examples-of-conditional-policies">Examples of conditional policies</h5>
<div class="paragraph">
<p>In Red Hat Developer Hub, you can define conditional policies with or without criteria. You can use the following examples to define the conditions based on your use case:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">A condition without criteria</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Consider a condition without criteria displaying catalogs only if user is a member of the owner group. To add this condition, you can use the catalog plugin schema <code>IS_ENTITY_OWNER</code> as follows:</p>
</div>
<div class="listingblock">
<div class="title">Example condition without criteria</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "rule": "IS_ENTITY_OWNER",
  "resourceType": "catalog-entity",
  "params": {
    "claims": ["group:default/team-a"]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous example, the only conditional parameter used is <code>claims</code>, which contains a list of user or group entity references.</p>
</div>
<div class="paragraph">
<p>You can apply the previous example condition to the RBAC REST API by adding additional parameters as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "result": "CONDITIONAL",
  "roleEntityRef": "role:default/test",
  "pluginId": "catalog",
  "resourceType": "catalog-entity",
  "permissionMapping": ["read"],
  "conditions": {
    "rule": "IS_ENTITY_OWNER",
    "resourceType": "catalog-entity",
    "params": {
      "claims": ["group:default/team-a"]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">A condition with criteria</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Consider a condition with criteria, which displays catalogs only if user is a member of owner group OR displays list of all catalog user groups.</p>
</div>
<div class="paragraph">
<p>To add the criteria, you can add another rule as <code>IS_ENTITY_KIND</code> in the condition as follows:</p>
</div>
<div class="listingblock">
<div class="title">Example condition with criteria</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "anyOf": [
    {
      "rule": "IS_ENTITY_OWNER",
      "resourceType": "catalog-entity",
      "params": {
        "claims": ["group:default/team-a"]
      }
    },
    {
      "rule": "IS_ENTITY_KIND",
      "resourceType": "catalog-entity",
      "params": {
        "kinds": ["Group"]
      }
    }
  ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Running conditions in parallel during creation is not supported. Therefore, consider defining nested conditional policies based on the available criteria.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example of nested conditions</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "anyOf": [
    {
      "rule": "IS_ENTITY_OWNER",
      "resourceType": "catalog-entity",
      "params": {
        "claims": ["group:default/team-a"]
      }
    },
    {
      "rule": "IS_ENTITY_KIND",
      "resourceType": "catalog-entity",
      "params": {
        "kinds": ["Group"]
      }
    }
  ],
  "not": {
    "rule": "IS_ENTITY_KIND",
    "resourceType": "catalog-entity",
    "params": { "kinds": ["Api"] }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can apply the previous example condition to the RBAC REST API by adding additional parameters as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "result": "CONDITIONAL",
  "roleEntityRef": "role:default/test",
  "pluginId": "catalog",
  "resourceType": "catalog-entity",
  "permissionMapping": ["read"],
  "conditions": {
    "anyOf": [
      {
        "rule": "IS_ENTITY_OWNER",
        "resourceType": "catalog-entity",
        "params": {
          "claims": ["group:default/team-a"]
        }
      },
      {
        "rule": "IS_ENTITY_KIND",
        "resourceType": "catalog-entity",
        "params": {
          "kinds": ["Group"]
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following examples can be used with Developer Hub plugins. These examples can help you determine how to define conditional policies:</p>
</div>
<div class="listingblock">
<div class="title">Conditional policy defined for Keycloak plugin</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "result": "CONDITIONAL",
  "roleEntityRef": "role:default/developer",
  "pluginId": "catalog",
  "resourceType": "catalog-entity",
  "permissionMapping": ["update", "delete"],
  "conditions": {
    "not": {
      "rule": "HAS_ANNOTATION",
      "resourceType": "catalog-entity",
      "params": { "annotation": "keycloak.org/realm", "value": "&lt;YOUR_REALM&gt;" }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous example of Keycloak plugin prevents users in the <code>role:default/developer</code> from updating or deleting users that are ingested into the catalog from the Keycloak plugin.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>In the previous example, the annotation <code>keycloak.org/realm</code> requires the value of <code>&lt;YOUR_REALM&gt;</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Conditional policy defined for Quay plugin</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "result": "CONDITIONAL",
  "roleEntityRef": "role:default/developer",
  "pluginId": "scaffolder",
  "resourceType": "scaffolder-action",
  "permissionMapping": ["use"],
  "conditions": {
    "not": {
      "rule": "HAS_ACTION_ID",
      "resourceType": "scaffolder-action",
      "params": { "actionId": "quay:create-repository" }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous example of Quay plugin prevents the role <code>role:default/developer</code> from using the Quay scaffolder action. Note that <code>permissionMapping</code> contains <code>use</code>, signifying that <code>scaffolder-action</code> resource type permission does not have a permission policy.</p>
</div>
<div class="paragraph">
<p>For more information about permissions in Red Hat Developer Hub, see <a href="#ref-rbac-permission-policies_admin-rhdh">[ref-rbac-permission-policies_admin-rhdh]</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-rbac-ui-manage-roles_assembly-rhdh-observability">10.3. Managing role-based access controls (RBAC) using the Red Hat Developer Hub Web UI</h3>
<div class="paragraph">
<p>Administrators can use the Developer Hub web interface (Web UI) to allocate specific roles and permissions to individual users or groups. Allocating roles ensures that access to resources and functionalities is regulated across the Developer Hub.</p>
</div>
<div class="paragraph">
<p>With the administrator role in Developer Hub, you can assign permissions to users and groups, which allow users or groups to view, create, modify, and delete the roles using the Developer Hub Web UI.</p>
</div>
<div class="paragraph">
<p>To access the RBAC features in the Web UI, you must install and configure the <code>@janus-idp/backstage-plugin-rbac</code> plugin as a dynamic plugin. For more information about installing a dynamic plugin, see <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.2/html-single/confuguring_plugins_in_red_hat_developer_hub/index">Configuring plugins in Red Hat Developer Hub</a>.</p>
</div>
<div class="paragraph">
<p>After you install the <code>@janus-idp/backstage-plugin-rbac</code> plugin, the <strong>Administration</strong> option appears at the bottom of the sidebar. When you can click <strong>Administration</strong>, the RBAC tab appears by default, displaying all of the existing roles created in the Developer Hub. In the RBAC tab, you can also view the total number of users, groups, and the total number of permission policies associated with a role. You can also edit or delete a role using the <strong>Actions</strong> column.</p>
</div>
<div class="sect3">
<h4 id="proc-rbac-ui-create-role_assembly-rhdh-observability">10.3.1. Creating a role in the Red Hat Developer Hub Web UI</h4>
<div class="paragraph">
<p>You can create a role in the Red Hat Developer Hub using the Web UI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have an administrator role in the Developer Hub.</p>
</li>
<li>
<p>You have installed the <code>@janus-idp/backstage-plugin-rbac</code> plugin in Developer Hub. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.2/html-single/confuguring_plugins_in_red_hat_developer_hub/index">Configuring plugins in Red Hat Developer Hub</a>.</p>
</li>
<li>
<p>You have configured the required permission policies. For more information, see <a href="#con-rbac-config-permission-policies_admin-rhdh">[con-rbac-config-permission-policies_admin-rhdh]</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Go to <strong>Administration</strong> at the bottom of the sidebar in the Developer Hub.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <strong>RBAC</strong> tab appears, displaying all the created roles in the Developer Hub.</p>
</div>
</div>
</div>
</li>
<li>
<p>(Optional) Click any role to view the role information on the <strong>OVERVIEW</strong> page.</p>
</li>
<li>
<p>Click <strong>CREATE</strong> to create a role.</p>
</li>
<li>
<p>Enter the name and description of the role in the given fields and click <strong>NEXT</strong>.</p>
</li>
<li>
<p>Add users and groups using the search field, and click <strong>NEXT</strong>.</p>
</li>
<li>
<p>Select <strong>Plugin</strong> and <strong>Permission</strong> from the drop-downs in the <strong>Add permission policies</strong> section.</p>
</li>
<li>
<p>Select or clear the <strong>Policy</strong> that you want to set in the <strong>Add permission policies</strong> section, and click <strong>NEXT</strong>.</p>
</li>
<li>
<p>Review the added information in the <strong>Review and create</strong> section.</p>
</li>
<li>
<p>Click <strong>CREATE</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>The created role appears in the list available in the <strong>RBAC</strong> tab.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-rbac-ui-edit-role_assembly-rhdh-observability">10.3.2. Editing a role in the Red Hat Developer Hub Web UI</h4>
<div class="paragraph">
<p>You can edit a role in the Red Hat Developer Hub using the Web UI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The policies generated from a <code>policy.csv</code> or ConfigMap file cannot be edited or deleted using the Developer Hub Web UI.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have an administrator role in the Developer Hub.</p>
</li>
<li>
<p>You have installed the <code>@janus-idp/backstage-plugin-rbac</code> plugin in Developer Hub. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.2/html-single/confuguring_plugins_in_red_hat_developer_hub/index">Configuring plugins in Red Hat Developer Hub</a>.</p>
</li>
<li>
<p>You have configured the required permission policies. For more information, see <a href="#con-rbac-config-permission-policies_admin-rhdh">[con-rbac-config-permission-policies_admin-rhdh]</a>.</p>
</li>
<li>
<p>The role that you want to edit is created in the Developer Hub.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Go to <strong>Administration</strong> at the bottom of the sidebar in the Developer Hub.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <strong>RBAC</strong> tab appears, displaying all the created roles in the Developer Hub.</p>
</div>
</div>
</div>
</li>
<li>
<p>(Optional) Click any role to view the role information on the <strong>OVERVIEW</strong> page.</p>
</li>
<li>
<p>Select the edit icon for the role that you want to edit.</p>
</li>
<li>
<p>Edit the details of the role, such as name, description, users and groups, and permission policies, and click <strong>NEXT</strong>.</p>
</li>
<li>
<p>Review the edited details of the role and click <strong>SAVE</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After editing a role, you can view the edited details of a role on the <strong>OVERVIEW</strong> page of a role. You can also edit a roles users and groups or permissions by using the edit icon on the respective cards on the <strong>OVERVIEW</strong> page.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-rbac-ui-delete-role_assembly-rhdh-observability">10.3.3. Deleting a role in the Red Hat Developer Hub Web UI</h4>
<div class="paragraph">
<p>You can delete a role in the Red Hat Developer Hub using the Web UI.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The policies generated from a <code>policy.csv</code> or ConfigMap file cannot be edited or deleted using the Developer Hub Web UI.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have an administrator role in the Developer Hub.</p>
</li>
<li>
<p>You have installed the <code>@janus-idp/backstage-plugin-rbac</code> plugin in Developer Hub. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.2/html-single/confuguring_plugins_in_red_hat_developer_hub/index">Configuring plugins in Red Hat Developer Hub</a>.</p>
</li>
<li>
<p>You have configured the required permission policies. For more information, see <a href="#con-rbac-config-permission-policies_admin-rhdh">[con-rbac-config-permission-policies_admin-rhdh]</a>.</p>
</li>
<li>
<p>The role that you want to delete is created in the Developer Hub.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Go to <strong>Administration</strong> at the bottom of the sidebar in the Developer Hub.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The <strong>RBAC</strong> tab appears, displaying all the created roles in the Developer Hub.</p>
</div>
</div>
</div>
</li>
<li>
<p>(Optional) Click any role to view the role information on the <strong>OVERVIEW</strong> page.</p>
</li>
<li>
<p>Select the delete icon from the <strong>Actions</strong> column for the role that you want to delete.</p>
<div class="paragraph">
<p><strong>Delete this role?</strong> pop-up appears on the screen.</p>
</div>
</li>
<li>
<p>Click <strong>DELETE</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-rbac-rest-api_assembly-rhdh-observability">10.4. Role-based Access Control (RBAC) REST API</h3>
<div class="paragraph">
<p>Red Hat Developer Hub provides RBAC REST API that you can use to manage the permissions and roles in the Developer Hub. This API supports you to facilitate and automate the maintenance of Developer Hub permission policies and roles.</p>
</div>
<div class="paragraph">
<p>Using the RBAC REST API, you can perform the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Retrieve information about all permission policies or specific permission policies, or roles</p>
</li>
<li>
<p>Create, update, or delete a permission policy or a role</p>
</li>
<li>
<p>Retrieve permission policy information about static plugins</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The RBAC REST API requires the following components:</p>
</div>
<div class="paragraph">
<p><strong>Authorization</strong></p>
</div>
<div class="paragraph">
<p>The RBAC REST API requires Bearer token authorization for the permitted user role. For development purposes, you can access a web console in a browser. When you refresh a token request in the list of network requests, you find the token in the response JSON.</p>
</div>
<div class="paragraph">
<p><code>Authorization: Bearer $token</code></p>
</div>
<div class="paragraph">
<p>For example, on the <strong>Homepage</strong> of the Developer Hub, you can navigate to the <strong>Network</strong> tab and search for the <code>query?term=</code> network call. Alternatively, you can go to the <strong>Catalog</strong> page and select any network call with <code>entity-facets</code> to acquire the Bearer token.</p>
</div>
<div class="paragraph">
<p><strong>HTTP methods</strong></p>
</div>
<div class="paragraph">
<p>The RBAC REST API supports the following HTTP methods for API requests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GET</code>: Retrieves specified information from a specified resource endpoint</p>
</li>
<li>
<p><code>POST</code>: Creates or updates a resource</p>
</li>
<li>
<p><code>PUT</code>: Updates a resource</p>
</li>
<li>
<p><code>DELETE</code>: Deletes a resource</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Base URL</strong></p>
</div>
<div class="paragraph">
<p>The base URL for RBAC REST API requests is <code>http://SERVER:PORT/api/permission/policies</code>, such as <code>http://localhost:7007/api/permission/policies</code>.</p>
</div>
<div class="paragraph">
<p><strong>Endpoints</strong></p>
</div>
<div class="paragraph">
<p>RBAC REST API endpoints, such as <code>/api/permission/policies/[kind]/[namespace]/[name]</code> for specified kind, namespace, and username, are the URI that you append to the base URL to access the corresponding resource.</p>
</div>
<div class="paragraph">
<p>Example request URL for <code>/api/permission/policies/[kind]/[namespace]/[name]</code> endpoint is:</p>
</div>
<div class="paragraph">
<p><code>http://localhost:7007/api/permission/policies/user/default/johndoe</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If at least one permission is assigned to <code>user:default/johndoe</code>, then the example request URL mentioned previously returns a result if sent in a <code>GET</code> response with a valid authorization token. However, if permission is only assigned to roles, then the example request URL does not return an output.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Request data</strong></p>
</div>
<div class="paragraph">
<p>HTTP <code>POST</code> requests in the RBAC REST API may require a JSON request body with data to accompany the request.</p>
</div>
<div class="paragraph">
<p>Example <code>POST</code> request URL and JSON request body data for
<code>http://localhost:7007/api/permission/policies</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "entityReference": "role:default/test",
    "permission": "catalog-entity",
    "policy": "delete",
    "effect": "allow"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>HTTP status codes</strong></p>
</div>
<div class="paragraph">
<p>The RBAC REST API supports the following HTTP status codes to return as responses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>200</code> OK: The request was successful.</p>
</li>
<li>
<p><code>201</code> Created: The request resulted in a new resource being successfully created.</p>
</li>
<li>
<p><code>204</code> No Content: The request was successful, but there is no additional content to send in the response payload.</p>
</li>
<li>
<p><code>400</code> Bad Request: input error with the request</p>
</li>
<li>
<p><code>401</code> Unauthorized: lacks valid authentication for the requested resource</p>
</li>
<li>
<p><code>403</code> Forbidden: refusal to authorize request</p>
</li>
<li>
<p><code>404</code> Not Found: could not find requested resource</p>
</li>
<li>
<p><code>409</code> Conflict: request conflict with the current state and the target resource</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="proc-rbac-send-request-rbac-rest-api_assembly-rhdh-observability">10.4.1. Sending requests with the RBAC REST API using a REST client or curl utility</h4>
<div class="paragraph">
<p>The RBAC REST API enables you to interact with the permission policies and roles in Developer Hub without using the user interface. You can send RBAC REST API requests using any REST client or curl utility.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Red Hat Developer Hub is installed and running. For more information about installing Red Hat Developer Hub, see <a href="#proc-install-rhdh-ocp-helm_admin-rhdh">Deploying Red Hat Developer Hub on OpenShift Container Platform using Helm Chart</a>. .</p>
</li>
<li>
<p>You have access to the Developer Hub.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Identify a relevant API endpoint to which you want to send a request, such as <code>POST /api/permission/policies</code>. Adjust any request details according to your use case.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p><strong>For REST client</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authorization: Enter the generated token from the web console.</p>
</li>
<li>
<p>HTTP method: Set to <code>POST</code>.</p>
</li>
<li>
<p>URL: Enter the RBAC REST API base URL and endpoint such as
<code>http://localhost:7007/api/permission/policies</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>For curl utility</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-X</code>: Set to <code>POST</code></p>
</li>
<li>
<p><code>-H</code>: Set the following header:</p>
<div class="paragraph">
<p><code>Content-type: application/json</code></p>
</div>
<div class="paragraph">
<p><code>Authorization: Bearer $token</code></p>
</div>
<div class="paragraph">
<p><code>$token</code> is the requested token from the web console in a browser.</p>
</div>
</li>
<li>
<p>URL: Enter the following RBAC REST API base URL endpoint, such as <code>http://localhost:7007/api/permission/policies</code></p>
</li>
<li>
<p><code>-d</code>: Add a request JSON body</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Example request</strong>:</p>
</div>
<div class="paragraph">
<p><code>curl -X POST "http://localhost:7007/api/permission/policies" -d '{"entityReference":"role:default/test", "permission": "catalog-entity", "policy": "read", "effect":"allow"}' -H "Content-Type: application/json" -H "Authorization: Bearer $token" -v</code></p>
</div>
</div>
</div>
</li>
<li>
<p>Execute the request and review the response.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ref-rbac-rest-api-endpoints_assembly-rhdh-observability">10.4.2. Supported RBAC REST API endpoints</h4>
<div class="paragraph">
<p>The RBAC REST API provides endpoints for managing roles, permissions, and conditional policies in the Developer Hub and for retrieving information about the roles and policies.</p>
</div>
<div class="sect4">
<h5 id="_roles">Roles</h5>
<div class="paragraph">
<p>The RBAC REST API supports the following endpoints for managing roles in the Red Hat Developer Hub.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] /api/permission/roles</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns all roles in Developer Hub.</p>
</div>
<div class="listingblock">
<div class="title">Example response (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "memberReferences": ["user:default/username"],
    "name": "role:default/guests"
  },
  {
    "memberReferences": [
      "group:default/groupname",
      "user:default/username"
    ],
    "name": "role:default/rbac_admin"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[GET] /api/permission/roles/{kind}/{namespace}/{name}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns information for a single role in Developer Hub.</p>
</div>
<div class="listingblock">
<div class="title">Example response (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "memberReferences": [
      "group:default/groupname",
      "user:default/username"
    ],
    "name": "role:default/rbac_admin"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] /api/permission/roles/{kind}/{namespace}/{name}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Creates a role in Developer Hub.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Request parameters</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>body</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>memberReferences</code>, <code>group</code>, <code>namespace</code>, and <code>name</code> the new role to be created.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example request body (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "memberReferences": ["group:default/test"],
  "name": "role:default/test_admin"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlight"><code>201 Created</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[PUT] /api/permission/roles/{kind}/{namespace}/{name}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Updates <code>memberReferences</code>, <code>kind</code>, <code>namespace</code>, or <code>name</code> for a role in Developer Hub.</p>
</div>
<div class="paragraph">
<div class="title">Request parameters</div>
<p>The request body contains the <code>oldRole</code> and <code>newRole</code> objects:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>body</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>memberReferences</code>, <code>group</code>, <code>namespace</code>, and <code>name</code> the new role to be created.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example request body (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "oldRole": {
    "memberReferences": ["group:default/test"],
    "name": "role:default/test_admin"
  },
  "newRole": {
    "memberReferences": ["group:default/test", "user:default/test2"],
    "name": "role:default/test_admin"
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlight"><code>200 OK</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[DELETE] /api/permission/roles/{kind}/{namespace}/{name}?memberReferences=&lt;VALUE&gt;</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Deletes the specified user or group from a role in Developer Hub.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Request parameters</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kind of the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>namespace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace of the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username related to the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>memberReferences</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Associated group information</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlight"><code>204</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[DELETE] /api/permission/roles/{kind}/{namespace}/{name}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Deletes a specified role from Developer Hub.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Request parameters</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kind of the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>namespace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace of the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username related to the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlight"><code>204</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_permission-policies">Permission policies</h5>
<div class="paragraph">
<p>The RBAC REST API supports the following endpoints for managing permission policies in the Red Hat Developer Hub.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] /api/permission/policies</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns permission policies list for all users.</p>
</div>
<div class="listingblock">
<div class="title">Example response (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "entityReference": "role:default/test",
    "permission": "catalog-entity",
    "policy": "read",
    "effect": "allow"
  },
  {
    "entityReference": "role:default/test",
    "permission": "catalog.entity.create",
    "policy": "use",
    "effect": "allow"
  },
]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[GET] /api/permission/policies/{kind}/{namespace}/{name}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns permission policies related to the specified entity reference.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Request parameters</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kind of the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>namespace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace of the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username related to the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example response (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "entityReference": "role:default/test",
    "permission": "catalog-entity",
    "policy": "read",
    "effect": "allow"
  },
  {
    "entityReference": "role:default/test",
    "permission": "catalog.entity.create",
    "policy": "use",
    "effect": "allow"
  }
]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] /api/permission/policies</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Creates a permission policy for a specified entity.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Request parameters</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>entityReference</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference values of an entity including namespace and name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>permission</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>policy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read or write policy to the permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>effect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication of allowing or not allowing the policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example request body (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "entityReference": "role:default/test",
    "permission": "catalog-entity",
    "policy": "read",
    "effect": "allow"
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlight"><code>201 Created</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[PUT] /api/permission/policies/{kind}/{namespace}/{name}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Updates a permission policy for a specified entity.</p>
</div>
<div class="paragraph">
<div class="title">Request parameters</div>
<p>The request body contains the <code>oldPolicy</code> and <code>newPolicy</code> objects:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>permission</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>policy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read or write policy to the permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>effect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication of allowing or not allowing the policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example request body (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "oldPolicy": {
        "permission": "catalog-entity",
        "policy": "read",
        "effect": "deny"
    },
    "newPolicy": {
        "permission": "policy-entity",
        "policy": "read",
        "effect": "allow"
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlight"><code>200</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[DELETE] /api/permission/policies/{kind}/{namespace}/{name}?permission={value1}&amp;policy={value2}&amp;effect={value3}</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Deletes a permission policy added to the specified entity.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Request parameters</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kind</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kind of the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>namespace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Namespace of the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username related to the entity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>permission</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>policy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read or write policy to the permission</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>effect</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indication of allowing or not allowing the policy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlight"><code>204 No Content</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[GET] /api/permission/plugins/policies</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns permission policies for all static plugins.</p>
</div>
<div class="listingblock">
<div class="title">Example response (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "pluginId": "catalog",
      "policies": [
        {
          "permission": "catalog-entity",
          "policy": "read"
        },
        {
          "permission": "catalog.entity.create",
          "policy": "create"
        },
        {
          "permission": "catalog-entity",
          "policy": "delete"
        },
        {
          "permission": "catalog-entity",
          "policy": "update"
        },
        {
          "permission": "catalog.location.read",
          "policy": "read"
        },
        {
          "permission": "catalog.location.create",
          "policy": "create"
        },
        {
          "permission": "catalog.location.delete",
          "policy": "delete"
        }
      ]
    },
  ...
]</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_conditional-policies">Conditional policies</h5>
<div class="paragraph">
<p>The RBAC REST API supports the following endpoints for managing conditional policies in the Red Hat Developer Hub.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[GET] /api/plugins/condition-rules</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns available conditional rule parameter schemas for the available plugins that are enabled in Developer Hub.</p>
</div>
<div class="listingblock">
<div class="title">Example response (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
   {
      "pluginId": "catalog",
      "rules": [
         {
            "name": "HAS_ANNOTATION",
            "description": "Allow entities with the specified annotation",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "annotation": {
                     "type": "string",
                     "description": "Name of the annotation to match on"
                  },
                  "value": {
                     "type": "string",
                     "description": "Value of the annotation to match on"
                  }
               },
               "required": [
                  "annotation"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         },
         {
            "name": "HAS_LABEL",
            "description": "Allow entities with the specified label",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "label": {
                     "type": "string",
                     "description": "Name of the label to match on"
                  }
               },
               "required": [
                  "label"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         },
         {
            "name": "HAS_METADATA",
            "description": "Allow entities with the specified metadata subfield",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "key": {
                     "type": "string",
                     "description": "Property within the entities metadata to match on"
                  },
                  "value": {
                     "type": "string",
                     "description": "Value of the given property to match on"
                  }
               },
               "required": [
                  "key"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         },
         {
            "name": "HAS_SPEC",
            "description": "Allow entities with the specified spec subfield",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "key": {
                     "type": "string",
                     "description": "Property within the entities spec to match on"
                  },
                  "value": {
                     "type": "string",
                     "description": "Value of the given property to match on"
                  }
               },
               "required": [
                  "key"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         },
         {
            "name": "IS_ENTITY_KIND",
            "description": "Allow entities matching a specified kind",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "kinds": {
                     "type": "array",
                     "items": {
                        "type": "string"
                     },
                     "description": "List of kinds to match at least one of"
                  }
               },
               "required": [
                  "kinds"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         },
         {
            "name": "IS_ENTITY_OWNER",
            "description": "Allow entities owned by a specified claim",
            "resourceType": "catalog-entity",
            "paramsSchema": {
               "type": "object",
               "properties": {
                  "claims": {
                     "type": "array",
                     "items": {
                        "type": "string"
                     },
                     "description": "List of claims to match at least one on within ownedBy"
                  }
               },
               "required": [
                  "claims"
               ],
               "additionalProperties": false,
               "$schema": "http://json-schema.org/draft-07/schema#"
            }
         }
      ]
   }
   ... &lt;another plugin condition parameter schemas&gt;
]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[GET] /api/permission/roles/conditions/:id</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns conditions for the specified ID.</p>
</div>
<div class="listingblock">
<div class="title">Example response (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id": 1,
  "result": "CONDITIONAL",
  "roleEntityRef": "role:default/test",
  "pluginId": "catalog",
  "resourceType": "catalog-entity",
  "permissionMapping": ["read"],
  "conditions": {
    "anyOf": [
      {
        "rule": "IS_ENTITY_OWNER",
        "resourceType": "catalog-entity",
        "params": {
          "claims": ["group:default/team-a"]
        }
      },
      {
        "rule": "IS_ENTITY_KIND",
        "resourceType": "catalog-entity",
        "params": {
          "kinds": ["Group"]
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[GET] /api/permission/roles/conditions</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Returns list of all conditions for all roles.</p>
</div>
<div class="listingblock">
<div class="title">Example response (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">[
  {
    "id": 1,
    "result": "CONDITIONAL",
    "roleEntityRef": "role:default/test",
    "pluginId": "catalog",
    "resourceType": "catalog-entity",
    "permissionMapping": ["read"],
    "conditions": {
      "anyOf": [
        {
          "rule": "IS_ENTITY_OWNER",
          "resourceType": "catalog-entity",
          "params": {
            "claims": ["group:default/team-a"]
          }
        },
        {
          "rule": "IS_ENTITY_KIND",
          "resourceType": "catalog-entity",
          "params": {
            "kinds": ["Group"]
          }
        }
      ]
    }
  }
]</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[POST] /api/permission/roles/conditions</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Creates a conditional policy for the specified role.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Request parameters</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>result</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always has the value <code>CONDITIONAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>roleEntityRef</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String entity reference to the RBAC role, such as <code>role:default/dev</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pluginId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponding plugin ID, such as <code>catalog</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>permissionMapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array permission action, such as <code>['read', 'update', 'delete']</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resourceType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource type provided by the plugin, such as <code>catalog-entity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conditions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Condition JSON with parameters or array parameters joined by criteria</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example request body (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "result": "CONDITIONAL",
  "roleEntityRef": "role:default/test",
  "pluginId": "catalog",
  "resourceType": "catalog-entity",
  "permissionMapping": ["read"],
  "conditions": {
    "rule": "IS_ENTITY_OWNER",
    "resourceType": "catalog-entity",
    "params": {
      "claims": ["group:default/team-a"]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example response (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "id": 1
}</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[PUT] /permission/roles/conditions/:id</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Updates a condition policy for a specified ID.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Request parameters</caption>
<colgroup>
<col style="width: 15%;">
<col style="width: 45%;">
<col style="width: 15%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>result</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always has the value <code>CONDITIONAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>roleEntityRef</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String entity reference to the RBAC role, such as <code>role:default/dev</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pluginId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corresponding plugin ID, such as <code>catalog</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>permissionMapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Array permission action, such as <code>['read', 'update', 'delete']</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resourceType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource type provided by the plugin, such as <code>catalog-entity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conditions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Condition JSON with parameters or array parameters joined by criteria</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example request body (JSON)</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "result": "CONDITIONAL",
  "roleEntityRef": "role:default/test",
  "pluginId": "catalog",
  "resourceType": "catalog-entity",
  "permissionMapping": ["read"],
  "conditions": {
    "anyOf": [
      {
        "rule": "IS_ENTITY_OWNER",
        "resourceType": "catalog-entity",
        "params": {
          "claims": ["group:default/team-a"]
        }
      },
      {
        "rule": "IS_ENTITY_KIND",
        "resourceType": "catalog-entity",
        "params": {
          "kinds": ["Group"]
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlight"><code>200</code></pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">[DELETE] /api/permission/roles/conditions/:id</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Deletes a conditional policy for the specified ID.</p>
</div>
<div class="listingblock">
<div class="title">Example response</div>
<div class="content">
<pre class="highlight"><code>204</code></pre>
</div>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-admin-templates">11. Managing templates</h2>
<div class="sectionbody">
<!-- toc disabled -->
<div class="paragraph">
<p>A template is a form composed of different UI fields that is defined in a YAML file. Templates include <em>actions</em>, which are steps that are executed in sequential order and can be executed conditionally.</p>
</div>
<div class="paragraph">
<p>You can use templates to easily create Red Hat Developer Hub components, and then publish these components to different locations, such as the Red Hat Developer Hub software catalog, or repositories in GitHub or GitLab.</p>
</div>
<div class="sect2">
<h3 id="proc-creating-templates_assembly-admin-templates">11.1. Creating a template by using the Template Editor</h3>
<div class="paragraph">
<p>You can create a template by using the Template Editor.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Access the Template Editor by using one of the following options:</p>
<div class="imageblock">
<div class="content">
<img src="images/rhdh/template-editor.png" alt="Template Editor">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the URL <code>https://&lt;rhdh_url&gt;/create/edit</code> for your Red Hat Developer Hub instance.</p>
</li>
<li>
<p>Click <strong>Create&#8230;&#8203;</strong> in the navigation menu of the Red Hat Developer Hub console, then click the overflow menu button and select <strong>Template editor</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Edit Template Form</strong>.</p>
</li>
<li>
<p>Optional: Modify the YAML definition for the parameters of your template. For more information about these parameters, see <a href="#ref-creating-templates_assembly-admin-templates">Creating a template as a YAML file</a>.</p>
</li>
<li>
<p>In the <strong>Name *</strong> field, enter a unique name for your template.</p>
</li>
<li>
<p>From the <strong>Owner</strong> drop-down menu, choose an owner for the template.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>In the <strong>Repository Location</strong> view, enter the following information about the hosted repository that you want to publish the template to:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select an available <strong>Host</strong> from the drop-down menu.</p>
<div class="openblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Available hosts are defined in the YAML parameters by the <code>allowedHosts</code> field:</p>
</div>
<div class="listingblock">
<div class="title">Example YAML</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ...
        ui:options:
          allowedHosts:
            - github.com
# ...</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>In the <strong>Owner *</strong> field, enter an organization, user or project that the hosted repository belongs to.</p>
</li>
<li>
<p>In the <strong>Repository *</strong> field, enter the name of the hosted repository.</p>
</li>
<li>
<p>Click <strong>Review</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Review the information for accuracy, then click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Click the <strong>Catalog</strong> tab in the navigation panel.</p>
</li>
<li>
<p>In the <strong>Kind</strong> drop-down menu, select <strong>Template</strong>.</p>
</li>
<li>
<p>Confirm that your template is shown in the list of existing templates.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ref-creating-templates_assembly-admin-templates">11.2. Creating a template as a YAML file</h3>
<div class="paragraph">
<p>You can create a template by defining a <code>Template</code> object as a YAML file.</p>
</div>
<div class="paragraph">
<p>The <code>Template</code> object describes the template and its metadata. It also contains required input variables and a list of actions that are executed by the scaffolding service.</p>
</div>
<div class="listingblock">
<div class="title"><code>Template</code> object example</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: template-name # <b class="conum">(1)</b>
  title: Example template # <b class="conum">(2)</b>
  description: An example template for v1beta3 scaffolder. # <b class="conum">(3)</b>
spec:
  owner: backstage/techdocs-core # <b class="conum">(4)</b>
  type: service # <b class="conum">(5)</b>
  parameters: # <b class="conum">(6)</b>
    - title: Fill in some steps
      required:
        - name
      properties:
        name:
          title: Name
          type: string
          description: Unique name of the component
        owner:
          title: Owner
          type: string
          description: Owner of the component
    - title: Choose a location
      required:
        - repoUrl
      properties:
        repoUrl:
          title: Repository Location
          type: string
  steps: # <b class="conum">(7)</b>
    - id: fetch-base
      name: Fetch Base
      action: fetch:template
      # ...
  output: # <b class="conum">(8)</b>
    links:
      - title: Repository # <b class="conum">(9)</b>
        url: ${{ steps['publish'].output.remoteUrl }}
      - title: Open in catalog # <b class="conum">(10)</b>
        icon: catalog
        entityRef: ${{ steps['register'].output.entityRef }}
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify a name for the template.</p>
</li>
<li>
<p>Specify a title for the template. This is the title that is visible on the template tile in the <strong>Create&#8230;&#8203;</strong> view.</p>
</li>
<li>
<p>Specify a description for the template. This is the description that is visible on the template tile in the <strong>Create&#8230;&#8203;</strong> view.</p>
</li>
<li>
<p>Specify the ownership of the template. The <code>owner</code> field provides information about who is responsible for maintaining or overseeing the template within the system or organization. In the provided example, the <code>owner</code> field is set to <code>backstage/techdocs-core</code>. This means that this template belongs to the <code>techdocs-core</code> project in the <code>backstage</code> namespace.</p>
</li>
<li>
<p>Specify the component type. Any string value is accepted for this required field, but your organization should establish a proper taxonomy for these. Red Hat Developer Hub instances may read this field and behave differently depending on its value. For example, a <code>website</code> type component may present tooling in the Red Hat Developer Hub interface that is specific to just websites.</p>
<div class="paragraph">
<p>The following values are common for this field:</p>
</div>
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1"><code>service</code></dt>
<dd>
<p>A backend service, typically exposing an API.</p>
</dd>
<dt class="hdlist1"><code>website</code></dt>
<dd>
<p>A website.</p>
</dd>
<dt class="hdlist1"><code>library</code></dt>
<dd>
<p>A software library, such as an npm module or a Java library.</p>
</dd>
</dl>
</div>
</div>
</div>
</li>
<li>
<p>Use the <code>parameters</code> section to specify parameters for user input that are shown in a form view when a user creates a component by using the template in the Red Hat Developer Hub console. Each <code>parameters</code> subsection, defined by a title and properties, creates a new form page with that definition.</p>
</li>
<li>
<p>Use the <code>steps</code> section to specify steps that are executed in the backend. These steps must be defined by using a unique step ID, a name, and an action. You can view actions that are available on your Red Hat Developer Hub instance by visiting the URL <code>https://&lt;rhdh_url&gt;/create/actions</code>.</p>
</li>
<li>
<p>Use the <code>output</code> section to specify the structure of output data that is created when the template is used. The <code>output</code> section, particularly the <code>links</code> subsection, provides valuable references and URLs that users can utilize to access and interact with components that are created from the template.</p>
</li>
<li>
<p>Provides a reference or URL to the repository associated with the generated component.</p>
</li>
<li>
<p>Provides a reference or URL that allows users to open the generated component in a catalog or directory where various components are listed.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://backstage.io/docs/features/software-templates/writing-templates">Backstage documentation - Writing Templates</a></p>
</li>
<li>
<p><a href="https://backstage.io/docs/features/software-templates/builtin-actions">Backstage documentation - Builtin actions</a></p>
</li>
<li>
<p><a href="https://backstage.io/docs/features/software-templates/writing-custom-actions">Backstage documentation - Writing Custom Actions</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-adding-templates_assembly-admin-templates">11.3. Importing an existing template to Red Hat Developer Hub</h3>
<div class="paragraph">
<p>You can add an existing template to your Red Hat Developer Hub instance by using the Catalog Processor.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have created a directory or repository that contains at least one template YAML file.</p>
</li>
<li>
<p>If you want to use a template that is stored in a repository such as GitHub or GitLab, you must configure a Red Hat Developer Hub integration for your provider.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>In the <code>app-config.yaml</code> configuration file, modify the <code>catalog.rules</code> section to include a rule for templates, and configure the <code>catalog.locations</code> section to point to the template that you want to add, as shown in the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"># ...
catalog:
  rules:
    - allow: [Template] # <b class="conum">(1)</b>
  locations:
    - type: url # <b class="conum">(2)</b>
      target: https://&lt;repository_url&gt;/example-template.yaml # <b class="conum">(3)</b>
# ...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>To allow new templates to be added to the catalog, you must add a <code>Template</code> rule.</p>
</li>
<li>
<p>If you are importing templates from a repository, such as GitHub or GitLab, use the <code>url</code> type.</p>
</li>
<li>
<p>Specify the URL for the template.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Click the <strong>Catalog</strong> tab in the navigation panel.</p>
</li>
<li>
<p>In the <strong>Kind</strong> drop-down menu, select <strong>Template</strong>.</p>
</li>
<li>
<p>Confirm that your template is shown in the list of existing templates.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#assembly-auth-provider-github_proc-configuring-github-app">Configuring a GitHub App in Developer Hub</a></p>
</li>
<li>
<p><a href="#assembly-enabling-authentication_proc-adding-gitlab-oauth-as-an-authentication-provider">Enabling the GitLab OAuth authentication provider</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-techdocs-plugin_assembly-admin-templates">12. Configuring the TechDocs plugin in Red Hat Developer Hub</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Red Hat Developer Hub TechDocs plugin helps your organization create, find, and use documentation in a central location and in a standardized way. For example:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Docs-like-code approach</dt>
<dd>
<p>Write your technical documentation in Markdown files that are stored inside your project repository along with your code.</p>
</dd>
<dt class="hdlist1">Documentation site generation</dt>
<dd>
<p>Use MkDocs to create a full-featured, Markdown-based, static HTML site for your documentation that is rendered centrally in Developer Hub.</p>
</dd>
<dt class="hdlist1">Documentation site metadata and integrations</dt>
<dd>
<p>See additional metadata about the documentation site alongside the static documentation, such as the date of the last update, the site owner, top contributors, open GitHub issues, Slack support channels, and Stack Overflow Enterprise tags.</p>
</dd>
<dt class="hdlist1">Built-in navigation and search</dt>
<dd>
<p>Find the information that you want from a document more quickly and easily.</p>
</dd>
<dt class="hdlist1">Add-ons</dt>
<dd>
<p>Customize your TechDocs experience with Add-ons to address higher-order documentation needs.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The TechDocs plugin is preinstalled and enabled on a Developer Hub instance by default. You can disable or enable the TechDocs plugin, and change other parameters, by configuring the Red Hat Developer Hub Helm chart or the Red Hat Developer Hub Operator config map.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Red Hat Developer Hub includes a built-in TechDocs builder that generates static HTML documentation from your codebase. However, the default basic setup of the local builder is not intended for production.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use a CI/CD pipeline with the repository that has a dedicated job to generate docs for TechDocs. The generated static files are stored in OpenShift Data Foundation or in a cloud storage solution of your choice and published to a static HTML documentation site.</p>
</div>
<div class="paragraph">
<p>After you configure OpenShift Data Foundation to store the files that TechDocs generates, you can configure the TechDocs plugin to use the OpenShift Data Foundation for cloud storage.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.2/html-single/confuguring_plugins_in_red_hat_developer_hub/index">Configuring plugins in Red Hat Developer Hub</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="con-techdocs-configure-storage_assembly-admin-templates">12.1. Configuring storage for TechDocs files</h3>
<div class="paragraph">
<p>The TechDocs publisher stores generated files in local storage or in cloud storage, such as OpenShift Data Foundation, Google GCS, AWS S3, or Azure Blob Storage.</p>
</div>
<div class="sect3">
<h4 id="proc-techdocs-using-odf-storage_assembly-admin-templates">12.1.1. Using OpenShift Data Foundation for file storage</h4>
<div class="paragraph">
<p>You can configure OpenShift Data Foundation to store the files that TechDocs generates instead of relying on other cloud storage solutions.</p>
</div>
<div class="paragraph">
<p>OpenShift Data Foundation provides an <code>ObjectBucketClaim</code> custom resource (CR) that you can use to request an S3 compatible bucket backend. You must install the OpenShift Data Foundation Operator to use this feature.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An OpenShift Container Platform administrator has installed the OpenShift Data Foundation Operator in Red Hat OpenShift Container Platform. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/4.15/html/deploying_openshift_data_foundation_using_amazon_web_services/deploy-using-dynamic-storage-devices-aws#installing-openshift-data-foundation-operator-using-the-operator-hub_cloud-storage">OpenShift Container Platform - Installing Red Hat OpenShift Data Foundation Operator</a>.</p>
</li>
<li>
<p>An OpenShift Container Platform administrator has created an OpenShift Data Foundation cluster and configured the <code>StorageSystem</code> schema. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/latest/html/deploying_openshift_data_foundation_using_amazon_web_services/deploy-using-dynamic-storage-devices-aws#creating-an-openshift-data-foundation-service_cloud-storage">OpenShift Container Platform - Creating an OpenShift Data Foundation cluster</a>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create an <code>ObjectBucketClaim</code> CR where the generated TechDocs files are stored. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: objectbucket.io/v1alpha1
kind: ObjectBucketClaim
metadata:
  name: &lt;rhdh_bucket_claim_name&gt;
spec:
  generateBucketName: &lt;rhdh_bucket_claim_name&gt;
  storageClassName: openshift-storage.noobaa.io</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Creating the Developer Hub <code>ObjectBucketClaim</code> CR automatically creates both the Developer Hub <code>ObjectBucketClaim</code> config map and secret. The config map and secret have the same name as the <code>ObjetBucketClaim</code> CR.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you create the <code>ObjectBucketClaim</code> CR, you can use the information stored in the config map and secret to make the information accessible to the Developer Hub container as environment variables. Depending on the method that you used to install Developer Hub, you add the access information to either the Red Hat Developer Hub Helm chart or Operator configuration.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p>For more information about the Object Bucket Claim, see <a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_data_foundation/4.12/html/managing_hybrid_and_multicloud_resources/object-bucket-claim#doc-wrapper">OpenShift Container Platform - Object Bucket Claim</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-techdocs-configure-odf-helm_assembly-admin-templates">12.1.2. Making object storage accessible to containers by using the Helm chart</h4>
<div class="paragraph">
<p>Creating a <code>ObjectBucketClaim</code> custom resource (CR) automatically generates both the Developer Hub <code>ObjectBucketClaim</code> config map and secret. The config map and secret contain <code>ObjectBucket</code> access information. Adding the access information to the Helm chart configuration makes it accessible to the Developer Hub container by adding the following environment variables to the container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BUCKET_NAME</code></p>
</li>
<li>
<p><code>BUCKET_HOST</code></p>
</li>
<li>
<p><code>BUCKET_PORT</code></p>
</li>
<li>
<p><code>BUCKET_REGION</code></p>
</li>
<li>
<p><code>BUCKET_SUBREGION</code></p>
</li>
<li>
<p><code>AWS_ACCESS_KEY_ID</code></p>
</li>
<li>
<p><code>AWS_SECRET_ACCESS_KEY</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These variables are then used in the TechDocs plugin configuration.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed Red Hat Developer Hub on OpenShift Container Platform using the Helm chart.</p>
</li>
<li>
<p>You have created an <code>ObjectBucketClaim</code> CR for storing files generated by TechDocs. For more information see <a href="#proc-techdocs-using-odf-storage_assembly-admin-templates">Using OpenShift Data Foundation for file storage</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>In the <code>upstream.backstage</code> key in the Helm chart values, enter the name of the Developer Hub <code>ObjectBucketClaim</code> secret as the value for the <code>extraEnvVarsSecrets</code> field and the <code>extraEnvVarsCM</code> field. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">upstream:
  backstage:
    extraEnvVarsSecrets:
      - &lt;rhdh_bucket_claim_name&gt;
    extraEnvVarsCM:
      - &lt;rhdh_bucket_claim_name&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ref-techdocs-example-config-plugin-helm_assembly-admin-templates">Example TechDocs Plugin configuration for the Helm chart</h5>
<div class="paragraph">
<p>The following example shows a Developer Hub Helm chart configuration for the TechDocs plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">global:
  dynamic:
    includes:
      - 'dynamic-plugins.default.yaml'
  plugins:
    - disabled: false
      package: ./dynamic-plugins/dist/backstage-plugin-techdocs-backend-dynamic
      pluginConfig:
        techdocs:
          builder: external
          generator:
            runIn: local
          publisher:
            awsS3:
              bucketName: '${BUCKET_NAME}'
              credentials:
                accessKeyId: '${AWS_ACCESS_KEY_ID}'
                secretAccessKey: '${AWS_SECRET_ACCESS_KEY}'
              endpoint: 'https://${BUCKET_HOST}'
              regions: '${BUCKET_REGION}'
              s3ForcePathStyle: true
            type: awsS3</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-techdocs-configure-odf-operator_assembly-admin-templates">12.1.3. Making object storage accessible to containers by using the Operator</h4>
<div class="paragraph">
<p>Creating a <code>ObjectBucketClaim</code> Custom Resource (CR) automatically generates both the Developer Hub <code>ObjectBucketClaim</code> config map and secret. The config map and secret contain <code>ObjectBucket</code> access information. Adding the access information to the Operator configuration makes it accessible to the Developer Hub container by adding the following environment variables to the container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>BUCKET_NAME</code></p>
</li>
<li>
<p><code>BUCKET_HOST</code></p>
</li>
<li>
<p><code>BUCKET_PORT</code></p>
</li>
<li>
<p><code>BUCKET_REGION</code></p>
</li>
<li>
<p><code>BUCKET_SUBREGION</code></p>
</li>
<li>
<p><code>AWS_ACCESS_KEY_ID</code></p>
</li>
<li>
<p><code>AWS_SECRET_ACCESS_KEY</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These variables are then used in the TechDocs plugin configuration.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have installed Red Hat Developer Hub on OpenShift Container Platform using the Operator.</p>
</li>
<li>
<p>You have created an <code>ObjectBucketClaim</code> CR for storing files generated by TechDocs.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>In the Developer Hub <code>ObjectBucketClaim</code> CR, enter the name of the Developer Hub <code>ObjectBucketClaim</code> config map as the value for the <code>spec.application.extraEnvs.configMaps</code> field and enter the Developer Hub <code>ObjectBucketClaim</code> secret name as the value for the <code>spec.application.extraEnvs.secrets</code> field. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">spec:
  application:
    extraEnvs:
      configMaps:
        - name: &lt;rhdh_bucket_claim_name&gt;
      secrets:
        - name: &lt;rhdh_bucket_claim_name&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="ref-techdocs-example-config-plugin-operator_assembly-admin-templates">Example TechDocs Plugin configuration for the Operator</h5>
<div class="paragraph">
<p>The following example shows a Red Hat Developer Hub Operator config map configuration for the TechDocs plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>kind: ConfigMap
apiVersion: v1
metadata:
  name: dynamic-plugins-rhdh
data:
  dynamic-plugins.yaml: |
    includes:
      - dynamic-plugins.default.yaml
    plugins:
      - disabled: false
        package: ./dynamic-plugins/dist/backstage-plugin-techdocs-backend-dynamic
        pluginConfig:
          techdocs:
            builder: external
            generator:
              runIn: local
            publisher:
              awsS3:
                bucketName: '${BUCKET_NAME}'
                credentials:
                  accessKeyId: '${AWS_ACCESS_KEY_ID}'
                  secretAccessKey: '${AWS_SECRET_ACCESS_KEY}'
                endpoint: 'https://${BUCKET_HOST}'
                regions: '${BUCKET_REGION}'
                s3ForcePathStyle: true
              type: awsS3</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-techdocs-config-cicd_assembly-admin-templates">12.2. Configuring CI/CD to generate and publish TecDocs sites</h3>
<div class="paragraph">
<p>TechDocs reads the static generated documentation files from a cloud storage bucket, such as OpenShift Data Foundation. The documentation site is generated on the CI/CD workflow associated with the repository containing the documentation files. You can generate docs on CI and publish to a cloud storage using the <code>techdocs-cli</code> CLI tool.</p>
</div>
<div class="paragraph">
<p>You can use the following example to create a script for TechDocs publication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"># Prepare
REPOSITORY_URL='https://github.com/org/repo'
git clone $REPOSITORY_URL
cd repo

# Install @techdocs/cli, mkdocs and mkdocs plugins
npm install -g @techdocs/cli
pip install "mkdocs-techdocs-core==1.*"

# Generate
techdocs-cli generate --no-docker

# Publish
techdocs-cli publish --publisher-type awsS3 --storage-name &lt;bucket/container&gt; --entity &lt;Namespace/Kind/Name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The TechDocs workflow starts the CI when a user makes changes in the repository containing the documentation files. You can configure the workflow to start only when files inside the <code>docs/</code> directory or <code>mkdocs.yml</code> are changed.</p>
</div>
<div class="sect3">
<h4 id="proc-techdocs-config-cicd-prep-repo_assembly-admin-templates">12.2.1. Preparing your repository for CI</h4>
<div class="paragraph">
<p>The first step on the CI is to clone your documentation source repository in a working directory.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To clone your documentation source repository in a working directory, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">git clone &lt;https://path/to/docs-repository/&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-techdocs-generate-site_assembly-admin-templates">12.2.2. Generating the TechDocs site</h4>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure CI/CD to generate your techdocs, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the <code>npx</code> package to run <code>techdocs-cli</code> using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>npm install -g npx</code></pre>
</div>
</div>
</li>
<li>
<p>Install the <code>techdocs-cli</code> tool using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>npm install -g @techdocs/cli</code></pre>
</div>
</div>
</li>
<li>
<p>Install the <code>mkdocs</code> plugins using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>pip install "mkdocs-techdocs-core==1.*"</code></pre>
</div>
</div>
</li>
<li>
<p>Generate your techdocs site using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">npx @techdocs/cli generate --no-docker --source-dir &lt;path_to_repo&gt; --output-dir ./site</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>&lt;path_to_repo&gt;</code> is the location in the file path that you used to clone your repository.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-techdocs-publish-site_assembly-admin-templates">12.2.3. Publishing the TechDocs site</h4>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To publish your techdocs site, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the necessary authentication environment variables for your cloud storage provider.</p>
</li>
<li>
<p>Publish your techdocs using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">npx @techdocs/cli publish --publisher-type &lt;awsS3|googleGcs&gt; --storage-name &lt;bucket/container&gt; --entity &lt;namespace/kind/name&gt; --directory ./site</code></pre>
</div>
</div>
</li>
<li>
<p>Add a <code>.github/workflows/techdocs.yml</code> file in your Software Template(s). For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>name: Publish TechDocs Site

on:
 push:
   branches: [main]
   # You can even set it to run only when TechDocs related files are updated.
   # paths:
   #   - "docs/**"
   #   - "mkdocs.yml"

jobs:
 publish-techdocs-site:
   runs-on: ubuntu-latest

   # The following secrets are required in your CI environment for publishing files to AWS S3.
   # e.g. You can use GitHub Organization secrets to set them for all existing and new repositories.
   env:
     TECHDOCS_S3_BUCKET_NAME: ${{ secrets.TECHDOCS_S3_BUCKET_NAME }}
     AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
     AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
     AWS_REGION: ${{ secrets.AWS_REGION }}
     ENTITY_NAMESPACE: 'default'
     ENTITY_KIND: 'Component'
     ENTITY_NAME: 'my-doc-entity'
     # In a Software template, Scaffolder will replace {{cookiecutter.component_id | jsonify}}
     # with the correct entity name. This is same as metadata.name in the entity's catalog-info.yaml
     # ENTITY_NAME: '{{ cookiecutter.component_id | jsonify }}'

   steps:
     - name: Checkout code
       uses: actions/checkout@v3

     - uses: actions/setup-node@v3
     - uses: actions/setup-python@v4
       with:
         python-version: '3.9'

     - name: Install techdocs-cli
       run: sudo npm install -g @techdocs/cli

     - name: Install mkdocs and mkdocs plugins
       run: python -m pip install mkdocs-techdocs-core==1.*

     - name: Generate docs site
       run: techdocs-cli generate --no-docker --verbose

     - name: Publish docs site
       run: techdocs-cli publish --publisher-type awsS3 --storage-name $TECHDOCS_S3_BUCKET_NAME --entity $ENTITY_NAMESPACE/$ENTITY_KIND/$ENTITY_NAME</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-06-24 15:13:21 UTC
</div>
</div>
</body>
</html>